# View details of an SQL statement

This topic describes how to view details of an SQL statement in OceanBase Cloud Platform (OCP), including its execution status, execution plans, bound indexes, and throttling enabling status.

## Prerequisites

* The version of OceanBase Database is later than 3.0 so that you can view the SQL statement execution profile.

* The password box of OCP user must contain the password of the tenant.

## Go to the details page of an SQL statement

1. Log on to the OceanBase Cloud Platform (OCP) console. To go to the O&M page of the tenant. In the left-side navigation pane, click **SQL Diagnostics** to go to the **SQL Diagnostics** page.

2. By default, the **SQL Diagnostics** tab of the **Real-time Diagnostics** page appears.

3. On the **TopSQL**, **SlowSQL** tab, find the target SQL statement.

   You can specify search criteria to find the target SQL statement.

   ![Image 7](https://help-static-aliyun-doc.aliyuncs.com/assets/img/en-US/5824633561/p440539.png)

4. Click the SQL text of the target SQL statement to go to the details page of the SQL statement.

   ![12012020](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/401/topsql%E4%BF%A1%E6%81%AF.png)

   On the **SQL Details** page, you can view the following details of the SQL statement:
   * In the **SQL Text** section, you can view the complete SQL statement. OCP masks sensitive data in the SQL statement. However, if OCP failed to parse the SQL statement, it returns the original SQL statement.

   * In the **Optimization Suggestions** section, you can view the optimization suggestions for the SQL statement. For more information, see **View optimization suggestions**.

   * In the **SQL Execution Profile** section, you can view the execution details of the SQL statement. For more information, see **View the execution profile of an SQL statement**.

   * On the **Previous Tendency** tab, you can view the historical trends of the SQL statement. For more information, see **View the historical trends of an SQL statement**.

   * On the **Execution Plans** tab, you can view the execution plans of the SQL statement, or bind an execution plan to the statement. For more information, see **View the execution plans of an SQL statement**.

   * On the **Index** tab, you can view the indexes bound to the SQL statement. For more information, see **View and bind indexes**.

## View optimization suggestions

If the SQL diagnostics identifies a change in the execution plan or performance of an SQL statement or identifies an excessively long response time of the SQL statement, you can view the problems and solutions in the **Optimization Suggestions** section. This section provides index recommendation, historical plan recommendation, and CPU scale-out recommendation. You can also view the plan hash and diagnostic details, and bind execution plans.

* Index recommendation is provided based on the following algorithm:

  * The equality query columns are arranged in the front and combined in any order.

  * If range queries are performed, the range query column with the best selectivity is arranged after the equality query columns.

  * If no range query is performed, the sorting column is arranged after the equality query columns when the sorting elimination condition is met.

  * Other columns in the predicate are arranged after the index. In this case, the index is a half-width index.

  * Other columns in the SELECT statement are arranged after the index to construct a covering index.

  * If the covering index contains eight or fewer columns, the covering index is recommended. Otherwise, the half-width index is recommended.

  <main id="notice" type='explain'>
    <h4>Note</h4>
    <p>Table joins are not supported.</p>
  </main>

   Parameters:

  * `ocp.perf.sql.index-advisor-cpu-time-threshold`: the threshold of the average CPU time of SQL statements for index recommendation. When the average CPU time of SQL statements is greater than this value, index recommendation is provided.

  * `ocp.perf.sql.index-advisor-elapsed-time-threshold`: the threshold of the average response time of SQL statements for index recommendation. When the average response time of SQL statements is greater than this value, index recommendation is provided.

* Execution plans for the same type of SQL statement executed in the last 7 days are analyzed. The execution plan whose average CPU time is 80% lower than that of others is recommended. A local plan is preferentially recommended. When a local plan is unavailable, a distributed plan is recommended.

* If the CPU utilization of the tenant is greater than 60%, the system recommends that you scale out the CPU capacity for the tenant.

### View details of an execution plan

Click **View Plan Hash**. In the dialog box that appears, you can view the details of the execution plan, including the basic information, execution steps, and server execution plans.

## Bind an execution plan

Click **Bind Execution Plan**. In the dialog box that appears, click **Bind**. After the execution plan is bound, refresh the page, and click **View Binding Records in Last 30 Days** to confirm that the execution plan is bound.

![Image 25](https://help-static-aliyun-doc.aliyuncs.com/assets/img/en-US/5824633561/p440541.png)

### View details on the Trace Details page

Click a trace ID to go to the **Trace Details** page and view the execution profile, which displays the basic information of the trace, schema table, schema index, OBServer node details, and operator execution details.

* Click **Download Execution Profile Report** in the upper-right corner of the page to export the trace information as an HTML file.
* Click the triangular icon next to the trace ID to switch to another trace.
* On the **Schema Table** tab, click the table creation statement to view the details of the statement.
* On the **Schema Index** tab, bind or unbind indexes.

### Download the execution profile report

In the **SQL Execution Profile** section, click **Download Execution Profile Report** in the **Actions** column of the target trace to export the trace information as an HTML file.

## View the historical trends of an SQL statement

On the **SQL Details** page, click the **Previous Tendency** tab.

You can view the SQL Statement Execution and SQL Plan Generation Time charts on this tab. When you modify the statistical time in section ① of the figure, both of the charts will be updated based on the new time.

* SQL Statement Execution chart

   By default, this chart displays **Average Response Time**, **CPU Time**, and **Execution Time**. You can select more metrics to display in section ② of the figure.

   ![1201](https://help-static-aliyun-doc.aliyuncs.com/assets/img/en-US/5824633561/p440543.png)

* SQL Plan Generation Time chart

   This chart indicates that a new plan is generated. The time used to generate the plan is represented by the y-axis.

   ![120102](https://help-static-aliyun-doc.aliyuncs.com/assets/img/en-US/5824633561/p440544.png)

## View the execution plans of an SQL statement

On the **SQL Details** page, click the **Execution Plans** tab. On this tab, you can perform the following operations:

* Set the range and time window for query in section ①.

* Click the button in section ② to view the execution plan binding records of the SQL statement in the last 30 days.

* Click the value in section ③ to view the details of the execution plan, including basic information, execution steps, and execution records on different OBServers.

* Click **Bind** to bind the execution plan to the SQL statement.

![120103](https://help-static-aliyun-doc.aliyuncs.com/assets/img/en-US/5824633561/p440549.png)

## View and bind indexes

On the **SQL Details** page, click the **Index** tab. On this tab, you can perform the following operations:

![1201104](https://help-static-aliyun-doc.aliyuncs.com/assets/img/en-US/5824633561/p440550.png)

* View the list of indexes bound to the SQL statement.

   You can filter the indexes by index status and type. You can also click **Bind** to bind the index to the SQL statement. You can create indexes by using a command-line tool or in OceanBase Developer Center (ODC).

* Click **View Binding Records in Last 30 Days** to view the index binding records of the SQL statement in the last 30 days.

   In a binding record, you can view the status of the bound index, or click **Unbind** to unbind the index from the SQL statement. You can click **Bind Plan** to bind the index to the SQL statement again.

   ![12011920](https://help-static-aliyun-doc.aliyuncs.com/assets/img/en-US/5824633561/p440551.png)

## Set throttling for the SQL statement

On the **SQL Details** page, click the **SQL Throttling** tab. On this tab, you can perform the following operations:

* Check whether the current SQL statement is throttled.

   The following figure shows that the SQL statement is not throttled.

   ![12010602](https://help-static-aliyun-doc.aliyuncs.com/assets/img/en-US/5824633561/p440554.png)

* Set throttling for the current SQL statement.

   ![12011935](https://help-static-aliyun-doc.aliyuncs.com/assets/img/en-US/5824633561/p440555.png)

   1. As shown in the preceding figure, enable throttling and specify the throttling strategy.

      * **Maximum Concurrency**: The value range is [0,+∞), and **0** indicates that throttling is disabled.

      * **Throttling Keywords**: Click **Settings**. In the **Set Throttling Keywords** dialog box, specify the throttling keywords in section ① in the figure.

  <main id="notice" type='explain'>
    <h4>Note</h4>
    <p>If no keywords are specified, the entire SQL statement is throttled.</p>
  </main>
      * If the throttling keywords failed to be specified, you can view the causes in section ② in the figure.

         ![12011950](https://help-static-aliyun-doc.aliyuncs.com/assets/img/en-US/5824633561/p440556.png)

   2. Click **Update**, and then click **OK** in the dialog box that appears.
