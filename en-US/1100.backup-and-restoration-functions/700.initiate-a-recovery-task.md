# Initiate a restore task

You can initiate a restore task for a cluster that has been backed up.

## Prerequisites

* You have backed up the cluster to be restored. For more information, see [Back up now](400.backup-now/100.back-up-cluster-now.md).

* When you restore a physically backed up OceanBase cluster, you cannot restore its data to a cluster of an earlier version.

## Procedure

1. Log in to the OceanBase Cloud Platform (OCP) console.

2. Go to the **Initiate Recovery** page by using the following methods:

   * Method 1: Initiate a restore task on the **Recovery** page.

     1. In the left-side navigation pane, choose **Backup & Recovery** > **Recovery**.

     2. On the **Recovery** page, click **Initiate Recovery** in the upper-right corner.

   * Method 2: Initiate a restore task on the O&M page of a cluster.

     1. In the left-side navigation pane, click **Clusters** to go to the **Clusters** page.

     2. Click the name of the target cluster in the **Clusters** list or **Resource Usage** to go to its O&M page.

     3. In the left-side navigation pane, click **Backup & Recovery**.

     4. On the **Backup & Recovery** page of the cluster, click **Initiate Recovery**.

     <main id="notice" type='explain'>
     <h4>Note</h4>
     <p>You cannot restore a cluster by using Method 2 in the following circumstances:<ul><li>The cluster is not in the **Running** state. </li><li>The cluster does not have a backup strategy. </li></ul></p>
     </main>

   * Method 3: Initiate a restore task on the O&M page of a tenant.

      1. In the left-side navigation pane, click **Tenants** to go to the **Tenants** page.

      2. Click the name of the target tenant in the **Tenants** list to go to its O&M page.

      3. In the left-side navigation pane, click **Backup & Recovery**.

      4. On the **Backup & Recovery** page of the tenant, click **Initiate Recovery**.

     <main id="notice" type='explain'>
     <h4>Note</h4>
     <p>You cannot restore a tenant by using Method 3 in the following circumstances:<ul><li>The tenant is not in the **Running** state. </li><li>The tenant does not have a backup strategy. </li></ul></p>
     </main>

3. (Optional) If you use Method 1, configure a custom storage configuration or use an existing configuration. If you choose to configure a custom configuration, configure the parameters based on the following tables. If you choose to select an existing configuration, click **Select Existing Configuration**. Then, the system automatically populates the following parameters.

   <main id="notice" type='notice'>
   <h4>Notice</h4>
   <p>If the native Alibaba Cloud Object Storage Service (OSS) or Tencent Cloud Object Storage (COS) storage type is available, we recommend that you select the OSS or COS storage type. </p>
   </main>

    * **File**: your local file storage system. Generally, Network File System (NFS) is used.

      | Parameter | Description |
      |--------|-------|
      |  Storage Directory  | The directory in which the backup files are stored on the storage service.  |
      | Host for Parsing  | Select a host that can access the directory. To parse logical backup data, select the host where the backup and restore service resides. To parse physical backup data, select the host where a cluster of OceanBase Database V2.2.70 or later resides. Click **Parse** to obtain the list of clusters that can be restored.  |

    * **OSS**: Alibaba Cloud OSS, which is supported only in OceanBase Database V2.2.76 and later.

      | Parameter | Description |
      |--------|-------|
      | Storage Directory | Select the directory where the backup files are stored.   |
      |  Domain  | The domain name for accessing the files stored in Alibaba Cloud OSS, such as `oss-cn-hangzhou.aliyuncs.com`.  |
      |  User  | The user for accessing the files stored in Alibaba Cloud OSS.  |
      |  AccessKey Pair  | The AccessKey pair for accessing the files stored in Alibaba Cloud OSS.  |
      | Host for Parsing  | Select a host that can access the directory. To parse logical backup data, select the host where the backup and restore service resides. To parse physical backup data, select the host where a cluster of OceanBase Database V2.2.70 or later resides. Click **Parse** to obtain the list of clusters that can be restored.  |

    * **COS**: Tencent Cloud COS, which is supported only in OceanBase Database V2.2.76 and later but earlier than V4.0, and in OceanBase Database V4.2.1 and later.

      | Parameter | Description |
      |--------|-------|
      | Storage Directory | Select the directory where the backup files are stored.  |
      |  Domain  | The domain name for accessing the files stored in the COS bucket, such as `cos.ap-beijing.myqcloud.com`.  |
      |  Resource Identity (APPID)  | The unique resource identifier at the user dimension when you access the COS bucket as a developer. You can obtain the APPID on the API key management page of COS.  |
      |  Project ID  | The ID of the developer. You can obtain the ID on the API key management page of COS.  |
      |  Project Key  | The key of the developer. You can obtain the key on the API key management page of COS.  |
      | Host for Parsing  | Select a host that can access the directory. To parse logical backup data, select the host where the backup and restore service resides. To parse physical backup data, select the host where a cluster of OceanBase Database V2.2.70 or later resides. Click **Parse** to obtain the list of clusters that can be restored.  |

    * **OBS**: Huawei Cloud Object Storage Service (OBS), which is supported only in OceanBase Database V3.2.3.2-105000062022090916 and later but earlier than V4.0.0.0.

      | Parameter | Description |
      |--------|-------|
      | Storage Directory | Select the directory where the backup files are stored.  |
      |  Domain  | The domain name for accessing the files stored in the Huawei Cloud OBS bucket, such as `obs.cn-north-4.myhuaweicloud.com`.  |
      |  AK  | The AccessKey ID of the OBS bucket.  |
      |  SK  | The AccessKey secret of the OBS bucket.  |
      | Host for Parsing  | Select a host that can access the directory. To parse logical backup data, select the host where the backup and restore service resides. To parse physical backup data, select the host where a cluster of OceanBase Database V2.2.70 or later resides. Click **Parse** to obtain the list of clusters that can be restored.  |

    * **S3**: object storage services that support the Amazon Simple Storage Service (S3) protocol, such as the native Amazon S3, Huawei Cloud OBS, Tianyi Cloud OBS, and Google Cloud Storage (GCS). These object storage services are supported only in OceanBase Database V4.2.1-BP7, V4.2.3-BP1, and later. For more information about Amazon S3-compatible object storage services, see [AWS S3 protocol](../2100.appendix/900.s3-overview.md).

      | Parameter | Description |
      |------------|------------|
      |  Storage Directory  | The directory in which the backup files are stored on the storage service.  |
      |  Domain  | The domain name for accessing the files stored in the S3 bucket, such as `s3.us-west-2.amazonaws.com`.  |
      |  AK  | The AccessKey ID of the S3 bucket.  |
      |  SK  | The AccessKey secret of the S3 bucket.  |
      |  Region  | The region of the S3 bucket.  |
      | Host for Parsing  | Select a host that can access the directory. To parse logical backup data, select the host where the backup and restore service resides. To parse physical backup data, select the host where a cluster of OceanBase Database V2.2.70 or later resides. Click **Parse** to obtain the list of clusters that can be restored.  |

      <main id="notice" type='notice'>
      <h4>Notice</h4>
      <p>The <b>Region</b> parameter is required when Amazon S3 is used, and is not required when Huawei Cloud OBS, Tianyi Cloud OBS, or GCS is used. </p>
      </main>

4. Specify the restore source.

   * Restore a tenant

      | Parameter | Description |
      |-------|-------------------------------|
      | Source Cluster     | If you initiate a restore task from the O&M page of a cluster, the cluster is the source cluster by default, and you do not need to specify this parameter. |
      | Source Tenant     | Select the tenant to restore.                    |
      | Object to Restore | Select **Tenant**.                    |
      | Recovery Date | Select a date within the specified restorable time range.                 |
      | Restore Point in Time | Select a point in time within the specified time range.            |

   * Restore databases

      <main id="notice" type='explain'>
      <h4>Note</h4>
      <p>This feature is supported only in OceanBase Database V4.x. </p>
      </main>

     If you use Method 3 to restore a tenant, you can restore databases in the tenant.

      | Parameter | Description |
      |-------|-------------------------------|
      | Source Cluster   | The source cluster to restore the tables. The default value is the cluster to which the current tenant belongs. |
      | Source Tenant   | The source tenant to restore the tables. The default value is the current tenant.                    |
      | Object to Restore | Select **Database**.                    |
      | Recovery Date | Select a date within the specified restorable time range.                 |
      | Restore Point in Time | Select a point in time within the specified time range.     |
      | Restore Database Object | Select the databases to be restored in the **Restorable Objects** list on the left and click **>** to add them to the **Selected Objects** list on the right. The database names must be unique. OCP allows you to rename databases, as shown in the following figure:  |

      <main id="notice" type='explain'>
      <h4>Note</h4>
      <p>You can select at most 200 database objects. </p>
      </main>

   * Restore tables

      <main id="notice" type='explain'>
      <h4>Note</h4>
      <p><ul><li>Only user tables can be restored. Temporary tables, views, materialized views, materialized view logs, or indexes cannot be restored separately. </li><li>The table restore is considered successful when the table data is restored, even if the indexes, constraints, or other associated schemas fail to be restored. </li></ul></p>
      </main>

     If you use Method 3 to restore a tenant, you can restore tables in the tenant.

      | Parameter | Description |
      |-------|-------------------------------|
      | Source Cluster   | The source cluster to restore the tables. The default value is the cluster to which the current tenant belongs. |
      | Source Tenant   | The source tenant to restore the tables. The default value is the current tenant.                    |
      | Object to Restore | Select **Table**.                    |
      | Recovery Date | Select a date within the specified restorable time range.                 |
      | Restore Point in Time | Select a point in time within the specified time range.     |
      | Restore Table Object | Select the tables to be restored in the **Restorable Objects** list on the left and click **>** to add them to the **Selected Objects** list on the right. The table names must be unique. OCP allows you to rename tables, as shown in the following figure:  |

      <main id="notice" type='explain'>
      <h4>Note</h4>
      <p>You can select at most 200 table objects. </p>
      </main>

5. Specify the restore target.

      <main id="notice" type='explain'>
      <h4>Note</h4>
      <p>During a database or table restore, you need to create an auxiliary tenant in the target cluster. We recommend that the specifications of the auxiliary tenant be consistent with those of the source tenant, and that the target cluster have sufficient CPU, memory, and disk resources. If the resources are insufficient, the restore may be slow or fail. After the restore is completed, the system will delete the auxiliary tenant by default. </p>
      </main>

      | Parameter | Description |
      |-------|-------------------------------|
      | Destination Cluster | Select a target cluster. |
      | Destination Tenant | Select a target tenant.                    |

   <main id="notice" type='explain'>
   <h4>Note</h4>
   <p>The following types of clusters cannot be used as the restore target:<ul><li>Clusters in primary/standby mode </li><li>Clusters in the Unavailable state </li><li>Clusters of an OceanBase Database version earlier than that of the source cluster </li></ul></p>
   </main>

6. Specify the following zone-related parameters and set the priorities of the zones.

   | Parameter | Description |
   |---------|----------|
   | Replica Type | Valid values: <ul><li>**Full-featured Replica**: A standard replica that contains all the data categories and all the features, including MemTables, SSTables, and transaction logs. A full-featured replica can switch to the leader role efficiently to provide services. </li><li>**Log Replica**: A replica that contains only logs. It does not have a MemTable or an SSTable. It provides log services for external applications and participates in log voting. It can facilitate the restore of other replicas, but it cannot become the leader to provide database services.   </li><li>**Read-only Replica**: A replica that contains full logs, MemTables, and SSTables. You can select this type of replica for applications that does not require high consistency in data reading. </li></ul> |
   | Unit Specification | The specifications of the resources that the replica occupies. <ul><li>You can select an existing specification. </li><li>You can also create a specification as needed and select the created specification. </li></ul>  |
   | Units | The number of resource units occupied by the replica. <blockquote>**Notice**</br>If the version of the target cluster is V4.0 or later, you can only set the same number of units for all zones. In other words, the number of units that you specify on this page applies to all zones under the restored tenant. </blockquote>|

7. Click **Initiate Recovery**.
