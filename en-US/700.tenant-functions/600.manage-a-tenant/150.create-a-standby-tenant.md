# Create a standby tenant

You can create a standby tenant for an existing primary or standby tenant. OceanBase Cloud Platform (OCP) allows you to create multiple standby tenants for a single primary tenant (one-to-many), and create a standby tenant for an existing standby tenant (cascading).

## Background information

In OceanBase Database V4.1.0 and later, the Physical Standby Database solution is provided in the form of primary/standby tenants. Clusters are no longer assigned the PRIMARY or STANDBY role and are only containers of primary and standby tenants. The primary tenant is a business tenant that supports complete database capabilities, including queries, data manipulation language (DML) operations, and data definition language (DDL) operations. A standby tenant provides only disaster recovery and read-only services. The tenant-level Physical Standby Database high availability solution comprises one primary tenant and multiple standby tenants.

## Prerequisites

* Primary/Standby tenants are configured in OceanBase Database V4.2 or later.

* The cluster to which the standby tenant belongs is in the Running state.

* You have logged on with an account that has the permissions to manage the cluster. For example, you act as the system administrator or the OCP tenant administrator.

* (Optional) You have created a parameter template by referring to [Manage tenant parameter templates](../1500.manage-tenant-parameter-templates.md).

  If you need to create multiple tenants with the same parameter configuration, you can use a parameter template to avoid repeatedly configuring the same parameters.
  
* The following conditions are met before you enable the arbitration service for a tenant:

  * The arbitration service is added for the cluster to which the tenant belongs, and the service is in the **RUNNING** state.

  * The locality of the tenant includes two or four full-featured replicas.

  * The resources available on the server hosting the arbitration service meet the resource requirements.

    You can modify the resource requirements by using the following system parameters based on your business requirements. For more information, see [Modify system parameters](../1600.manage-tenant-parameters/200.modify-a-tenant-parameter.md).

    * `ocp.arbitration.min.remain.disk.size`: the minimum size in MB of the clog disk on the arbitration service host required when the arbitration service is enabled for the tenant. The parameter value is in the (a,b) format, indicating the minimum clog disk sizes required when the tenant has two and four full-featured replicas, respectively. Default value: [12,24].
    * `ocp.arbitration.max.cpu.used.percentage`: the maximum CPU utilization in percentage (%) allowed on the arbitration service host when the arbitration service is enabled for the tenant. Default value: `90`.
    * `ocp.arbitration.max.memory.used.percentage`: the maximum memory usage in percentage (%) allowed on the arbitration service host when the arbitration service is enabled for the tenant. Default value: `90`.

## Procedure

You can create a standby tenant by using any of the following methods:

* **Method 1:** Log on to the OCP console, go to the **Tenants** page, and click **Create Tenant** in the upper-right corner.

* **Method 2:** Log on to the OCP console, go to the **Overview** page of a cluster, and click **Create Tenant** in the upper-right corner.

* **Method 3:** Log on to the OCP console, go to the **Overview** page of a cluster, select **Tenant Management** in the left-side navigation pane, and click **Create Tenant** in the upper-right corner.

* **Method 4:** Log on to the OCP console, go to the **Overview** page of a tenant, click the **More** icon in the upper-right corner, and select **Create Tenant**.

The procedure of **Method 1** is described as follows:

1. Log on to the OCP console.

2. In the left-side navigation pane, select **Tenants**. The **Tenants** tab automatically appears.

3. On the **Tenants** tab, click **Create Tenant** in the upper-right corner.

4. Specify the parameters in the **Basic Settings** section.

   The following table describes the parameters.

   |    **Parameter**     | **Description** |
   |---------------|---|
   | **Tenant Type**        | Select **Standby Tenant**. <main id="notice" type='explain'><h4>Note</h4><p>When you create a standby tenant on the **Overview** page of a specified tenant, you cannot select a tenant type. The default value is `Standby Tenant`. </p></main> |
   | **OCP Cluster of Primary Tenant**        | Select the OCP cluster that manages the primary tenant. This parameter is required in **multi-cluster** mode. <main id="notice" type='explain'><h4>Note</h4><p>When you create a standby tenant on the **Overview** page of a specified tenant, you do not need to specify this parameter. </p></main> |
   | **Cluster of Primary Tenant**        | Select the cluster to which the primary tenant belongs. <main id="notice" type='explain'><h4>Note</h4><p>When you create a standby tenant on the **Overview** page of a specified tenant, the current cluster is displayed by default and you cannot modify the setting. </p></main> |
   | **Primary Tenant**        | Select the primary tenant of the standby tenant. <main id="notice" type='explain'><h4>Note</h4><p>When you create a standby tenant on the **Overview** page of a specified tenant, the current tenant is regarded as the primary tenant by default and you cannot modify the setting. </p></main> |
   | **Cluster of Standby Tenant**        | Select the cluster to which the standby tenant belongs. <main id="notice" type='explain'><h4>Note</h4><p>When you create a standby tenant on the **Tenant Management** page of a specified cluster, the current cluster is displayed by default and you cannot modify the settings. </p></main> |
   | **Standby Tenant Name**       | The tenant name must start with a letter and end with a letter or a digit. It can contain letters, digits, and underscores (_). It must be 2 to 32 characters in length. |
   | **Service Name**       | Optional. This parameter is available when the OceanBase cluster is of a version ranging from V4.2.4 to V4.3.0. The service name is a new database access method provided by OceanBase Database. It can be considered as the alias of the cluster name and tenant name. This way, an application can access the database by using the service name. The service name must start with a letter and can contain letters, digits, and underscores (_). It must be 2 to 64 characters in length. <main id="notice" type='explain'><h4>Note</h4><p>If **Service Name** has been configured for the primary tenant, the specified service name is automatically populated here. </p></main> |
   | **Primary/Standby Synchronization Method**   | The synchronization mode between the primary and standby tenants. Two synchronization modes are supported: **Network-based Synchronization** and **Archiving-based**. <ul><li>In **network-based** synchronization mode, logs are synchronized through the remote procedure call (RPC) network between OBServer nodes. A standby tenant can directly read logs from the primary tenant by using an IP address and a port number. By default, the **network-based** synchronization mode is used for synchronization between the primary and standby tenants.   </li><li>In **archiving-based** synchronization mode, logs are synchronized based on shared storage. The primary tenant writes logs to a network disk or Alibaba Cloud Object Storage Service (OSS), and the standby tenant reads data from the shared storage. To use the **archiving-based** synchronization mode, make sure that archiving has been enabled for the current tenant. Otherwise, you cannot synchronize data based on archiving. For more information about how to enable archiving for a tenant in the OCP console, see [Back up tenant now](../../1100.backup-and-restoration-functions/400.backup-now/200.back-up-tenant-now.md).   </li></ul><main id="notice" type='explain'><h4>Note</h4><p>If a cascading or one-to-many primary/standby relationship already exists, the primary/standby synchronization mode that is already in use is selected by default and you cannot modify the setting. </p></main> |

5. Specify the backup set information in the **Restore Standby Tenant Settings** section. You can choose whether to specify an independent storage directory for the standby tenant based on the application scenario.

   <main id="notice" type='explain'><h4>Note</h4><p>If the <b>network-based</b> synchronization mode is used and the REDO logs of the primary tenant are complete, you do not need to configure the parameters in this section<b></b>. You can also click <b>Restore by Using Backup Set</b> and configure backup set information to restore the standby tenant by using the backup set. </p></main>

   * **Specify an independent storage directory**

      You can specify an independent storage directory if you have backed up the standby tenant by using a CLI instead of the tenant backup feature of OCP, or you have copied the external backup files of the primary tenant to a shared storage service and you want to restore the standby tenant by using the backup files.

      |    **Parameter**     | **Description** |
      |---------------|---|
      | **Backup Set Storage Type**        | The storage service for backup files. Valid values: <ul><li> **File**: your local file storage system. Generally, Network File System (NFS) is used.   </li><li> **OSS**: Alibaba Cloud Object Storage Service (OSS), which is supported only in OceanBase Database V2.2.76 and later. </li><li> **COS**: Tencent Cloud Object Storage (COS), which is supported only in OceanBase Database V2.2.76 or later but earlier than V4.0.0, and in OceanBase Database V4.2.1 and later. </li></ul> |
      | **Data Backup Directory**        | The data storage directory on the current storage service for backup files. |
      | **Log Backup Directory**        | The log storage directory on the current storage service for backup files. |
      | **Domain**       | The domain name for accessing the cloud storage service where the backup set is stored. <ul><li>If you select **OSS** for **Backup Set Storage Type**, enter the domain name for accessing backup files in the OSS bucket. You can append a port number to the domain name, for example, `oss.ap-shanghai.myqcloud.com:8080`. </li><li>If you select **COS** for **Backup Set Storage Type**, enter the domain name for accessing objects in the COS bucket, such as `cos.ap-beijing.myqcloud.com`. </li></ul> |
      | **User**        | If you select **OSS** for **Backup Set Storage Type**, enter the user for accessing the files stored in the OSS bucket. |
      | **Resource Identity (APPID)**       | The unique resource identifier at the user dimension when you access the COS bucket as a developer. You can obtain the APPID on the API key management page of COS. This parameter is displayed only if you have selected **COS** for **Backup Set Storage Type**. |
      | **Project ID**       | The project ID of a developer. You can obtain the ID on the API key management page of COS. This parameter is displayed only if you have selected **COS** for **Backup Set Storage Type**. |
      | **AccessKey Pair**          | If you select **OSS** or **COS** for **Backup Set Storage Type**, enter the AccessKey pair for accessing the files stored in the OSS or COS bucket. |

   * **Do not specify an independent storage directory**

      If you have backed up the standby tenant by using the tenant backup feature of OCP, you can choose not to specify an independent storage directory. In this case, the system automatically populates the information about the storage directory, which cannot be modified.

      |    **Parameter**     | **Description** |
      |---------------|---|
      | **Storage Directory**       | The backup directory on the current storage service for backup files. |
      | **Domain**       | The domain name for accessing the cloud storage service where the backup set is stored. <ul><li>If you select **OSS** for **Backup Set Storage Type**, enter the domain name for accessing backup files in the OSS bucket. You can append a port number to the domain name, for example, `oss.ap-shanghai.myqcloud.com:8080`. </li><li>If you select **COS** for **Backup Set Storage Type**, enter the domain name for accessing objects in the COS bucket, such as `cos.ap-beijing.myqcloud.com`. </li></ul> |

   Click **Backup Set Verification**. The system checks the directory of the current backup set, whether the cluster of the standby tenant is accessible, and whether logs of the maximum restorable window of the current backup set and logs of the current primary tenant are consistent. If the check fails, you can locate and handle the issue based on the prompts.

6. Specify the information in the **Standby Tenant Replica Settings** section.

   <main id="notice" type='explain'>
   <h4>Note</h4>
   <p>We recommend that you keep the replica specifications of the standby tenant consistent with those of the primary tenant. </p>
   </main>

   By default, the system displays configurable zones based on the zone information of the selected cluster. If you do not need to create a replica in a zone, click the **Delete** icon to delete the zone. The zone information parameters that need to be configured and their descriptions are listed in the following table.

   |    **Parameter**     | **Description** |
   |----------------|------|
   | **Replica Type**       | The type of the replica. Valid values: <ul><li>Full-featured Replica</li><li>Read-only Replica   </li></ul>    Select multiple full-featured replicas to ensure that they are in the majority. <main id="notice" type='explain'><h4>Note</h4><p>In a **standalone centralized** database, only **full-featured replicas** are supported. </p></main>  |
   | **Unit Specification**    | OCP has a set of built-in unit specifications. You can select the specification that you need from the list of unit specifications or click **Add Specification** at the bottom of the list to add a custom specification. For more information, see [OCP resource unit specifications](../500.ocp-resource-unit-specifications.md). <main id="notice" type='notice'><h4>Notice</h4><p><ul><li>We recommend that you set the same specification and number of units for all full-featured replicas. Different specifications or numbers of units can compromise the performance or stability. </li><li>If the OceanBase Database version of the cluster is V4.0.0 or later, take note of the following considerations: <ul><li>You cannot configure less than one CPU core for the tenant. </li><li>By default, the cluster limits the minimum memory size. You can adjust the limit by modifying the <code>__min_full_resource_pool_memory</code> parameter. For more information about how to modify the parameter of an OceanBase cluster of V4.1.0, see <a href="https://en.oceanbase.com/docs/common-oceanbase-database-10000000001375811">Modify cluster parameters</a>. </li></ul></li></ul></p></main>   |
   | **Units**    | The number of resource units in the zone. The number of resource units cannot exceed the number of OBServer nodes in the zone. <ul><li>If the cluster version is OceanBase Database V4.0 or later, you can only set the same number of units for all zones, which is 1 by default. </li><li>If the cluster version is earlier than OceanBase Database V4.0, you can set different numbers of units for different zones. </li><main id="notice" type='explain'><h4>Note</h4><p>In a **standalone centralized** database, the default number of units is **1**, which cannot be modified. </p></main>    |
   | **Zone Priority Rankings** | Specifies whether to define priorities for the zones of the tenant. The priorities affect the priority of the primary zone of the sys tenant. <ul><li>If this parameter is not specified, the zone priorities of the sys tenant are used by default. </li><li>If **Zone Priority Rankings** is enabled with no zone priorities, the random priority is used. </li><li>To configure zone priorities, you can select one or more zones from the list on the left that displays all zones in the current cluster and add the selected zones to the list on the right. By default, the priority of a zone added earlier is higher than that of a zone added later, and the zones added at the same time have the same priority. After you move the zones to the box on the right side, you can also drag them upward or downward to adjust their priority order. A zone takes priority over those beneath it. </li></ul><main id="notice" type='explain'><h4>Note</h4><p>In a **standalone centralized** database, the zone priority rankings are not displayed, and Zone1 has the highest priority by default. </p></main> |
   | **Enable Arbitration Service** | Specifies whether to enable the arbitration service for the tenant. The arbitration service is disabled by default. |

7. Enable **Parameter Settings** and configure the tenant parameters.

    * You can click the button in section ① of the following figure to add startup parameters one by one and set their values.

    * You can also click **Select Parameter Template** as shown in section ② of the following figure and select a parameter template. The system will automatically populate parameters in this section by using the template. If no tenant parameter template is available, you can click **Create Tenant Parameter Template** to create one. For more information, see [Manage tenant parameter templates](../1500.manage-tenant-parameter-templates.md).

         The system provides four built-in templates that contain general parameters. You can use a template for cluster configuration. The following table describes the built-in templates.

         | Template | Parameter | Description |
         |------|------|-------|
         | Default parameter template for COMPLEX_OLTP   | `_rowsets_max_rows:4`  | Suitable for workloads such as banking and insurance systems. These workloads often involve complex join operations, complex subqueries, batch processing jobs compiled in PL, long-running transactions, and large transactions. Short-running queries are sometimes executed in parallel. <br>This template applies to OceanBase Database V4.3.0 and later.   |
         | Default parameter template for HTAP   |  `_rowsets_max_rows:32`  | Suitable for hybrid transactional and analytical processing (HTAP) workloads. You can use it to quickly get insights from campaign operation data, fraud detection, and scenario-specific recommendations. <br>This template applies to OceanBase Database V4.3.0 and later. |
         | Default parameter template for OLAP   | `default_table_store_format:column` <br> `ob_query_timeout:604800000000` <br> `ob_sql_work_area_percentage:30` <br> `ob_trx_timeout:604800000000` <br> `parallel_min_scan_time_threshold:10` <br> `_rowsets_max_rows:256`  | Suitable for real-time data warehouse analytics. <br>This template applies to OceanBase Database V4.3.0 and later.   |
         | Default parameter template for EXPRESS_OLTP   | `_rowsets_max_rows:1`  | Suitable for workloads such as trading and core payment systems and high-throughput online applications. Such workloads do not involve restrictions such as foreign keys, stored procedures, long-running or large transactions, complex join operations, or complex subqueries. <br>This template applies to OceanBase Database V4.3.0 and later.   |

    <main id="notice" type='explain'>
    <h4>Note</h4>
    If you are creating a tenant in MySQL mode by using a parameter template that contains parameters that are valid only in Oracle mode, you must manually delete those parameters.
    </main>

8. Click **Submit**.

    The page that appears prompts you that the tenant creation task has been submitted and displays the summary information of the task.

    * To view the task details, click **View Task Details**.
    * To return to the **Tenants** list, click **Return to Tenants List**. In the **Tenants** list, you can view the status and task details of the new tenant, and delete the tenant if the tenant creation failed.

    <main id="notice" type='explain'>
    <h4>Note</h4>
    <p>When the task status is <strong>Completed</strong>, you can check the status of the new tenant in the <strong>Tenants</strong> list on the <strong>Tenant Management</strong> page. The new tenant is created if its status is <strong>Running</strong>. </p>
    </main>
