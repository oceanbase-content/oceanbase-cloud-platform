# Backend wait event metrics

This topic describes the following backend wait event metrics for OceanBase Database tenants: `on_cpu`, `application`, `configuration`, `administrative`, `concurrency`, `commit`, `idle`, `network`, `user_io`, `system_io`, `cluster`, and `other`. You can specify a statistical period to query the backend workload metrics of a tenant in a single zone or on a single OBServer node.

<main id="notice" type='explain'>
<h4>Description</h4>
<p>For more information about the classes of wait events<b></b>, see <a href="https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000749691">Wait events</a>. </p>
</main>

## on_cpu

### Definition

The number of active sessions that occupy CPU resources and where database commands are executed within the statistical period.

### Description

| **Metric** | **Metric name** | **Unit** |
|---------|-------------------|--------|
| on_cpu | ob_background_on_cpu_waitevent_cnt | N/A |

### Calculation expression

sum(ob_background_waitevent_cnt{wait_class="ON_CPU",@LABELS}) by (@GBLABELS)

### SQL statements for metric collection

OceanBase Database V4.2.2.0 and later but earlier than V4.3.0.0:

```sql
SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 1 group by wait_class, tenant_id
```

## application

### Definition

The number of active sessions that are waiting for events of the APPLICATION class within the statistical period.

### Description

| **Metric** | **Metric name** | **Unit** |
|---------|--------------------------|--------|
| application | ob_background_application_waitevent_cnt | N/A |

### Calculation expression

sum(ob_background_waitevent_cnt{wait_class="APPLICATION",@LABELS}) by (@GBLABELS)

### SQL statements for metric collection

OceanBase Database V4.2.2.0 and later but earlier than V4.3.0.0:

```sql
SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 1 group by wait_class, tenant_id
```

## configuration

### Definition

The number of active sessions that are waiting for events of the CONFIGURATION class within the statistical period.

### Description

| **Metric** | **Metric name** | **Unit** |
|---------|----------------------------|--------|
| configuration | ob_background_configuration_waitevent_cnt | N/A |

### Calculation expression

sum(ob_background_waitevent_cnt{wait_class="CONFIGURATION",@LABELS}) by (@GBLABELS)

### SQL statements for metric collection

OceanBase Database V4.2.2.0 and later but earlier than V4.3.0.0:

```sql
SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 1 group by wait_class, tenant_id
```

## administrative

### Definition

The number of active sessions that are waiting for events of the ADMINISTRATIVE class within the statistical period.

### Description

| **Metric** | **Metric name** | **Unit** |
|---------|---------------------------|--------|
| administrative | ob_background_administrative_waitevent_cnt | N/A |

### Calculation expression

sum(ob_background_waitevent_cnt{wait_class="ADMINISTRATIVE",@LABELS}) by (@GBLABELS)

### SQL statements for metric collection

OceanBase Database V4.2.2.0 and later but earlier than V4.3.0.0:

```sql
SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 1 group by wait_class, tenant_id
```

## concurrency

### Definition

The number of active sessions that are waiting for events of the CONCURRENCY class within the statistical period.

### Description

| **Metric** | **Metric name** | **Unit** |
|---------|---------------------------|--------|
| concurrency | ob_background_concurrency_waitevent_cnt | N/A |

### Calculation expression

sum(ob_background_waitevent_cnt{wait_class="CONCURRENCY",@LABELS}) by (@GBLABELS)

### SQL statements for metric collection

OceanBase Database V4.2.2.0 and later but earlier than V4.3.0.0:

```sql
SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 1 group by wait_class, tenant_id
```

## commit

### Definition

The number of active sessions that are waiting for events of the COMMIT class within the statistical period.

### Description

| **Metric** | **Metric name** | **Unit** |
|---------|---------------------------|--------|
| commit | ob_background_commit_waitevent_cnt | N/A |

### Calculation expression

sum(ob_background_waitevent_cnt{wait_class="COMMIT",@LABELS}) by (@GBLABELS)

### SQL statements for metric collection

OceanBase Database V4.2.2.0 and later but earlier than V4.3.0.0:

```sql
SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 1 group by wait_class, tenant_id
```

## network

### Definition

The number of active sessions that are waiting for events of the NETWORK class within the statistical period.

### Description

| **Metric** | **Metric name** | **Unit** |
|---------|---------------------------|--------|
| network | ob_background_network_waitevent_cnt | N/A |

### Calculation expression

sum(ob_background_waitevent_cnt{wait_class="NETWORK",@LABELS}) by (@GBLABELS)

### SQL statements for metric collection

OceanBase Database V4.2.2.0 and later but earlier than V4.3.0.0:

```sql
SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 1 group by wait_class, tenant_id
```

## user_io

### Definition

The number of active sessions that are waiting for events of the USER_IO class within the statistical period.

### Description

| **Metric** | **Metric name** | **Unit** |
|---------|---------------------------|--------|
| user_io | ob_background_user_io_waitevent_cnt | N/A |

### Calculation expression

sum(ob_background_waitevent_cnt{wait_class="USER_IO",@LABELS}) by (@GBLABELS)

### SQL statements for metric collection

OceanBase Database V4.2.2.0 and later but earlier than V4.3.0.0:

```sql
SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 1 group by wait_class, tenant_id
```

## system_io

### Definition

The number of active sessions that are waiting for events of the SYSTEM_IO class within the statistical period.

### Description

| **Metric** | **Metric name** | **Unit** |
|---------|---------------------------|--------|
| system_io | ob_background_system_io_waitevent_cnt | N/A |

### Calculation expression

sum(ob_background_waitevent_cnt{wait_class="SYSTEM_IO",@LABELS}) by (@GBLABELS)

### SQL statements for metric collection

OceanBase Database V4.2.2.0 and later but earlier than V4.3.0.0:

```sql
SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 1 group by wait_class, tenant_id
```

## cluster

### Definition

The number of active sessions that are waiting for events of the CLUSTER class within the statistical period.

### Description

| **Metric** | **Metric name** | **Unit** |
|---------|---------------------------|--------|
| cluster | ob_background_cluster_waitevent_cnt | N/A |

### Calculation expression

sum(ob_background_waitevent_cnt{wait_class="CLUSTER",@LABELS}) by (@GBLABELS)

### SQL statements for metric collection

OceanBase Database V4.2.2.0 and later but earlier than V4.3.0.0:

```sql
SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 1 group by wait_class, tenant_id
```

## other

### Definition

The number of active sessions that are waiting for events of the OTHER class within the statistical period.

### Description

| **Metric** | **Metric name** | **Unit** |
|---------|---------------------------|--------|
| other | ob_background_other_waitevent_cnt | N/A |

### Calculation expression

sum(ob_background_waitevent_cnt{wait_class="OTHER",@LABELS}) by (@GBLABELS)

### SQL statements for metric collection

OceanBase Database V4.2.2.0 and later but earlier than V4.3.0.0:

```sql
SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 1 group by wait_class, tenant_id
```
