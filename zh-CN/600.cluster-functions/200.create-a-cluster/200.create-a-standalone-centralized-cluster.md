# 新建单机集中式数据库

单机集中式是 OceanBase 为用户推出的极简数据库架构，相较于分布式集群，单机集中式仅需一台主机，部署简单，即开即用。本文将为您介绍如何创建单机集中式数据库。

## 背景信息

单机（集中式架构）仅有一份数据副本，当发生存储或者硬件故障时可能存在数据丢失风险，建议您对重要业务系统进行定期备份或者配置高可用方案，如租户主备库、多副本容灾等，避免单点故障。

## 前提条件

* 当前登录 OCP 的用户为 **ADMIN** 角色或 **ORG_ADMIN** 角色。

* 仅支持创建 V4.1.0 及以上版本的 OceanBase 数据库。

## 操作步骤

1. 登录 OCP 后，在左侧导航栏单击 **集群** ，进入 **集群** 总览页面。根据实际业务场景，找到新建集群的入口。

   1. 如果您没有可管理的集群，系统会在 **集群列表** 页签中提示您新建集群，直接在提示信息中单击 **创建集群** 。

   2. 如果您已经有可管理的集群，则在 **集群列表** 页签的右上角，单击 **创建集群** 。

2. 在 **创建集群** 页面，选择 **单机集中式** 。

3. 设置集群基础信息，填写说明如下表所示。

     |配置  |   描述   |
     |-----|-------|
     | **集群名称**          | 自定义待管理的集群的名称。集群名称必须以英文字母开头，可支持大小写字母、数字和下划线，长度为 2\~48 字符。|
     | **root@sys 密码**    | 支持自定义或随机生成。 密码需要满足以下复杂度条件：<ul><li>长度为 8\~32 个字符</li><li>至少包含数字（0\~9）、大写字母（A\~Z）、小写字母（a\~z）和特殊字符四种类型中的三种，支持的特殊字符为 <code>~!@#%^&*_-+=\|(){}[]:;,.?/</code>。  </li></ul>   |
     | **OceanBase 版本**         | 可以从列表中选择已有的 OceanBase 集群版本，也可以在列表下方单击 **添加版本** ，上传一个 OceanBase 的版本。  |
     | **Zone 名称**    | 可保持默认也可自定义。 Zone 名称必须以英文字母开头，支持大小写字母、数字和下划线，长度为 2\~48。 部署多 Zone 的 OceanBase 集群必须有一个 Zone 与主 Zone 的 Region 相同。  |
     | **主机**  | 选择与 **OceanBase 版本** 架构一致的主机，仅可选择一台主机作为 OBServer & rootserver。当下拉列表中无可选主机时，可进行 **添加主机** 的操作。   |
     | **负载类型**  | 支持为集群选择负载类型。负载类型主要影响 SQL 类查询判断时间（参数：large_query_threshold），对 OLTP 类型负载的 RT 可能存在较大影响，您需谨慎选择。OCP 共支持 5 种集群负载类型，具体说明如下。<ul><li>**Express OLTP**：适用于贸易、支付核心系统、互联网高吞吐量应用程序等工作负载。没有外键等限制，没有存储过程，没有长交易，没有大交易，没有复杂的联接，没有复杂的子查询。<br>版本限制：适用于 OceanBase V4.2.5 及以上版本。</li><li>**HTAP**：适用于混合 OLAP 和 OLTP 工作负载。通常用于从活动运营数据、欺诈检测和个性化建议中获取即时见解。<br>版本限制：适用于 OceanBase V4.2.5 及以上版本。</li><li>**OLAP**：用于实时数据仓库分析场景。<br>版本限制：适用于 OceanBase V4.3.0 及以上版本。</li><li>**Complex OLTP**：适用于银行、保险系统等工作负载。它们通常具有复杂的联接、复杂的相关子查询、用 PL 编写的批处理作业，以及长事务和大事务。有时对短时间运行的查询使用并行执行。<br>版本限制：适用于 OceanBase V4.2.5 及以上版本。</li><li>**OBKV**：用于键值工作负载和类似 hbase 的宽列工作负载，这些工作负载通常具有非常高的吞吐量并且对延迟敏感。<br>版本限制：适用于 OceanBase V4.2.5 及以上版本。</li></ul>   |

     ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/432/%E5%8D%95%E6%9C%BA%E5%9F%BA%E6%9C%AC%E8%AE%BE%E7%BD%AE.png)

4. 选择是否为集群开启 Cgroup。

   Cgroup 主要用于 OceanBase 集群内租户之间以及租户内的 CPU 资源隔离。当您创建的 OceanBase 集群为 V4.0 及以上版本时，系统会默认开启 Cgroup，以实现更强的 CPU/IOPS 隔离性。开启 Cgroup 会造成大约 7% 的性能下降，若您的业务场景为单租户、小规格（<14C）以及需要更高的数据库性能时，建议您关闭 Cgroup。同时，若主机上的操作系统内核版本低于 4.1.9，集群将无法创建租户，此时系统将默认关闭 Cgroup 且不显示 Cgroup 开关。

5. 打开 **CPU 超卖设置** 模块，配置 CPU 超卖额度。您可通过滑动块或输入框配置超卖比例，默认值为 120%，取值范围为 101%~200%。

   系统不同的租户负载可以有控制地交错运行，配置 CPU 资源时可以进行超卖设置来提升资源利用率。如果不同业务场景的负载出现交叠，OceanBase 集群在运行过程中可能会产生负载过载等情况，会出现不同租户间进行线程竞争 CPU 的现象，进而导致实际业务场景变慢。

    <main id="notice" type='explain'>
    <h4>说明</h4>
    <p><ul><li>仅 OceanBase 4.0 及其以上版本支持对 CPU 进行超卖分配，在合理配置下，您可以充分地利用硬件资源。</li><li>CPU 超卖功能依赖 Cgroup，在配置 CPU 超卖额度前，请先为集群开启 Cgroup。</li></ul>
    </p></main>

   ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/430/%E8%B6%85%E5%8D%96%E8%AE%BE%E7%BD%AE.png)

6. 打开 **参数设置** 模块，并配置集群参数。

   如您对集群级别的 CPU、内存、数据盘以及日志盘的使用有定制化变更诉求，请设置参数：<code>cpu_count</code>（默认值：自动调整）、 <code>memory_limit_percentage</code>（默认值：80%）、<code>system_memory</code>（默认值：30GiB）、 <code>data_disk_usage_limit_percentage</code>（默认值：90%）、<code>datafile_size</code>、<code>clog_disk_usage_limit_percentage</code>（默认值：90%）、<code>log_disk_size</code>，具体参数说明请参考 OceanBase 官网 <a href="https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000640281">集群配置项总览</a>。

    * 当您在 **基本设置** 中配置了负载类型时，系统将默认选择与负载类型对应的参数模板。

    * 您可通过如图 ① 处，逐个添加启动参数项并为其配置值。

    * 也可通过如图 ② 处，单击 **选择参数模板** ，然后选择一个参数模板，系统会将模板中的参数连同配置自动填充到此处。在未创建集群参数模板的情况下，您可单击 新建集群模板，为集群创建参数模板，详情可参考 [集群参数模板管理](../1200.cluster-parameters-template-management.md)。

    系统提供如下 6 种内置模板，模板中包含了常用的参数设置，您可直接应用该模板进行集群的初始化设置。关于系统内置模板，具体说明如下。

   | 模板 |  说明 |
   |------|------|
   | COMPLEX_OLTP 默认参数模板   | 对应 **Complex OLTP** 负载类型，该模板仅适用于 OceanBase V4.2.5 及以上版本。   |
   | HTAP 默认参数模板   |   对应 **HTAP** 负载类型，该模板仅适用于 OceanBase V4.2.5 及以上版本。 |
   | KV 默认参数模板   |  对应 **OBKV** 负载类型，该模板仅适用于 OceanBase V4.2.5 及以上版本。   |
   | EXPRESS_OLAP 默认参数模板 |  对应 **Express OLAP** 负载类型，该模板仅适用于 OceanBase V4.2.5 及以上版本。 |
   | OLAP 默认参数模板   |  对应 **OLAP** 负载类型，该模板仅适用于 OceanBase V4.3.0 及以上版本。   |
   | 2.2.77 默认参数模板   |   OceanBase 集群 V2.2.77 版本推荐使用的参数设置，供生产环境使用。   |

   ![09161737](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/430/%E5%8F%82%E6%95%B0%E6%A8%A1%E6%9D%BF.png)

7. 打开 **自定义配置**，对路径及端口进行配置 。

   * 配置路径：
      1. 在 **路径配置** 模块，根据需要自定义 **软件安装路径**、**数据盘路径** 和 **日志盘路径** 。
      2. 配置完成后，单击 **测试**，校验路径是否可用。若不可用，您可根据测试结果进行排查，或将路径修改为其它可用路径。

      <main id="notice" type='notice'>
      <h4>注意</h4>
      <p>生产环境下，OceanBase 数据库建议日志盘空间为主机内存空间的三倍以及以上；同时，为了避免出现性能问题，不建议数据目录和日志目录挂载在同一块磁盘上。</p>
      </main>

   * 配置端口：
      1. 在 **端口配置** 模块，自定义 **SQL 端口** 和 **RPC 端口**。
      2. 配置完成后，单击 **测试**，校验端口是否已被占用。若被占用，您需重新配置可用端口。

    ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/410/%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%BE%E7%BD%AE.png)

8. 测试成功后，单击 **提交** 。

9. 在右侧面板中确认信息是否无误，单击 **确定** 。

10. 在弹出的 **创建租户提醒** 对话框中，选择是否需要创建一个普通租户。

    * 若不需要创建租户，可单击 **跳过**。此时将仅创建集群而不创建租户，后续可参考 [新建租户](../../500.quickstart/600.quickstart-create-a-tenant.md) 自行创建普通租户。
    * 若需要创建租户，则需配置租户模式及租户名。配置完成后单击 **创建并提交**，您可在 **任务中心** 中查看相关任务的执行进度。

      相关配置信息如下：

      |配置  |   描述   |
      |-----|-------|
      | 租户模式 | 提供切换租户模式的选择，默认 MySQL。|
      | 租户名称 | 默认与租户模式保持一致，支持自定义。  |

    ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/410/%E5%88%9B%E5%BB%BA%E7%A7%9F%E6%88%B7%E6%8F%90%E9%86%92.png)
