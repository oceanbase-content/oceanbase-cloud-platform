# 新建备集群

如果您有一个主集群，您可以为当前集群创建一个备用集群。

<main id="notice" type='notice'>
<h4>功能适用性</h4>
<p>该内容仅适用于 OCP 企业版，OCP 社区版仅支持新建主集群。</p>
</main>

## 前提条件

* 请确保当前登录账号具备集群的管理权限。
* 主集群版本为 V2.2.50 以上及 V4.0.0 以下。

## 操作步骤

1. 登录 OCP 。

2. 在左侧导航栏单击 **集群**，进入 **集群** 页面。

3. 您可以通过以下 2 种方式进入创建备集群的页面。

   * 在 **集群** 页面的右上角，单击 **新建集群** ，然后在 **新建集群** 页面，选择 **集群类型** 为 **备集群** ，并在 **主集群** 列表中选择对应的主集群。

   * 在 **集群** 页面的 **集群列表** 区域，选择待添加备集群的集群并单击其集群名，单击 **概览** 页面的右上角的 **...** ，选择 **新建备集群** 。

4. 在 **新建集群** 页面，设置备集群基础信息。

   ![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/401/Image%209.png)

   基础信息填写说明如下标所示：

     |       配置       |                                                                                         描述                                                                                          |
     |----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
     | **集群类型**       | 选择 **备集群** ，请确保主集群已创建。                                                                                                                                                              |
     | **主集群**        | 选择主集群，系统将创建属于该主集群的备集群。                                                                                                                                                              |
     | **备集群 OceanBase 版本**  | 选择与主集群一样的 OceanBase 版本。 <ul><li> 若列表中有该版本，则从列表中直接选择。   </li><li> 否则，可通过单击列表下方的 **添加版本** 来上传。</li> </ul>   |

5. 设置集群的部署模式信息。

   默认是添加 3 个Zone的信息，如果您希望部署的集群 Zone 的个数大于 3 个，您可以在下方单击 **新增** 按钮，增加 Zone 信息。

   如果部署的集群 Zone 的个数小于 3 个，您可以单击 Zone 后面的删除图标。

   ![p199912](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/401/%E5%A4%87%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%BC%8F1.png)

   每个 Zone需要配置的信息及说明如下表所示。

   |   配置   |  描述   |
   |-----|-------|
   | **Zone 名称**    | 可保持默认也可自定义。 Zone 名称必须以英文字母开头，支持大小写字母、数字和下划线，长度为 2\~48。 部署多 Zone 的 OceanBase 集群必须有一个 Zone 与主 Zone 的 Region 相同。  |
   | **机房**     | Zone 所在的机房，一个 Zone 只能存在于一个机房。  |
   | **机型**    | 可选项。 如果选择了机型，后面主机列表会根据机型进行过滤。   |
   | **CPU 架构**    |  当选择的 **OceanBase 版本** 中存在多个不同架构的安装包时，需选择匹配此软件包的主机硬件架构。<blockquote>**注意**</br><ul><li>默认架构类型为第一个安装包的架构类型，支持切换。切换指定架构后，**主机** 列表中即展示该架构的主机。</li><li>若为不同的 Zone 设置不同的架构时，混合架构部署模式可能存在稳定性与性能问题，请谨慎操作。</li></blockquote> |
   | **主机**  | 您可以选择多个主机，或进行添加主机的操作。   |
   | **Root Server 位置**     | 您需选择一个 IP 作为 RootService 所在的机器。多副本的 OceanBase 集群，其每个 Zone 都需指定一个 root Server。   |

6. 打开 **参数配置** 模块，并配置集群参数。

    * 您可通过如图 ① 处，逐个添加启动参数项并为其配置值。

    * 也可通过如图 ② 处，单击 **选择参数模板** ，然后选择一个参数模板，系统会将模板中的参数连同配置自动填充到此处。

    <main id="notice" type='explain'>
    <h4>说明</h4>
    <ul>
    <li>当 OceanBase 版本为 V2.2.77 时，推荐您使用系统内置的 <strong>2.2.77 Version Parameter Template</strong> 参数模板。模板中包含了 OceanBase V2.2.77 的常用参数设置，您可直接应用该模板进行集群的初始化设置。</li>
    <li>在未创建集群参数模板的情况下，您可单击 <strong>新建集群模板</strong>，为集群创建参数模板，详情可参考 <a href="../1200.cluster-parameters-template-management.md">集群参数模板管理</a>。</li>
    </ul>
    </main>

   ![09161737](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/401/%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE1.png)

7. 打开 **自定义配置**，对路径及端口进行配置 。

   * 配置路径：
      1. 在 **路径配置** 模块，根据需要自定义 **软件安装路径**、**数据盘路径** 和 **日志盘路径** 。
      2. 配置完成后，单击 **测试**，校验路径是否可用。若不可用，您可根据测试结果进行排查，或将路径修改为其它可用路径。

         ![11](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/401/%E9%85%8D%E7%BD%AE%E8%B7%AF%E5%BE%841.png)

   * 配置端口：
      1. 在 **端口配置** 模块，自定义 **SQL 端口** 和 **RPC 端口**。
      2. 配置完成后，单击 **测试**，校验端口是否已被占用。若被占用，您需重新配置可用端口。

         ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/401/%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE1.png)

8. 完成后，单击 **提交** 。

9. 在弹出的 **确认提交信息** 对话框中，确认信息无误后，单击 **确定** 。
