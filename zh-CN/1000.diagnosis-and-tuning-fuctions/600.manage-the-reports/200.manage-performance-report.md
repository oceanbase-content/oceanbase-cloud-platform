# 管理性能报告

本页面为您介绍性能报告的使用方法。性能报告能帮助用户了解指定时间段内的集群负载、性能、SQL 等信息，方便用户了解集群运行状态，也有助于用户排查性能相关问题。

<main id="notice" type='notice'>
  <h4>功能适用性</h4>
  <p>OCP V4.2.1 社区版暂不支持集群性能报告。</p>
</main>

## 性能报告介绍

OCP 当前支持生成集群性能报告，您可在报告列表页面查看性能报告的 **报告名** 、 **起始快照点** 、 **结束快照点** 、 **创建人** 、 **生成状态** 、 **生成时间** ，并进行 **查看报告** 和 **下载报告** 的操作。

* 可根据 **起始快照点** 、 **结束快照点** 、 **生成时间** 的时间顺序对报告进行排序。

* 可根据 **生成状态** 对报告列表进行筛选。

您可通过以下两个入口查看及管理性能报告：

* **入口一：**

    登录 OCP，进入集群 **概览** 页面。在左侧单击 **性能报告** 。

* **入口二：**

    登录 OCP，进入集群 **实时诊断** 页面。在左侧单击 **报告中心**，进入 **性能报告** 页签。

## 操作步骤

以下步骤以 **入口二** 为例。

1. 1. 登录 OCP。

2. 在左侧导航栏中，单击 **自治服务**。

3. 在 **集群详情** 区域，单击需要查看的集群名称，系统默认进入 **实时诊断** 页面。

4. 单击左侧导航栏 **报告中心**。

5. 进入 **活跃会话报告** 页签下。

6. 单击 **生成活跃会话报告** 。

7. 在弹出框中填写如下信息。
   ![07062023](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9345265261/p292019.png)

   |  参数   |                     说明                      |
   |-------|---------------------------------------------|
   | 报告名   | 报告名不能为空。                                    |
   | 起始快照点 | 只支持选择近 30 天内的时刻点，可选择的时刻点固定，不支持自定义修改。        |
   | 结束快照点 | 仅支持选择起始快照点后的 24 小时内的时刻点，可选择的时刻点固定，不支持自定义修改。 |

8. 当性能报告中租户级的 SQL 类监控数据异常时，可在 **前往租户活跃会话历史报告** 下拉框中选择并单击对应的租户，可跳转到该租户的 **活跃会话历史报告** 页面。

   ![09141847](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4879591361/p326763.png)

9. 单击 **确定** 。将为您生成在起始快照点和结束快照点内的性能报告。OCP 支持保存最近 90 天的性能报告，您可在报告列表中进行查看及下载。

   * 查看性能报告：单击 **操作** 列的 **查看报告** ，在先查看性能报告。

   * 下载性能报告：单击 **操作** 列的 **下载报告** ，即可将 html 格式的性能报告下载到本地。

## 报告内容简介

您可在性能报告中查看如下信息：

* 基本信息

  |    参数    | 说明    |
  |----------|---------|
  | 集群基本信息   | 可查看起始快照点和结束快照点的集群版本、集群类型、主机数量、租户数量、最近一次合并开始时间和最近一次合并结束时间等信息。 <blockquote>**说明**</br>当 OceanBase 为 V4.0 及以上版本时，不支持查看合并相关信息。</blockquote>   |
  | 节点基本信息   | 可查看主机 IP、所属 Zone、起始快照点和结束快照点是否包含 RS、状态、开始提供服务时间、上次下线时间。                                                      |
  | 节点资源信息   | 可查看主机 IP、所属 Zone、CPU 总量（核）、CPU 已分配（核）、CPU 已分配（%）、内存总量（MB）、内存已分配（MB)、内存已分配（%）、磁盘总量（GB)、磁盘已使用（GB）、磁盘已使用（%）等信息。 |
  | 节点数据分区信息 | 可查看主机 IP、所属 Zone、关联租户、数据分区数量和 Leader 分区数量等信息。其中数据分区数量包含了 Leader 分区数量。  <blockquote>**说明**</br>当 OceanBase 为 V4.0 及以上版本时，不支持查看节点数据分区信息。</blockquote>  |
  | 租户资源信息   | 可查看租户名、租户 ID、租户类型、资源单元配置、Zone 优先级、Locality 和服务器列表等信息。                                                        |
  | 租户数据容量信息 | 可查看关联租户、租户 ID、关联主机、数据容量等信息。                                                                                  |

* 工作负载统计信息：您可查看集群工作负载统计信息，包括 **指标、累计值、开始值、结束值、最大值、最大值出现时间、最小值、最小值出现时间** 和 **平均值** 。关于指标您可参考 [监控指标概述](../../1900.reference-guide/300.monitoring-indicator-reference/100.overview-of-metrics.md) 理解。

* 等待事件统计信息：您可查看集群及租户范围内容累计等待时长 Top 10 的等待事件，统计信息包括 **事件名称、事件所属分类、累计等待时长、累计等待次数、累计等待超时次数**。

* 路由统计信息：您可查看租户下的路由统计信息，包括 **路由命中率、路由命中数** 和 **路由不命中数**。

* SQL 统计信息

  |         参数         |                                                                          说明                                                                           |
  |--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
  | 按照总响应时间排序的 SQL     | <ul><li>收集集群范围内总响应时间 Top30 的 SQL。</li><li> 收集租户范围内总响应时间 Top30 的 SQL。</li></ul>         |
  | 按照 CPU 时间排序的 SQL   | <ul><li>收集集群范围内 CPU 时间 Top30 的 SQL。</li><li> 收集租户范围内 CPU 时间 Top30 的 SQL。 </li></ul>     |
  | 按照 IO 等待时间排序的 SQL  | <ul><li>收集集群范围内 IO 等待时间 Top30 的 SQL。</li><li> 收集租户范围内 IO 等待时间 Top30 的 SQL。  </li></ul>  |
  | 按照网络等待时间排序的 SQL    | <ul><li>收集集群范围内网络等待时间 Top30 的 SQL。</li><li>收集租户范围内网络等待时间 Top30 的 SQL。    </li></ul>    |
  | 按照逻辑读行数排序的 SQL     | <ul><li>收集集群范围内逻辑读行数 Top30 的 SQL。</li><li> 收集租户范围内逻辑读行数 Top30 的 SQL。   </li></ul>       |
  | 按照物理读行数排序的 SQL     | <ul><li>收集集群范围内物理读行数 Top30 的 SQL。</li><li> 收集租户范围内物理读行数 Top30 的 SQL。   </li></ul>      |
  | 按照执行次数排序的 SQL      | <ul><li>收集集群范围内执行次数 Top30 的 SQL。</li><li> 收集租户范围内执行次数 Top30 的 SQL。 </li></ul>           |
  | 按照远程计划执行次数排序的 SQL  | <ul><li>收集集群范围内执行次数 Top30 的 SQL。</li><li> 收集租户范围内执行次数 Top30 的 SQL。   </li></ul>         |
  | 按照分布式计划执行次数排序的 SQL | <ul><li>收集集群范围内执行次数 Top30 的 SQL。</li><li>收集租户范围内执行次数 Top30 的 SQL。    </li></ul>        |
  | 按照影响行数排序的 SQL      | <ul><li>收集集群范围内影响行数 Top30 的 SQL。</li><li> 收集租户范围内影响行数 Top30 的 SQL。   </li></ul>         |
  | 完整的 SQL 文本列表       | 集中展示上述 SQL 语句信息。 |

* 内存统计信息：您可查看集群下租户的内存统计信息，包括 **上下文标识、内存使用量（字节）、内存申请的平均大小（字节）、内存使用最大值（字节）、内存使用最大值的时间、内存使用最小值（字节）** 和 **内存使用最小值的时间**。

* 缓存统计信息

  该模块统计租户平均 KV 缓存命中率，统计数据来源于 OceanBase 视图 gv$systat，命中率结果保留小数点后两位。

  为您统计了 7 大类缓存的统计信息，包括：Block Cache 、Block Index Cache、Clog Cache、Clog Index Cache 、BloomFilter Cache 、Location Cache 和 Row Cache。
  统计信息包括：缓存命中率、缓存请求次数、缓存大小。
  
   <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>在统计报告中，将光标悬停于统计表的表头参数名上，您可查看到该参数的详细解释。</p>
   </main>
  
  |  参数   |                                                                            说明                                                                            |
  |-------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
  | 缓存命中率 | 快照时间内，各租户不同类型的缓存命中率。关于这些缓存类型，您可参考 [缓存机制](https://www.oceanbase.com/docs/oceanbase-database/oceanbase-database/V3.2.1/caching-mechanism)。 |
  | 缓存请求  | 统计快照时间内，各租户的缓存和请求信息，包括请求次数，缓存命中数和未命中数。                                                                                                                   |
  | 缓存大小  | 统计快照期间内，各租户不同类型的缓存大小，包括起止位置。                                                                                                                             |

* RPC 统计信息

   <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>在统计报告中，将光标悬停于统计表的表头参数名上，您可查看到该参数的统计信息来源。</p>
   </main>
  
  |         参数         |                                    说明                                     |
  |--------------------|---------------------------------------------------------------------------|
  | 整体 RPC             | 从租户和主机维度分别统计了 RPC 收发数量及大小、RPC 的网络延迟和发送失败数。并以收发 RPC 大小进行排序，展示 Top10 的统计信息。 |
  | 包代码 RPC            | 统计并展示按照包代码聚合的 Top10 的 RPC 信息。                                             |
  | Clog RPC           | 从租户和服务器维度分别统计了 Clog RPC 信息。包含请求次数、成功请求次数、成功请求总耗时。                         |
  | GTS RPC            | 从租户和服务器维度分别统计了 GTS RPC 数。                                                 |
  | Location Cache RPC | 从租户和服务器维度分别统计了 Location Cache RPC 信息。包含缓存刷新总次数、RPC 刷新缓存次数、RPC 刷新缓存失败次数。   |

* 锁统计信息

  |    参数    |                                                                                                                                                                                                                                                                               说明                                                                                                                                                                                                                                                                               |
  |----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
  | 行锁统计     | 可查看租户内行锁申请次数、等待次数、超时次数和等待时间等信息。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
  | Latch 统计 | 可查看租户内发生闩锁（Latch）的相关统计，统计内容如下：  <ul><li>Get：以 Willing-to-wait 类型请求一个 latch 的成功次数。</li><li> Miss：以 Willing-to-wait 类型请求一个 latch 的失败次数。   </li><li> Sleep：以 Willing-to-wait 类型请求一个 latch 失败后进入休眠的次数。</li><li>  Spin Get：租户内总共发生 Spin 的次数。   </li><li> Immediate Get：以 Immediate 类型请求一个 latch 成功的次数。</li><li>  Immediate Miss：以 Immediate 类型请求一个 latch 不成功的次数。  </li></ul>   |

* 参数配置变化

  该模块统计快照期间，统计不同维度（集群、Zone、服务器和租户）的参数变化情况，包括参数、参数当前值和修改时间。
  
