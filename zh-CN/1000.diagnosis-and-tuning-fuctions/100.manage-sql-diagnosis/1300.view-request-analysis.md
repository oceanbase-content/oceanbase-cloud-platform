查看 SQL 请求分析
================================

本节为您介绍如何通过 SQL 类型执行次数的占比和耗时分布来了解整体 SQL 执行情况，SQL 请求分析的数据来自 TopSQL。

前提条件
-------------------------

* 对于 MySQL 模式的租户，需要 OCP 用户的密码箱里具有该租户的密码。

* 对于 Oracle 模式的租户，需要 OCP 用户的密码箱里具有该集群 SYS 租户的密码。

操作步骤
-------------------------

您可通过如下两个入口查看 SQL 请求分析：

* 入口一：登录 OCP，在左侧导航栏单击 **自治服务**，选择需要查看的集群，进入集群 **实时诊断** 页面。

* 入口二：登录 OCP，进入租户 **概览** 页面，在左侧导航栏单击 **SQL 诊断**。

以下操作步骤以 **入口一** 为例。

1. 在左导航栏单击 **自治服务** ，并在 **集群详情** 中单击集群名进入集群 **实时诊断** 页面。

2. 系统默认进入 **SQL 诊断** 页签。

3. 单击 **查看请求分析** 按钮。

   进入请求分析详情页面，您可查看执行耗时分布趋势图和请求执行列表。系统默认展示近 30 分钟的数据，当修改统计时间时， **执行耗时分布** 和 **请求统计列表** 会同步按照所选时间进行更新。

4. 查看执行耗时分布图。

   **执行耗时分布** 展示了在选定的时间范围内 SQL 的执行耗时分布。系统默认展示全部 SQL ，您可通过选择 SQL 类型（包括 select、insert、update、delete 、replace 和其他），查看不同 SQL 的执行耗时分布。

   执行耗时分为了7个区间，每分钟计算一次，区间划分说明如下。

   |     区间      |  说明  ||
   |-------------|---|---|
   | \[0,1\]ms   | 指满足 0ms ≤ 执行耗时 ≤ 1ms SQL执行次数占比。 ||
   | (1,2\]ms    | 指 1ms \< 执行耗时 ≤ 2ms SQL执行次数占比。 ||
   | (2,3\]ms    | 指 2ms \< 执行耗时 ≤ 3ms SQL执行次数占比。 ||
   | (3,10\]ms   | 指 3ms \< 执行耗时 ≤ 10ms SQL执行次数占比。 ||
   | (10,100\]ms | 指 10ms \< 执行耗时 ≤ 100ms SQL执行次数占比。 ||
   | (0.1,1\]s   | 指0.1s \< 执行耗时 ≤ 1s SQL 执行次数占比。 ||
   | \>1s        | 指执行耗时 \> 1s SQL执行次数占比。 ||

   ![Image 181](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9913489461/p429737.png)

5. 查看请求分析列表。

   **请求分析列表** 展示了数据库请求的平均响应时间、响应时间占比、执行次数、执行次数占比和执行趋势（平均响应时间的执行趋势）。您可对请求分析列表进行如下操作：
   * 根据数据库类型对数据库进行筛选。

   * 系统默认按照响应时间占比进行排序，您可根据平均响应时间、响应时间占比、执行次数、执行次数对数据库进行占比排序。

   * 系统默认展示全部 SQL ，您可通过图中 ① 处选择 SQL 类型，查看不同 SQL 的执行耗时分布。

   * 点击图中 ② 处的 **导出请求统计** 按钮，可将该请求分析列表以 Excel 形式导出。

   ![Image 182](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9913489461/p429738.png)
