# 诊断新增 SQL

新增 SQL 指在查询区间往前一段时间（默认 7 天）没有执行过，但是在查询区间内有执行记录的 SQL。本节为您如何对新增 SQL 进行诊断。

<main id="notice" type='notice'>
    <h4>功能适用性</h4>
    <p>该内容仅适用于 OCP 企业版，OCP 社区版不提供此功能。</p>
</main>

## 操作步骤

1. 登录 OCP。

2. 在左侧导航栏中，单击 **自治服务**。

3. 在 **集群详情** 区域，单击需要查看的集群名称。

4. 默认进入 **实时诊断** 的 **SQL 诊断** 页面。

5. 单击 **新增 SQL** 页签。

6. 配置筛选条件，对新增 SQL 进行筛选。

     * 时间范围：可在 **时间范围** 下拉框中选择 近 5 分钟、近 10 分钟、近 20 分钟、近 30 分钟、近 1 小时、近 3 小时、近 6 小时来快速选择时间范围；也可在下拉框中选择自定义时间，并配置开始时间和结束时间。默认显示近 6 小时内的信息。

    * OBServer：选择 OBServer 节点，查询时将只查询在该 OBServer 节点上执行的 SQL。

     * 内部 SQL：若勾选，则查询结果中会包含由 OceanBase 内部发起的 SQL。

     * 关键词：查询结果中会显示 SQL 文本中包含该关键词的 SQL。匹配方式与 SQL 的 like 相同，且默认自动在输入的字符串前后加了 % 符号。

     * 高级条件： **高级条件** 支持同时添加多个过滤条件。单击 **添加** ，在 **添加高级条件** 面板中对指标、运算符和值进行配置，查询时将获取指标满足条件的 SQL 展示在查询结果列表中。

7. 单击 **查询** ，下方列表中将展示所有符合查询条件的 SQL。您可对所查询的新增 SQL 进行如下操作：

      1. 单击 **列管理** ，在面板中选择需要查看的信息。勾选完成后即可在新增 SQL 列表中查看到相关结果。

      2. 在 **新增 SQL** 页签下， 可查看上一步骤选择的列信息。支持复制 SQL 文本，并根据数据库对 SQL 文本进行筛选。

      3. 单击 SQL 文本，您可进入 **SQL 详情** 页面，查看该 SQL 的详细信息，包括：

        * 在 **SQL 文本** 处查看 SQL 的完整语句。

        * 在 **优化建议** 处查看对于该 SQL 的优化建议，详见 [查看优化建议](../100.manage-sql-diagnosis/1000.view-sql-details.md)。

        * 在 **历史趋势** 页签，查看该 SQL 的 SQL 运行趋势图和 SQL 计划生成趋势图，详见 [查看 SQL 运行的历史趋势](../100.manage-sql-diagnosis/1000.view-sql-details.md)。

        * 在 **执行计划** 页签，查看该 SQL 的执行计划，或为其绑定执行计划，详见 [查看 SQL 的执行计划](../100.manage-sql-diagnosis/1000.view-sql-details.md)。

        * 在 **索引** 页签，查看该 SQL 绑定的索引，详见 [查看和绑定索引](../100.manage-sql-diagnosis/1000.view-sql-details.md)。

        * 在 **SQL 限流** 页签，查看该 SQL 的限流情况，或为其设置限流，详见 [设置 SQL 限流](../100.manage-sql-diagnosis/1000.view-sql-details.md)。

    ![Image 178](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/410/%E6%96%B0%E5%A2%9E%20SQL.png)
