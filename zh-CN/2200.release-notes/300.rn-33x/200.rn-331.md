# OCP V3.3.1

#RNDate#2022-05-24

OceanBase 云平台（OceanBase Cloud Platform，OCP）新版本主要针对 SQL 诊断功能进行升级，并新增主备库解耦等丰富的能力，同时对其它功能进行细节优化。

## V3.3.1

### 版本信息

* **版本号：** V3.3.1

* **前置版本：** V3.3.0

* **版本发布日期：** 2022年 5 月 24 日

* **支持的升级路径：** 对于 OCP V2.3.x 及之后版本，均可以直接升级到本版本。对于 OCP V2.3.0 之前版本，需要首先升级到 V2.3.x 版本，然后再升级到本版本。

### 支持的 OceanBase 数据库版本

OCP V3.3.1 版本支持下表所列版本的 OceanBase 数据库。

* OceanBase V1.4.x

* OceanBase V2.1.x

* OceanBase V2.2.x

* OceanBase V3.1.x

* OceanBase V3.2.x

### 新增功能

* **白屏 VPC 功能**

  * 主机类型增加 ECS 类型。您可在主机列表、导入主机或 OceanBase/OBProxy 创建和扩容操作中选择主机类型为 ECS。

  * 前端页面在主机、OceanBase 集群、OBProxy 集群等场景下增加网络属性展示。

  * OceanBase 集群运维、OBProxy 集群运维场景可以根据网络类型筛选主机。

* **多条件告警功能**

  * 可黑屏配置多个监控指标的告警表达式，支持 and、or 关系运算符。

  * 支持在多个监控指标的告警详情页中展示多个监控指标图表。

  * 白屏修改多监控指标告警时会提示"无法编辑"。

  * 将 OAS 告警项内置，方便与 OAS 无缝对接。

* OAS 数据查询能力

  * 强化监控查询功能，以便更好地支持 OAS。支持如下多条件表达式，同时支持 round 函数。

    * =（等价于:）

    * !=

    * =\~（正则匹配）

    * !\~（非正则匹配）

  * log trace 功能新增 kern.log 日志收集。

  * 新增若干监控数据收集，包括 io_await 和 partition_iutil 等，以满足 OAS 需求。

* 国际化文档

  支持简体中文和英文两语言，并适配不同语言环境下的展示效果，保证国际化使用体验。
  
### 修复的问题

OCP V3.3.1 版本修复了以下问题：

* 在过高压力（20000 qps) 下出现 FullGC 的问题。

* 备份恢复中删除抽检策略成功后报错的问题。

* ARM 架构下, OCP 由 V3.2.3 升级到高版本时, agent 升级步骤报错的问题。

* 通过 OCP V3.3.0 将 ob2230 升级到 ob3230 时报错的问题。

* **只读集群** 可修改租户副本的问题。

* 修复 NTP 服务在容器环境下误告警的问题。

* 租户 Primary Zone 信息未同步更新的问题。

* 无法通过 OCP 在 ob1479 上创建租户的问题。

* Python 告警脚本模板已过时的问题。

* sys 租户长期存在 SlowSQL 告警的问题。

* 告警的跳转逻辑问题。

* SQL 诊断中响应占比之和不为 100% 的问题。

* 其他一些 SQL 诊断、监控、告警在特定情况下出现的使用问题。

* 若干前端页面交互的问题。

### 已知问题

| 编号 |                     已知问题                      |           规避方法           |
|----|-----------------------------------------------|--------------------------|
| 1  | 创建 Oracle 租户，设置 nls_comp 参数为 A NSI 时创建租户任务失败。 | 暂时不影响业务，建议创建租户时暂不要使用该参数。 |
| 2  | OCP 升级时，agent 已重装成功，但升级过程仍然报错。                | 暂时不影响业务，可不规避。            |
| 3  | 拓扑图停止 observer 进程后，没有拉起进程的选项。                 | 暂时不影响业务，可不规避。            |

### 版本使用限制

* 硬件要求

OCP-Server 可以安装在物理机上，也支持安装运行在 Docker 容器中。OCP-Server 支持多节点高可用部署模式。

OCP-Server 节点最低硬件要求如下表所示。

| 硬件  |                 要求                 |
|-----|------------------------------------|
| CPU | <li>X86_64，8 核</li><li>ARM aarch 64 架构，8 核</li> |
| 内存  | 可用内存 16 GB                         |
| 网卡  | 万兆网卡                               |

OCP-Agent 自身占用资源很少，对安装节点硬件资源没有特别要求。

* 操作系统要求

安装 OCP 服务端（含 OCP-Agent）的操作系统要求如下表所示。

|    服务器类型    |    操作系统    |   支持版本    |
|-------------|------------|-----------|
| x86_64      | RHEL       | 7.2 及以上版本 |
| x86_64      | CentOS     | 7.2 及以上版本 |
| x86_64      | AliOS      | 7.2 及以上版本 |
| x86_64      | openSUSE   | 12SP3 及以上 |
| ARM aarch64 | AliOS      | 7.2 及以上版本 |
| ARM aarch64 | 中标麒麟       | 7.6       |
| ARM aarch64 | 华为 EulerOS | 2.0 SP8   |

* 客户端要求

一般用户会通过 Web 浏览器来访问 OCP 服务，故对客户端的要求如下所示。

|   浏览器   | 最小版本 |
|---------|------|
| Chrome  | 81   |
| Firefox | 64   |
| Safari  | 10   |
| Edge    | 13   |

如果您需要通过 iOS 操作系统的设备来访问 OCP，版本要求如下表所示。

| 操作系统 | 最小版本 |
|------|------|
| iOS  | 10   |

为了具备最佳的使用体验，推荐使用分辨率大于 1440 x 810 的显示器。

## V3.3.1 BP

### 版本信息

* **版本号：** V3.3.1 BP

* **前置版本：** V3.3.1

* **版本发布日期：** 2022年 7 月 8 日

* **支持的升级路径：** 对于 OCP V2.3.x 及之后版本，均可以直接升级到本版本。对于 OCP V2.3.0 之前版本，需要首先升级到 V2.3.x 版本，然后再升级到本版本。

### 新增功能

* 会话管理展示 client 端口信息。

* AWR 报告中展示 IO 统计信息。

### 修复的问题

OCP V3.3.1 BP 版本修复了以下问题：

* 集群健康巡检的主机时间中，SSH 延迟信息显示为 undefinedms 的问题。

* 服务器 CPU system 使用率过高的误告警问题。

* SQL 诊断页面产生大量 SQL-ID 导致查询变慢的问题。

* OCP V3.3.1 pom 遗漏 ocp-obcloud-service module 的问题。

* OBConnector 的初始化单线程导致 init timeout 的问题。
