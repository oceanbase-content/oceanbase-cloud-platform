# OCP V3.1.2

#RNDate#2021-07-13

OceanBase 云平台（OceanBase Cloud Platform，OCP）V3.1.2 版本新增了活跃会话历史报告，该功能是性能诊断模块的新功能，提供数据库历史活跃会话信息，辅助用户进行租户性能诊断。该版本的备份恢复支持二次备份。同时也优化了 OCP 不同权限用户的可视化内容，使用户所见即所得。新增接管 OBProxy 的功能，实现了接管链路的完整性。除此之外，其他功能也做了优化和加强，SQL 诊断部分增加导出功能，方便您下载分析问题。

## 版本信息

* **版本号：** V3.1.2

* **前置版本：** V3.1.1

* **版本发布日期：** 2021 年 9 月 29 日

* **支持的升级路径：** 对于 OCP V2.3.x 及之后版本，均可以直接升级到本版本。对于 OCP V2.3.0 之前版本，需要首先升级到 V2.3.x 版本，之然后再升级到本版本。

## 支持的 OceanBase 数据库版本

OceanBase 云平台 V3.1.2 版本支持下表所列版本的 OceanBase 数据库。

* OceanBase V1.4.x

* OceanBase V2.1.x

* OceanBase V2.2.x

* OceanBase V3.1.x

* OceanBase V3.2.x

## 新增功能

* 支持生成和下载活跃会话历史报告。

  活跃会话历史报告作为租户性能诊断功能的一部分，从 SQL、会话、等待事件、系统统计信息等相关视图中采样，帮助用户看到数据库历史活跃会话信息。详情请参见 [管理活跃会话历史报告](https://www.oceanbase.com/docs/enterprise-oceanbase-ocp-cn-10000000000380271)。
  
* 备份恢复功能支持二次备份。

  二次备份提供了将备份文件归档到其他位置的能力，其中备份文件包括基线数据和归档日志。支持二次备份能够降低备份文件的存储压力。如您需要
  * 了解二次备份，可参见 [备份恢复概述](https://www.oceanbase.com/docs/enterprise-oceanbase-ocp-cn-10000000000380164) 中的 **二次备份** 。

  * 使用二次备份，可参见 [新建备份策略](https://www.oceanbase.com/docs/enterprise-oceanbase-ocp-cn-10000000000380317)。

* 优化 OCP 中不同权限用户的所见。

  对无该功能权限的用户屏蔽入口，简化用户可见的产品路径，减少用户的无效点击。
  
* 支持接管 OBProxy。

  该功能一定程度上完善了接管流程，在接管 OceanBase 集群后，支持将该 OceanBase 集群对应的 OBProxy 集群也接管到 OCP 中。接管 OBProxy 请参见 [接管 OBProxy](https://www.oceanbase.com/docs/enterprise-oceanbase-ocp-cn-10000000000380261)。
  
* 针对多可用区模式，OCP 支持白屏化管理。

  多可用区模式针对 OceanBase、OCP 或 OBProxy 跨机房或跨城市部署时，能够控制优先访问本可用区内的目标。多可用区模式有效降低链路的时延，同时降低跨机房或城市的带宽成本。关于多可用区，详情可参见 [多可用区概述](https://www.oceanbase.com/docs/enterprise-oceanbase-ocp-cn-10000000000380186)。

  OCP 管理多可用区支持：
  * 查看各可用区的详细信息，包括各可用区所包含的机房，各可用区对应的 OCP 等信息。详情请参见 [查看多可用区](https://www.oceanbase.com/docs/enterprise-oceanbase-ocp-cn-10000000000380368)。

  * 查看或修改多可用区参数，详情请参见 [管理多可用区参数](https://www.oceanbase.com/docs/enterprise-oceanbase-ocp-cn-10000000000380369)。

## 功能增强

* 优化 SQL 诊断功能，增加导出 TopSQL、可疑 SQL、SlowSQL 的能力。

* 优化集群、租户性能监控功能，增加集群、租户性能指标采集功能关闭的提示。

* 优化监控采集的内存使用，使 OCP 在其管理的主机增多时性能依然有保障。

## 修复的问题

OceanBase 云平台 V3.1.2 版本修复了以下问题：

* SQL 诊断功能中，远程计划和分布式计划统计信息不准。

* ob_host_log_disk_percent_over_threshold 告警上报一段时间后，在问题未解决的情况下自动恢复而未持续告警。

* 通过 OCP 下载含有 OBProxy 类型的日志时，下载的日志无法解压。

* OCP 升级后，租户的创建时间被重置成了 OCP 升级的时间。

* **TopSQL** 中存在没有 SQL 文本的数据。

* 通过 OCP 修改 OBProxy 参数，存在某些参数无法修改或无法修改为某些范围内的值的情况。

* 通过 OCP 修改租户参数 recyclebin 的值为 ON，不生效。

* 针对有两个 datatime 字段的分区表，该表只对其中一个字段进行了一级分区， **系统管理** 中的 **巡检** 无法将这个表巡检出来。

* OceanBase 集群主备容灾切换后，已经不存在主备关系，但是在集群列表中仍然显示为主备关系。

## 已知问题

| 编号 |                                    已知问题                                     |                           规避方法                            |
|----|-----------------------------------------------------------------------------|-----------------------------------------------------------|
| 1  | 备份恢复时报错"解析备份文件异常"。                                                          | 配置系统参数 ocp.backup.restore-time-pre-check.enabled 为 false。 |
| 2  | 跨 OCP 创建 OceanBase 备集群失败后回滚，回滚成功但 OCP 的 **集群** 页依然有未创建成功的 OceanBase 备集群的信息。 | 不影响使用，暂不规避。                                               |
| 3  | 在 **系统管理 \> 巡检** 的 **巡检脚本** 页签中按巡检对象进行筛选，未生效。                               | 当前巡检对象只有集群，暂时无需筛选巡检对象，无需规避。                               |
| 4  | 物理备份在 **数据备份调度历史** 中显示为完成，但是集群的 **备份恢复** 页面中的 **状态** 仍显示为 **等待备份调度** 。      | 仅第一次进行物理备份才有此问题，后续备份调度都正常，暂时不影响业务，可不规避。                   |
| 5  | OBServer 节点侧针对二次备份 OSS 类型的存储路径不会把最终目录创建出来, 但是 OCP 中二次备份存储配置的 **测试** 测试的是全路径。 | OCP 侧本次发版的二次备份存储路径暂设置为不支持 OSS 类型。                         |
| 6  | 在 OCP 中对 OceanBase V1.4.7x 发起合并，而 **合并管理** 页面中显示 **冻结版本** 和 **广播版本** 不一致。   | 当前版本暂不兼容 OceanBase V1.4.7x，后续版本会做兼容。                      |
| 7  | 跨 OCP 主备库升级，子任务成功后，父任务一直等待直至超时失败。                                           | 在父任务中进行重试。                                                |
| 8  | OCP 中的 OceanBase 主集群正在创建过程中，此时接管同名的 OceanBase 主集群，没有预检查出来。                  | 接管前，人工检查是否有同名的 OceanBase 主集群正在创建。                         |

## 版本使用限制

### 硬件要求

OCP-Server 可以安装在物理机上，也支持安装运行在 Docker 容器中。OCP-Server 支持多节点高可用部署模式。

OCP-Server 节点最低硬件要求如下表所示。

| 硬件  |                 要求                 |
|-----|------------------------------------|
| CPU | <li>X86_64，8 核</li><li>ARM aarch 64 架构，8 核</li> |
| 内存  | 可用内存 16 GB                         |
| 网卡  | 万兆网卡                               |

OCP-Agent 自身占用资源很少，对安装节点硬件资源没有特别要求。

### 操作系统要求

安装 OCP 服务端（含 OCP-Agent）的操作系统要求如下表所示。

|    服务器类型    |    操作系统    |   支持版本    |
|-------------|------------|-----------|
| x86_64      | RHEL       | 7.2 及以上版本 |
| x86_64      | CentOS     | 7.2 及以上版本 |
| x86_64      | AliOS      | 7.2 及以上版本 |
| x86_64      | openSUSE   | 12SP3 及以上 |
| ARM aarch64 | AliOS      | 7.2 及以上版本 |
| ARM aarch64 | 中标麒麟       | 7.6       |
| ARM aarch64 | 华为 EulerOS | 2.0 SP8   |

### 客户端要求

一般用户会通过 Web 浏览器来访问 OCP 服务，故对客户端的要求如下所示。

|   浏览器   | 最小版本 |
|---------|------|
| Chrome  | 81   |
| Firefox | 64   |
| Safari  | 10   |
| Edge    | 13   |

如果您需要通过 iOS 操作系统的设备来访问 OCP，版本要求如下表所示。

| 操作系统 | 最小版本 |
|------|------|
| iOS  | 10   |

为了具备最佳的使用体验，推荐使用分辨率大于 1440 x 810 的显示器。
