# OCP V4.3.1

## V4.3.1 BP1

### 版本信息

* **版本号：** V4.3.1 BP1

* **前置版本：** V4.3.1

* **版本发布日期：** 2024 年 8 月 1 日

### 缺陷修复

* 修复了容器环境获取不当导致 OCP 进程频繁重启的问题。

* 修复了主备租户日常切换后备租户检测备份目录失败的问题。

* 修复了 OCP V4.2.1 升级到 V4.3.1 后日志频繁报错的问题。

* 优化租户开启 Binlog 服务的任务性能。

## V4.3.1

OCP V4.3.1 正式支持 OceanBase V4.3.1 版本，本版本提供 Binlog 服务的安装部署、基础运维、监控告警等功能，帮助用户实现与 MySQL 下游生态链路的无缝对接。同时通过支持 Service Name 实现主备租户 Session 自动路由切换能力，更进一步完善了 OceanBase V4.x 高可用解决方案。另外，本版本支持 S3 协议，除支持原生 AWS S3 外，同时支持兼容 S3 协议的对象存储，如华为云 OBS、Google GCS 等，基本实现对国内外主流云厂商存储介质的支持，满足客户多云以及私有云场景下的备份存储诉求。

### 版本信息

* **版本号：** V4.3.1

* **前置版本：** V4.3.0 BP2

* **版本发布日期：** 2024 年 7 月 26 日

* **支持的升级路径：**

  * 目前仅支持从 OCP V3.2.4 及之后版本直接升级到当前版本。

  * 对于 OCP V2.3.x 及之后、V3.2.4 之前的版本，需先升级至 OCP V3.3.4 版本。

  * 对于 OCP V2.3.0 之前版本，需先升级至 OCP V2.3.x 版本，再升级到 OCP V3.3.4 版本。

### 支持的 OceanBase 数据库版本

OCP V4.3.1 版本支持下表所列版本的 OceanBase 数据库。

* OceanBase V1.4.x

* OceanBase V2.1.x

* OceanBase V2.2.x

* OceanBase V3.1.x

* OceanBase V3.2.x

* OceanBase V4.x

### 产品新特性

#### OceanBase V4.x 功能适配

* 支持 Service Name 功能，通过屏蔽 OceanBase 集群 & 租户概念，在多租户场景下，业务侧可无需变更数据库连接串，方便对业务进行管理和维护。同时可以实现主备租户 Session 进行自动路由切换能力，显著降低 Switchover/Failover 场景下的业务切换时间。

* 数据备份 & 恢复支持 S3 协议，支持原生的 AWS S3 以及兼容 S3 协议的对象存储如华为云 OBS、Google GCS、腾讯云 COS、移动云 EOS 等，基本覆盖国内外主流云厂商的对象存储类型（Azure Blob 除外）。有助于用户更方便地进行数据备份和恢复，并提高数据的安全性和可靠性。

#### Binlog 服务

<main id="notice" type='explain'>
<h4>说明</h4>
仅 MySQL 租户支持 Binlog 服务。
</main>

* OCP 支持创建 Binlog 服务集群、新增服务节点能力。
* 支持重启/停止 Binlog 实例以及停止/删除 Binlog Server 功能。
* 支持 Binlog 实例延迟、RPS 以及资源、CPU、内存、存储空间等监控图表。
* 支持 Binlog 集群、Binlog 实例共 14 个告警。
* 支持 Binlog 集群 & 实例的参数设置。

### 产品优化

**集群管理**：集群轮转升级场景下增加技术架构检查，当集群部署方案为 2F1R 时，提示用户将 R 副本转换为 F 副本。

### 关键特性解读

#### Binlog 服务

Binlog 是 MySQL 与下游生态如 Canal、Flink 对接的重要组件。OceanBase 为了更好地与 MySQL 生态融合，提供 Binlog 服务通过转换原生Clog 为 MySQL Binlog 格式，使用户可以无缝对接至 OceanBase 数据库，保留其原有数据流程体系以及复用原基础设施，最大限度降低用户的数据库切换成本。OCP 提供 Binlog 集群部署以及 Binlog 实例的管理、监控告警、参数管理等能力，可以显著降低用户管理维护 Binlog 服务的成本，提升人效比。

Binlog 服务限制说明如下：

* OBServer V3.x 版本要求不低于 V3.2.4.4，V4.x 版本要求不低于 V4.1.0.1。
* OBProxy 版本要求不低于 V4.2.1，建议使用 V4.3.1.0-402024062810 或 V4.2.1.0-20240604114727。
* Binlog Service 版本要求不低于 V4.0.0。

#### 服务名

Service Name 是 OceanBase 提供的一种新的数据库访问方式，可以视其为集群 & 租户的别名，实现应用程序通过如 `mysql -hxxx.xxx.xxx.xxx -P2883 -uroot@<Service Name>` 的连接串访问数据库。

OceanBase V4.1 高可用解决方式变更为租户级主备库，集群级不再有主备角色的概念，集群名仅用于唯一标识一个集群，主备角色下放到租户级别，主备租户所属的集群可能不同，主备租户名也可能不同。

OCP 支持主备租户 Service Name 创建、编辑、删除、校验以及为主备租户所在的集群绑定同一 OBProxy 集群的功能，支持用户通过设置主备租户为同一 Service Name，达到主备租户切换时 Session 自动切换的能力。同时，用户也可以依据业务具体场景，如在非主备租户场景下使用 Service Name 代替集群名/租户名的连接方式、提供灵活性支持主备租户场景下主备租户使用不同的 Service Name 等，从而帮助用户更方便地使用 Service Name 特性。

服务名限制说明如下：

* OceanBase 版本要求为 V4.2.4.0 及以上、V4.3.0.0 以下。
* OBProxy 版本要求不低于 V4.3.1。
* Service Name 在单个 OCP 集群（包含多集群模式）内保持唯一。

### 修复的问题

OCP V4.3.1 版本主要修复了如下问题：

* 修复了多集群模式容灾切换的若干问题。
* 修复了修改含非字母、数字字符的租户参数时失败的问题。
* 修复了 `db.table` 样式的 SQL 不展示索引信息的问题。
* 优化了 SQL 诊断对 OceanBase V1.4.79 的兼容性。

### 已知问题

| 编号 | 已知问题   | 规避方法  |
|----|---------|---------------|
| 1 | Binlog 服务除支持正常使用外，部分运维功能可能会存在一些缺陷，但不影响主要功能使用。| 如非必须使用 Binlog 服务功能，暂不推荐使用 V4.3.1 版本，推荐使用稳定版本 V4.3.0 BP2。 |

## 版本使用限制

### 硬件要求

OCP-Server 可以安装在物理机上，也支持安装运行在 Docker 容器中。OCP-Server 支持多节点高可用部署模式。

OCP-Server 节点最低硬件要求如下表所示。

| 硬件 | 要求                 |
|-------|------------------------------------|
| CPU  | <li>X86_64，8 核</li><li>ARM aarch 64 架构，8 核</li> |
| 内存 | 可用内存 16 GiB             |
| 网卡 | 万兆网卡                |

OCP-Agent 自身占用资源很少，对安装节点硬件资源没有特别要求。

### 操作系统要求

安装 OCP 服务端（含 OCP-Agent）的操作系统要求如下表所示。

| 服务器类型    | 操作系统    | 支持版本   |
|-------------|------------|-----------|
| x86_64   | RHEL    | 7.2 及以上版本 |
| x86_64   | CentOS   | 7.2 及以上版本 |
| x86_64   | AliOS   | 7.2 及以上版本 |
| x86_64   | openSUSE  | 12SP3 及以上 |
| ARM aarch64 | AliOS   | 7.2 及以上版本 |
| ARM aarch64 | 中标麒麟    | 7.6    |
| ARM aarch64 | 华为 EulerOS | 2.0 SP8  |
| x86_64 | Debian    |  Debian GNU/Linux 11 (bullseye)  |
| x86_64 | Ubuntu | Ubuntu 18.04.6 LTS |

### 客户端要求

一般用户会通过 Web 浏览器来访问 OCP 服务，故对客户端的要求如下所示。

| 浏览器   | 最小版本 |
|---------|------|
| Chrome | 88  |
| Firefox | 78  |
| Safari | 14  |
| Edge  | 88  |

如果您需要通过 iOS 操作系统的设备来访问 OCP，版本要求如下表所示。

| 操作系统 | 最小版本 |
|------|------|
| iOS | 10  |

为了具备最佳的使用体验，推荐使用分辨率大于 1440 x 810 的显示器。
