# OCP V4.3.2

OCP V4.3.2 正式发布，全面兼容 OceanBase V4.3.2 及其以下版本。该版本新增重要功能 **租户克隆**，可有效解决数据库变更、应用版本发布、快速构建开发测试环境等多种业务场景下的数据隔离及效率问题。同时，此版本支持 CPU 绑核，通过合理设置来显著提升数据库在 ARM 混布场景下的集群性能。此外，该版本还实现对 OBKV_Table 和 OBKV_HBase 的监控功能，方便用户更好地监控产品性能。不仅如此，本版本在基础运维、性能监控、运维配置、外部集成等方面进行了超 20 项的优化和增强，并基于用户体验提升了产品的易用性和稳定性，以协助用户更高效地管理 OceanBase 数据库。

## 版本信息

* **版本号：** V4.3.2

* **前置版本：** V4.3.1 BP1

* **版本发布日期：** 2024 年 9 月 23 日

* **支持的升级路径：**

  * 目前仅支持从 OCP V3.2.4 及之后版本直接升级到当前版本。

  * 对于 OCP V2.3.x 及之后、V3.2.4 之前的版本，需先升级至 OCP V3.3.4 版本。

  * 对于 OCP V2.3.0 之前版本，需先升级至 OCP V2.3.x 版本，再升级到 OCP V3.3.4 版本。

## 支持的 OceanBase 数据库版本

OCP V4.3.2 版本支持下表所列版本的 OceanBase 数据库。

* OceanBase V4.x
* OceanBase V3.2.x
* OceanBase V3.1.x
* OceanBase V2.2.x
* OceanBase V2.1.x
* OceanBase V1.4.x

## 产品新特性

### 基础运维

* **租户克隆**：解决业务侧数据隔离和效能问题，详情可参见下方 **关键特性解读** 介绍。

    <main id="notice" type='explain'>
    <h4>说明</h4>
    仅 OceanBase V4.3.0 及以上版本支持租户克隆。
    </main>

* **CPU 绑核配置**：通过合理配置可显著提升数据库和 OBProxy 在 ARM 架构下的集群性能。

* **租户重命名**：实现用户无须变更数据库连接串即可访问如生产、测试等类型数据库的能力。

* **S3 协议**：主备租户场景下存储介质支持使用 S3 协议。

    <main id="notice" type='explain'>
    <h4>说明</h4>
    当租户所属集群满足如下条件时支持 S3 协议：
    <ul><li>V4.2.x 版本要求不低于 V4.2.1.6。</li><li>V4.3.x 版本要求不低于 V4.3.0。</li></ul>
    </main>

* **自定义 RPC 端口**：创建 OBProxy 集群时支持设置 RPC 端口，实现旁路导入、OBKV 等功能自定义端口能力。

    <main id="notice" type='explain'>
    <h4>说明</h4>
    仅 OBProxy V4.3.0 及以上版本支持自定义 RPC 端口。
    </main>

* **CPU 核数统计**：实现 OCP 所管理集群的 CPU 核数统计（不包含 OCP MetaDB 集群以及处于停止状态的 OceanBase 集群）。

* **主机管理**：实现免密添加主机能力。

### 告警中心

支持 OBProxy 内存使用超限（≥ 85%）告警能力。

### 性能监控

* 支持对 **OBKV_Table**、**OBKV_HBase** 实例的监控，包含 **QPS**、**响应时间** 和 **平均操作行数** 指标项。
* **响应时间** 支持 **P99** 与 **P95** 百分位统计展示，帮助用户更好地了解系统的性能状况。
* 租户性能监控新增支持 **日志盘** 和 **数据盘** 分钟级别监控。

<main id="notice" type='explain'>
<h4>说明</h4>
<li>仅所属集群为 V3.2.4.4 及以上版本的 MySQL 租户支持查看 <b>OBKV_Table</b> 和 <b>OBKV_HBase</b> 监控数据。</li>
<li>仅 OceanBase 版本为 [V4.2.1.7,V4.2.2.0)、[V4.2.5.0,V4.3.0.0) 及 [V4.3.3.0,+∞) 时支持查看 <b>99-all</b>、<b>99-all</b> 指标项。</li>
</main>

### 自治服务

**SQL 诊断** > **SlowSQL**：支持样例数据透出，详情页面支持采样数据透出明细参数。

### Open API

* 提供 OceanBase V4.x 租户级别 9 个 Open API，包括立即备份、展示备份任务、创建备份策略、变更备份策略、查询备份策略、关闭备份策略等。
* 提供 OceanBase V3.x 集群级别开启、关闭备份策略的 Open API。
* 提供集群、租户、主机、OBProxy 等对象最近一次巡检结果的 Open API。
* 提供 OceanBase V4.X 主备租户容灾切换的 13 个 Open API，包括创建网络备租户、主备租户日常切换、主备租户容灾切换等。

### 平台能力

* 完善 OCP 接管集群功能，保障在数据库接管过程中 Config Server 继续对外提供服务。
* 支持 OCP 在版本升级期间管控界面的只读能力。
* 支持 OCP Agent 参数配置管理能力，实现动态控制监控数据采集能力，解决异常场景下数据收集量较大造成 SYS 租户压力过大的问题。
* 支持 SSO 协议如 OIDC、OAuth2 等配置能力，解决用户侧配置难题。

## 产品优化

### 集群管理

* 创建 V4.3.0 及以上版本的集群时，支持选择负载类型（默认为 HTAP）。
* 升级集群时支持选择 Zone 的升级顺序，实现人为干预和控制切主时间点，最大限度降低 leader 切换对业务的影响。
* 替换 OBServer 时，OBServer 参数默认设置为当前集群中的参数值。
* 优化迁出集群时导出凭据流程，降低凭据迁出风险。

### 租户管理

* 创建 V4.3.0 及以上版本的租户时。支持选择负载类型，实现 5 种业务场景下如 OLTP、OLAP、HTAP、OBKV 等性能的最优化。
* 租户级别变更增加二次确认提示，避免用户因误操作造成异常事件。
* 支持展示租户在当前规格下的资源使用限制，如日志流个数、tablet 等。

    <main id="notice" type='explain'>
    <h4>说明</h4>
    当租户所属集群满足如下条件时支持展示资源使用限制：
    <ul><li>V4.2.x 版本要求不低于 V4.2.4。</li><li>V4.3.x 版本要求不低于 V4.3.1。</li></ul>
    </main>

* MySQL 租户支持创建和展示具有 hostname 的语法的数据库用户。
* 会话管理新增按会话 ID 进行查询能力。

### 其他优化

* **OBProxy**：支持复制 OBProxy 集群名。

* **Binlog 服务**：Binlog 实例列表新增展示、重启及停止备实例功能。

* **任务管理**：优化任务节点的跳过功能，避免因本跳过造成数据库对象状态异常。

* **主机管理**：增加网卡 MTU 值、NTP 以及内核参数 `net.ipv4.ip_local_port_range`、`net.ipv4.ip_local_reserved_ports` 检查，完善主机标准化检查项。

## 产品行为变更

**备份恢复**：安装向导中去除安装逻辑备份恢复服务步骤。

## 关键特性解读

### 租户克隆

OceanBase 的租户与传统数据库实例类似，例如 OceanBase 支持 MySQL/Oracle 兼容模式的租户。通过租户克隆操作，可迅速将源租户的元数据信息复制一份给新克隆租户使用，初始状态下，这两个租户共享物理宏块。该新克隆租户与源租户相互独立，具备严格的数据隔离和资源隔离。新克隆及源租户的任何数据更改，都不会相互影响。

在测试环境下，从一个 8C64GiB、包含 1TiB 数据的源租户克隆出一个同样配置的新租户，仅需 2 分钟。同时，OCP 还提供同步源租户的参数、资源检查等功能，助力用户达成一键快速克隆源租户的能力。本功能适用于报表任务、应用版本发布、数据库变更、数据导出等业务场景，既能提高任务执行效率，又能降低相关任务带来的业务风险。

### CPU 绑核配置

CPU 绑核（taskset）是一种能将特定进程或线程绑定至特定 CPU 核心上的技术，借由把关键任务绑定到固定的 CPU 核心，可避免任务于不同核心间频繁切换，从而削减上下文切换开销，增进系统整体性能。OCP 具备对 OBProxy 集群以及 OceanBase 集群开启/关闭 CPU 绑核的能力。在 ARM 架构以及 OBProxy、OceanBase 集群混布的场景中，依据客户现场实测数据，其可达成约 15% 至 20% 的 RT 降低。

同时也需注意：过度运用 CPU 绑核可能会致使某些核心负载过高，而其他核心处于空闲状态，对系统的资源利用率造成影响。在实际应用中，需要根据具体情况慎重决定是否使用 CPU 绑核，并合理调适绑核策略，以达至最佳的性能和资源利用效果。

## 修复的问题

OCP V4.3.2 版本主要修复如下问题：

* 修复了在 OCP 中先后部署两个同名集群时可能遇到的兼容性问题。
* 修复了启动方式为 RsList 的 OBProxy 无法接管 OceanBase 集群的问题。
* 修复了节点替换期间租户流量监控异常的问题。
* 修复若干多集群模式下主备 OCP failover 失败的问题。
* 修复了根据官网提供的参数查询 TopSQL 数据失败的问题。
* 修复了自治服务首页集群排序按钮失效的问题。

## 已知问题

| 编号 | 已知问题   | 规避方法  |
|-------|---------|---------------|
| 1 | MySQL 租户黑屏创建带 `%` 或者 `host_ip` 名字的用户会导致运维操作报错。| 避免黑屏创建名字中带 `%` 的用户。 |

# 版本使用限制

## 硬件要求

OCP-Server 可以安装在物理机上，也支持安装运行在 Docker 容器中。OCP-Server 支持多节点高可用部署模式。

OCP-Server 节点最低硬件要求如下表所示。

| 硬件 | 要求                 |
|-------|------------------------------------|
| CPU  | <li>X86_64，8 核</li><li>ARM aarch 64 架构，8 核</li> |
| 内存 | 可用内存 16 GiB             |
| 网卡 | 万兆网卡                |

OCP-Agent 自身占用资源很少，对安装节点硬件资源没有特别要求。

## 操作系统要求

安装 OCP 服务端（含 OCP-Agent）的操作系统要求如下表所示。

| 服务器类型    | 操作系统    | 支持版本   |
|-------------|------------|-----------|
| x86_64   | RHEL    | 7.2 及以上版本 |
| x86_64   | CentOS   | 7.2 及以上版本 |
| x86_64   | AliOS   | 7.2 及以上版本 |
| x86_64   | openSUSE  | 12SP3 及以上版本 |
| ARM aarch64 | AliOS   | 7.2 及以上版本 |
| ARM aarch64 | 中标麒麟    | 7.6    |
| ARM aarch64 | 华为 EulerOS | 2.0 SP8  |
| x86_64 | Debian    |  Debian GNU/Linux 11 (bullseye)  |
| x86_64 | Ubuntu | Ubuntu 18.04.6 LTS |

## 客户端要求

一般用户会通过 Web 浏览器来访问 OCP 服务，故对客户端的要求如下所示。

| 浏览器   | 最小版本 |
|---------|------|
| Chrome | 88  |
| Firefox | 78  |
| Safari | 14  |
| Edge  | 88  |

如果您需要通过 iOS 操作系统的设备来访问 OCP，版本要求如下表所示。

| 操作系统 | 最小版本 |
|------|------|
| iOS | 10  |

为了具备最佳的使用体验，推荐使用分辨率大于 1440 x 810 的显示器。
