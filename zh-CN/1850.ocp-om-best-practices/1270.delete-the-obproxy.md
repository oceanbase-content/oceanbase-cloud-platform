# 删除 OBProxy

本节为您介绍如何删除 OBProxy Server。

## 应用场景

适用于删除 OBProxy 集群中的部分 OBProxy Server，或删除整个 OBProxy 集群。若 OBProxy Server 主机上的 OCP Agent 离线，在 OCP 中删除 OBProxy Server 后，仍需要手动去对应主机上进行清理动作。

## 前提条件

请确保当前登录 OCP 的用户具备如下权限：

* **OBProxy 维护** 资源权限。
* OBProxy **概览** 菜单权限。

## 操作步骤

### 步骤一：删除 OBProxy Server

1. 登录 OCP。

2. 在左侧导航栏单击 **OBProxy** 。

3. 在集群列表中选择需要操作的 OBProxy 集群，进入 OBProxy 集群 **概览** 页面。

4. 在 OBProxy 列表中选择需要删除的 OBProxy，单击 **操作** 列的 **删除** 。

   ![1634](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/422/%E5%88%A0%E9%99%A4obproxy.png)

   您也可勾选多个 OBProxy，在 **更多** 中单击 **批量删除** 。

   ![1636](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/422/%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4obproxy.png)

   如需删除 OBProxy 集群中所有 OBProxy，您可通过 [删除 OBProxy 集群](../800.obproxy-functions/300.manage-a-obproxy-cluster/500.delete-an-obproxy-cluster.md) 实现。

   <main id="notice" type='explain'>
   <h4>说明</h4>
   <p>当 OBProxy 集群下有主机处于离线状态，删除 OBProxy 集群时将跳过该主机的自动清理步骤，您可参考 <b>步骤二</b> 手动清理主机环境。</p>
   </main>

5. 在弹出的对话框中输入 **delete**，并单击 **删除** 。

6. 任务提交后，您可通过弹出框中的 **查看任务** 按钮，查看删除进度。

### 步骤二：清理主机环境

若待删除的 OBProxy Server 主机上的 OCP Agent 处于离线状态，系统将无法执行清理主机操作，此时您需要记录离线主机的 IP、OBProxy 的安装目录及 OBProxy 的运行目录，在主机上进行手动清理操作。

<main id="notice" type='explain'>
<h4>说明</h4>
<p>OBProxy 的安装目录及运行目录记录在 OCP metaDB 的 <code>obproxy_server</code> 表中，默认为 <code>/home/admin/obproxy</code>。</p>
</main>

1. 登录主机，需保证登录用户具有启动 `obproxy` 进程的权限。

2. 执行如下命令停止 `obproxyd.sh` 进程。

   ```shell
   ps -ef | grep obproxyd.sh; kill -9 ${obproxyd_pid}
   ```

3. 待 `obproxyd.sh` 进程停止后，执行如下命令停止 `obproxy` 进程。

   ```shell
   ps -ef | grep obproxy; kill -9 ${obproxy_pid}
   ```

4. 执行如下命令删除 OBProxy 的安装目录、运行目录。

   ```shell
   rm -rf /xxx
   ```
