# 主备租户日常切换

本页面为您介绍主备租户日常切换的操作步骤。根据不同的业务需要，您可选择如下方式进行主备租户的日常切换。

* 方式一：对指定主备租户进行日常切换。
* 方式二：对集群下的所有主备租户进行日常切换。

## 方式一：对指定主备租户进行日常切换

该方式适用于将指定主租户切换为备租户的场景。

### 前提条件

当前主租户存在可用备租户，且备租户处于 **运行中**。

### 操作步骤

1. 登录 OceanBase 云平台，单击左侧导航栏 **租户** ，在 **租户列表** 中进入主租户。

2. 单击右上角更多图标，选择 **日常切换** 。

   ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/420/%E7%A7%9F%E6%88%B7%E6%97%A5%E5%B8%B8%E5%88%87%E6%8D%A2.png)

3. 在对话框中查看租户切换的信息，单击 **开始切换** 。

    * 当主租户下存在多个备租户时，需在 **新主租户** 下拉列表中指定需要切换的备租户。若开启了 OCP 多集群模式，则下拉列表中还会包含远程 OCP 集群管理的备租户。
    * 当所选择备租户的同步方式为 **基于归档** 且该备租户未启用归档时，需先配置归档地址。具体参数说明如下：

      |  参数  |  说明   |
      |--------|---------|
      | 存储类型  | 备份文件存储介质，取值范围：<ul><li>File：本地文件存储，一般为 NFS。</li><li>OSS：阿里云 OSS 对象存储，仅 OceanBase V2.2.76 及以上版本支持。</li></ul>|
      | 存储目录        | 备份文件在当前介质上的存储目录。<main id="notice" type='explain'><h4>说明</h4><p>主租户与备租户需具有该目录的读写权限。</p></main>  |
      | 访问域名        | 当 **存储类型** 选择 OSS 时展示，填写备份文件云存储端的域名。支持在域名后添加端口号，如：`oss.ap-shanghai.myqcloud.com:8080`。 |
      | 访问用户        | 当 **存储类型** 选择 OSS 时展示，填写访问阿里云存储端的用户。 |
      | 访问秘钥        | 当 **存储类型** 选择 OSS 时展示，填写访问阿里云存储端的用户秘钥。    |

   ![11221339](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/430/%E6%97%A5%E5%B8%B8%E5%88%87%E6%8D%A2.png)

4. 单击对话框中的任务 ID，查看任务进度。

## 方式二：对集群下的所有主备租户进行日常切换

该方式适用于集群运维操作前，为保证业务连续性，需要用备租户支持业务的场景。您可参考此方式，将集群下的所有主租户切换为备租户。

### 前提条件

当前集群下已创建主租户，且该主租户存在可用备租户。

### 操作步骤

1. 登录 OceanBase 云平台，单击左侧导航栏 **集群** ，在 **集群列表** 中进入集群 **概览** 页面。

2. 单击右上角更多图标，选择 **租户日常切换** 。

   ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/420/%E7%A7%9F%E6%88%B7%E6%97%A5%E5%B8%B8%E5%88%87%E6%8D%A2-%E9%9B%86%E7%BE%A4.png)

3. 在对话框中勾选需要切换的租户，单击 **日常切换** 。

    * 当主租户下存在多个备租户时，需在 **新主租户** 下拉列表中选择需要切换为主租户的备租户。若开启了 OCP 多集群模式，则下拉列表中还会包含远程 OCP 集群管理的备租户。

      在进行日常切换前，系统会对主备租户是否满足如下条件进行检查。若检查不通过，则不支持勾选租户进行容灾切换：

      * 主备租户都处于正常运行状态。
      * 主备租户所属集群为 **Running** 状态，且集群版本一致。
      * 备租户的的同步延迟不能大于阈值，阈值默认为 5000ms，您可在 **系统管理** > **系统参数** 中通过修改 `ocp.standby.tenant.delay.threshold` 参数值来调整阈值大小。

    * 当所选择备租户的同步方式为 **基于归档** 且该租户未启用归档时，需先配置归档地址。具体参数说明如下：

      |  参数  |  说明   |
      |--------|---------|
      | 存储类型  | 备份文件存储介质，取值范围：<ul><li>File：本地文件存储，一般为 NFS。</li><li>OSS：阿里云 OSS 对象存储，仅 OceanBase V2.2.76 及以上版本支持。</li></ul>|
      | 存储目录        | 备份文件在当前介质上的存储目录。  <main id="notice" type='explain'><h4>说明</h4><p>主租户与备租户需具有该目录的读写权限。</p></main>  |
      | 访问域名        | 当 **存储类型** 选择 OSS 时展示，填写备份文件云存储端的域名。支持在域名后添加端口号，如：`oss.ap-shanghai.myqcloud.com:8080`。 |
      | 访问用户        | 当 **存储类型** 选择 OSS 时展示，填写访问阿里云存储端的用户。 |
      | 访问秘钥        | 当 **存储类型** 选择 OSS 时展示，填写访问阿里云存储端的用户秘钥。    |

      ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/430/%E7%A7%9F%E6%88%B7%E6%97%A5%E5%B8%B8%E5%88%87%E6%8D%A2.png)

    <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>该操作可能导致新主租户所属集群业务压力过大，请谨慎操作。</p>
    </main>

4. 单击对话框中的任务 ID，查看任务进度。
