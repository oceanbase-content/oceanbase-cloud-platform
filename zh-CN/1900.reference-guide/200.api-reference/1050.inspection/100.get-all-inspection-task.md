# 查询所有巡检任务

## 功能说明

该接口用于查询所有巡检任务。

## 调用说明

### 接口约束

调用者需要通过 OCP 应用服务鉴权。

### 请求路径

`GET /api/v2/inspection/task`

### 请求参数

|  参数  |  类型  |  必选  |  示例值  |  描述  |
|--------|--------|--------|---------|--------|
|  inspectionObjectTypes  |  Array  |  否  |  OB_CLUSTER  |  巡检对象类型，包括：<li>OB_CLUSTER：集群。</li><li>OB_TENANT：租户。</li><li> HOST：主机。</li><li> OB_PROXY：OBproxy。<y/li>   |
|  tags  |  Array  |  否  |  1  |  巡检场景标签，标签 ID 如下：<li>1：基础巡检。</li><li>2：性能巡检。</li><li>3：深度巡检。</li><li>4：装机巡检。</li>  |
|  taskStates  |  string  |  否  |  SUCCESSFUL  |  巡检任务状态，包括：<li>执行中：RUNNING。 </li><li> 失败：FAILED。 </li><li> 已完成：SUCCESSFUL。</li>  |
|  name  |  String  |  否  | cluster_test   |  巡检对象名称。  |

### 返回结果

**基础数据结构**

|  参数  |  类型  | 说明                               |
|--------|---------|----------------------------------|
|  data  |  Object  | InspectionReportOverview 的信息，详情参见下表。 |
|  successful  |  Boolean | 请求是否成功。                          |
|  timestamp |  Datetime  | 服务端完成请求的时间戳。                     |
|  duration |  Integer  | 服务端处理请求的时间（毫秒）。                  |
|  status |  Integer  | 符合 HTTP Status 规范的编码。            |
|  traceId |  String  | 请求的 Trace ID，用于排查问题。             |
|  server  |  String  | 响应请求的应用服务的地址。                    |

**`InspectionReportOverview` 的数据结构**

|  参数  |  类型  |  说明  |
|--------|--------|---------|
|  id  |  Integer  |  巡检报告 ID。  |
|  tag  |  InspectionTag  |  InspectionTag 的信息，详情参见下表。  |
|  inspectionObject  |  InspectionObject  |  InspectionObject 的信息，详情参见下表。  |
|  startTime  |  String  |  巡检开始时间。  |
|  endTime  |  String  |  巡检结束时间，任务运行中无该字段。  |
|  taskId  |  Integer  |  巡检任务 ID。  |
|  itemTotalCount  |  Integer  |  巡检项总数。  |
|  itemFinishedCount  |  Integer  |  已完成的巡检项数。  |
|  highRiskCount  |  Integer  |  高风险巡检项条目数。  |
|  mediumRiskCount  |  Integer  |  中风险巡检条目数。  |
|  lowRiskCount  |  Integer  |  低风险巡检条目数。  |
|  taskState  |  String  |  巡检任务状态。  |

**`InspectionTag` 的数据结构**

|  参数  |  类型  |  说明  |
|--------|---------|---------|
|  id  |  Integer  |  巡检场景标签 ID。  |
|  name  |  String  |  标签名。  |
|  description  |  String  |  标签描述。  |
|  configType  |  String  |  配置类型。  |

**`InspectionObject` 的数据结构**

|  参数  |  类型  |  说明  |
|--------|---------|--------|
|  objectId  |  Integer  |  巡检对象 ID。  |
|  inspectionObjectType  |  String  |  巡检对象类型。  |
|  name  |  String  |  巡检对象名称。  |

## 示例

### 请求示例

`GET /api/v2/inspection/task`

### 返回示例

```JSON
{
  "data": {
    "contents": [
      {
        "endTime": "2024-07-30T14:31:10+08:00",
        "highRiskCount": 4,
        "id": 1000025,
        "inspectionObject": {
          "info": {
            "obClusterId": "12",
            "type": "PRIMARY"
          },
          "inspectionObjectType": "OB_CLUSTER",
          "name": "OB_TEST_1",
          "objectId": 1
        },
        "itemFinishedCount": 64,
        "itemTotalCount": 64,
        "lowRiskCount": 17,
        "mediumRiskCount": 4,
        "startTime": "2024-07-30T14:31:06+08:00",
        "tag": {
          "configType": "BUILTIN",
          "description": "对 OCP 管理的资源进行深度检查，发现隐藏风险，适用于业务洪峰前巡检工作。",
          "id": 3,
          "name": "深度巡检"
        },
        "taskId": 6058477,
        "taskState": "SUCCESSFUL"
      }
    ],
    "page": {
      "number": 1,
      "size": 1,
      "totalElements": 25,
      "totalPages": 25
    }
  },
  "duration": 11,
  "server": "124075fe52",
  "status": 200,
  "successful": true,
  "timestamp": "2024-07-30T16:29:45.995+08:00",
  "traceId": "8c75e28370935e98"
}
```
