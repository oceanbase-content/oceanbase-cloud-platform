# 获取巡检详情

## 功能说明

该接口用于获取巡检报告。

## 调用说明

### 接口约束

调用者需要通过 OCP 应用服务鉴权。

### 请求路径

`GET /api/v2/inspection/report/{id}`

### 请求参数

**Path 参数**

|  参数  |  类型  |  必选  |  示例值  |  描述  |
|--------|--------|--------|----------|--------|
|  id  |  Integer  |  是  | 2   |  巡检报告 ID。  |

### 返回结果

**基础数据结构**

|  参数  |  类型  | 说明          |
|--------|--------|----------------------------------|
|  data  |  Object  | InspectionReport 的信息，详情参见下表。 |
|  successful  |  Boolean | 请求是否成功。                          |
|  timestamp |  Datetime  | 服务端完成请求的时间戳。                     |
|  duration |  Integer  | 服务端处理请求的时间（毫秒）。                  |
|  status |  Integer  | 符合 HTTP Status 规范的编码。            |
|  traceId |  String  | 请求的 Trace ID，用于排查问题。             |
|  server  |  String  | 响应请求的应用服务的地址。                    |

**`InspectionReport` 的数据结构**

|  参数  |  类型  |  说明  |
|--------|--------|--------|
|  id  |  Integer  |  巡检报告 ID，获取方式可参见 [查询所有巡检任务](100.get-all-inspection-task.md) 接口。  |
|  tag  |  InspectionTag  |  InspectionTag 的信息，详情参见下表。  |
|  inspectionObject  |  InspectionObject  |  InspectionObject 的信息，详情参见下表。  |
|  startTime  |  String  |  巡检开始时间。  |
|  endTime  |  String  |  巡检结束时间，任务运行中无该字段。  |
|  taskId  |  Integer  |  巡检任务 ID。  |
|  itemTotalCount  |  Integer  |  巡检项总数。  |
|  itemFinishedCount  |  Integer  |  已完成的巡检项数。  |
|  highRiskCount  |  Integer  |  高风险巡检项条目数。  |
|  mediumRiskCount  |  Integer  |  中风险巡检条目数。  |
|  lowRiskCount  |  Integer  |  低风险巡检条目数。  |
|  taskState  |  String  |  巡检任务状态。  |
|  inspectionItems  |  Array  |  巡检报告中包含的所有巡检项的信息。  |
|  reportItems  |  Array  |  所有巡检项条目。  |

**`InspectionTag` 的数据结构**

|  参数  |  类型  |  说明  |
|--------|---------|-------|
|  id  |  Integer  |  巡检场景标签 ID。   |
|  name  |  String  |  标签名。  |
|  description  |  String  |  标签描述。  |
|  configType  |  String  |  配置类型。  |

`InspectionObject` 的数据结构

|  参数  |  类型  |  说明  |
|--------|--------|--------|
|  objectId  |  Integer  |  巡检对象 ID。  |
|  inspectionObjectType  |  String  |  巡检对象类型。  |
|  name  |  String  |  巡检对象名称。  |

## 示例

### 请求示例

`GET /api/v2/inspection/report/{id}`

### 返回示例

<main id="notice" type='explain'>
<h4>说明</h4>
<p><code>reportItems</code> 中的 <code>level</code> 字段表示风险等级，当未返回 <code>level</code> 字段时表示无风险。</p>
</main>

```JSON
{
    "data": {
        "endTime": "2024-05-22T21:27:06+08:00",
        "highRiskCount": 0,
        "id": 1000020,
        "inspectionItems": [
            {
                "configType": "BUILTIN",
                "description": "统计过去 24 小时，12 分位主机平均每核 CPU 使用率最高时段、最低时段以及 80% 的时间里所处的水平（即 80% 的时间里都处于该水平之上）",
                "id": 45,
                "identifier": 39,
                "maxVersion": "127.127.127.127",
                "minVersion": "0.0.0.0",
                "name": "主机 CPU 使用率统计",
                "rules": [
                    {
                        "level": "LOW",
                        "validator": "[80,90)"
                    },
                    {
                        "level": "MEDIUM",
                        "validator": "[90,98)"
                    },
                    {
                        "level": "HIGH",
                        "validator": "[98,)"
                    }
                ],
                "scriptId": 34,
                "state": "ACTIVE",
                "tags": [
                    {
                        "configType": "BUILTIN",
                        "description": "对 OCP 管理的资源性能检查，如大事务、慢查询等，适用于性能分析工作。",
                        "id": 2,
                        "name": "性能巡检"
                    }
                ],
                "targetType": "HOST",
                "unit": "NUMBER"
            }
        ],
        "inspectionObject": {
            "info": {
                "obClusterId": "12",
                "type": "PRIMARY"
            },
            "inspectionObjectType": "OB_CLUSTER",
            "name": "AdminMETA",
            "objectId": 1
        },
        "itemFinishedCount": 1,
        "itemTotalCount": 1,
        "lowRiskCount": 0,
        "mediumRiskCount": 0,
        "reportItems": [
            {
                "itemId": 45,
                "key": "Lowest",
                "rawValue": "55.25",
                "target": "xxx.xxx.xxx.xxx",
                "value": "55.25 (2024-05-22T07:27:05Z to 2024-05-22T09:27:05Z)"
            },
            {
                "itemId": 45,
                "key": "Highest",
                "rawValue": "57.68",
                "target": "xxx.xxx.xxx.xxx",
                "value": "57.68 (2024-05-22T11:27:05Z to 2024-05-22T13:27:05Z)"
            },
            {
                "itemId": 45,
                "rawValue": "47.02",
                "target": "xxx.xxx.xxx.xxx",
                "value": "47.02 (Lowest during 80% of the time)"
            }
        ],
        "startTime": "2024-05-22T21:27:05+08:00",
        "tag": {
            "configType": "BUILTIN",
            "description": "对 OCP 管理的资源性能检查，如大事务、慢查询等，适用于性能分析工作。",
            "id": 2,
            "name": "性能巡检"
        },
        "taskId": 6005667,
        "taskState": "SUCCESSFUL"
    },
    "duration": 176,
    "server": "124075fe52",
    "status": 200,
    "successful": true,
    "timestamp": "2024-07-30T14:13:04.106+08:00",
    "traceId": "3bf92af9d1ce64a2"
}
```
