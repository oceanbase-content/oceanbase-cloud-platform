# 查询指定巡检项最后一次巡检结果

## 功能说明

根据巡检对象类型、巡检场景、巡检对象 ID（可选）等条件查询指定巡检项的最后一次巡检结果。

## 调用说明

### 接口约束

调用者需要通过 OCP 应用服务鉴权。

### 请求路径

`GET /api/v2/inspection/report/info/item/{itemId}`

### 请求参数

| 参数名 | 类型 | 必选 | 示例值 | 示例 |
|---------|---------|--------|--------|---------|
| itemId | Long | 是 | 1 | 巡检项 ID。 |
| tagId | Long | 是 | 1 | 巡检场景 ID，包括：<li>1：基础巡检。</li><li>2：性能巡检。</li><li>3：深度巡检。</li><li>4：装机巡检。</li> |
| objectType | String | 是 | OB_CLUSTER | 巡检对象类型，包括：<li>OB_CLUSTER：集群。</li><li>OB_TENANT：租户。</li><li> HOST：主机。</li><li> OB_PROXY：OBProxy。</li> |
| objectId | Long | 否 | 1 | 对象 ID。 |

### 返回结果

**基础数据结构**

| 参数 | 类型 | 说明 |
|----------|---------|---------|
| data | Object | 请求的业务数据。 |
| ├─ contents | Array | 巡检结果聚合信息，详情参见 **InspectionReportAggrInfo 数据结构**。 |
| successful | Boolean | 请求是否成功。 |
| timestamp | Datetime | 服务端完成请求的时间戳。 |
| duration | Integer | 服务端处理请求的时间（毫秒）。 |
| status | Integer | 符合 HTTP Status 规范的编码。 |
| traceId | String | 请求的 Trace ID，用于排查问题。 |
| server | String | 响应请求的应用服务的地址。 |

**InspectionReportAggrInfo 数据结构**

| 参数 | 类型 | 说明 |
|---------|---------|---------|
| reportId | Long | 巡检报告 ID。 |
| objectId | Long | 巡检对象 ID。 |
| objectName | String | 巡检对象名称。 |
| objectType | String | 巡检对象类型。 |
| tag | Object | 巡检场景。 |
| ├─ id | Long | 巡检场景 ID。 |
| ├─ name | String | 巡检场景名称。 |
| ├─ description | String | 巡检场景描述。 |
| ├─ configType | String | 巡检场景配置类型。 |
| startTime | Datetime | 巡检开始时间。 |
| endTime | Datetime | 巡检结束时间。 |
| resultList | Array | 巡检项结果。 |
| ├─ itemId | Long | 巡检项 ID。 |
| ├─ name | String | 巡检项名称。 |
| ├─ description | String | 巡检项描述。 |
| ├─ reportItems | Array | 巡检项结果详情。 |
|        ├─ itemId | Long | 巡检项 ID。 |
|        ├─ key | String | 巡检项键。 |
|        ├─ value | String | 巡检值。 |
|        ├─ rawValue | String | 巡检项原值。 |
|  ├─ target | String | 巡检项目标。 |
|        ├─ level | String | 风险等级，包括 **HIGH**、**MEDIUM**、**LOW** 三种风险等级。 |
| ├─ rules | Array | 巡检项规则。 |
|        ├─ level | String | 风险等级。 |
|        ├─ validator | String | 风险判别式。 |

## 示例

### 请求示例

查询巡检项 ID 为 14 的集群维度的最后一次基础巡检的结果。

```json
GET /api/v2/inspection/report/info/item/14?objectType=OB_CLUSTER&tagId=1
```

### 返回示例

```json
{
  "data": {
    "contents": [
      {
        "endTime": "2024-08-26T11:38:34+08:00",
        "itemResults": [
          {
            "description": "检查主机上各个挂载点的磁盘使用率",
            "itemId": 14,
            "name": "主机磁盘使用率",
            "reportItems": [
              {
                "itemId": 14,
                "key": "/dev/mapper/vgob-home -> /home/admin",
                "level": "LOW",
                "rawValue": "75.44",
                "target": "xxx.xxx.xxx.xxx",
                "value": "75.44 (296 GiB/393 GiB)"
              },
              {
                "itemId": 14,
                "key": "/dev/mapper/vgob-log -> /data/log1",
                "rawValue": "4.83",
                "target": "xxx.xxx.xxx.xxx",
                "value": "4.83 (19 GiB/393 GiB)"
              },
              {
                "itemId": 14,
                "key": "/dev/vda1 -> /",
                "rawValue": "53.35",
                "target": "xxx.xxx.xxx.xxx",
                "value": "53.35 (31 GiB/59 GiB)"
              },
              {
                "itemId": 14,
                "key": "/dev/vdc -> /docker",
                "rawValue": "0.02",
                "target": "xxx.xxx.xxx.xxx",
                "value": "0.02 (64 MiB/294 GiB)"
              },
              {
                "itemId": 14,
                "key": "/dev/mapper/vgob-opt -> /opt",
                "rawValue": "0.06",
                "target": "xxx.xxx.xxx.xxx",
                "value": "0.06 (382 MiB/578 GiB)"
              }
            ],
            "rules": [
              {
                "level": "LOW",
                "validator": "[70,80)"
              },
              {
                "level": "MEDIUM",
                "validator": "[80,90)"
              },
              {
                "level": "HIGH",
                "validator": "[90,)"
              }
            ]
          }
        ],
        "objectId": 3,
        "objectName": "admin",
        "objectType": "OB_CLUSTER",
        "reportId": 75,
        "startTime": "2024-08-26T11:38:32+08:00",
        "tag": {
          "configType": "BUILTIN",
          "description": "对 OCP 管理的资源基本状态检查，如集群状态、副本状态等，适用于日常巡检工作。",
          "id": 1,
          "name": "基础巡检"
        }
      }
    ]
  },
  "duration": 16,
  "server": "b3b6d90167",
  "status": 200,
  "successful": true,
  "timestamp": "2024-08-27T16:37:38.641+08:00",
  "traceId": "45022f1209bc8148"
}
```
