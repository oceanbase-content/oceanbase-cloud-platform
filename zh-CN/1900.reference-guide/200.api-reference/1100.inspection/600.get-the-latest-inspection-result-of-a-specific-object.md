# 获取特定对象最近一次巡检结果

## 功能说明

根据巡检对象类型、巡检场景、巡检对象 ID（可选）等条件查询出符合条件的对象的最近一次巡检结果。

## 调用说明

### 接口约束

调用者需要通过 OCP 应用服务鉴权。

### 请求路径

`GET api/v2/inspection/report/info`

### 请求参数

| 参数名 | 类型 | 必选 | 示例值 | 说明  |
|--------|--------|--------|---------|-------|
| tagId | Long | 是 | 1 | 巡检场景 ID，包括：<li>1：基础巡检。</li><li>2：性能巡检。</li><li>3：深度巡检。</li><li>4：装机巡检。</li> |
| objectType | String | 是 | OB_CLUSTER | 巡检对象类型，包括：<li>OB_CLUSTER：集群。</li><li>OB_TENANT：租户。</li><li> HOST：主机。</li><li> OB_PROXY：OBProxy。</li> |
| objectId | Long | 否 | 1 | 对象 ID。 |

### 返回结果

**基础数据结构**

| 参数 | 类型 | 说明 |
|----------|----------|--------|
| data | Object  | 请求的业务数据。 |
| ├─ contents | Array | 巡检结果聚合信息，详情参见 **InspectionReportAggrInfo 数据结构**。 |
| successful | Boolean | 请求是否成功。 |
| timestamp | Datetime | 服务端完成请求的时间戳。 |
| duration | Integer | 服务端处理请求的时间（毫秒）。 |
| status | Integer | 符合 HTTP Status 规范的编码。 |
| traceId | String | 请求的 Trace ID，用于排查问题。 |
| server | String | 响应请求的应用服务的地址。 |

**InspectionReportAggrInfo 数据结构**

| 参数 | 类型 | 说明 |
|---------|---------|---------|
| reportId | Long | 巡检报告 ID。 |
| objectId | Long | 巡检对象 ID。 |
| objectName | String | 巡检对象名称。 |
| objectType | String | 巡检对象类型。 |
| tag | Object | 巡检场景。 |
| ├─ id | Long | 巡检场景 ID。 |
| ├─ name | String | 巡检场景名称。 |
| ├─ description | String | 巡检场景描述。 |
| ├─ configType | String | 巡检场景配置类型。 |
| startTime | Datetime | 巡检开始时间。 |
| endTime | Datetime | 巡检结束时间。 |
| resultList | Array | 巡检项结果。 |
| ├─ itemId | Long | 巡检项 ID。 |
| ├─ name | String | 巡检项名称。 |
| ├─ description | String | 巡检项描述。 |
| ├─ reportItems | Array | 巡检项结果详情。 |
|        ├─ itemId | Long | 巡检项 ID。 |
|        ├─ key | String | 巡检项键。 |
|        ├─ value | String | 巡检值。 |
|        ├─ rawValue | String | 巡检项原值。 |
|  ├─ target | String | 巡检项目标。 |
|        ├─ level | String | 风险等级，包括 **HIGH**、**MEDIUM**、**LOW** 三种风险等级。 |
| ├─ rules | Array | 巡检项规则。 |
|        ├─ level | String | 风险等级。 |
|        ├─ validator | String | 风险判别式。 |

## 示例

### 请求示例

查询集群维度下 ID 为 3 的对象的最近一次基础巡检结果。

```json
GET api/v2/inspection/report/info?objectType=OB_CLUSTER&tagId=1&objectId=3
```

### 返回示例

```json
{
  "data": {
    "contents": [
      {
        "endTime": "2024-08-26T11:38:34+08:00",
        "itemResults": [
          {
            "description": "OCP 通过连接 sys 租户检查集群是否连通",
            "itemId": 1,
            "name": "集群连通性",
            "reportItems": [
              {
                "itemId": 1,
                "rawValue": "pass",
                "target": "admin",
                "value": "pass"
              }
            ],
            "rules": [
              {
                "level": "HIGH",
                "validator": "!{pass}"
              }
            ]
          },
          {
            "description": "检查集群 OBServer 状态",
            "itemId": 2,
            "name": "OBServer 状态",
            "reportItems": [
              {
                "itemId": 2,
                "key": "xxx.xxx.xxx.xxx",
                "rawValue": "active",
                "target": "admin",
                "value": "active"
              }
            ],
            "rules": [
              {
                "level": "HIGH",
                "validator": "{inactive}"
              },
              {
                "level": "LOW",
                "validator": "{deleting,stopped}"
              }
            ]
          }
        ],
        "objectId": 3,
        "objectName": "admin",
        "objectType": "OB_CLUSTER",
        "reportId": 75,
        "startTime": "2024-08-26T11:38:32+08:00",
        "tag": {
          "configType": "BUILTIN",
          "description": "对 OCP 管理的资源基本状态检查，如集群状态、副本状态等，适用于日常巡检工作。",
          "id": 1,
          "name": "基础巡检"
        }
      }
    ]
  },
  "duration": 86,
  "server": "b3b6d90167",
  "status": 200,
  "successful": true,
  "timestamp": "2024-08-27T16:45:12.302+08:00",
  "traceId": "a14676a7a0c556ec"
}
```
