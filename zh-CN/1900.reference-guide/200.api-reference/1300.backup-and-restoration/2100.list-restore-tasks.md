# 查看恢复任务

## 功能说明

该接口用于查看恢复任务。

## 调用说明

### 接口约束

调用者需要通过 OCP 应用服务鉴权。

### 请求路径

`GET /api/v2/ob/clusters/{id}/tenants/{tenantId}/backup/task/restoreTasks`

### 请求参数

**Path 参数**

|  参数      |  类型     |  必选  |  示例值    |  描述   |
|------------|-----------|--------|-----------|----------|
|  id        |  Integer  |  是    |  1002     |  集群 ID。  |
|  tenantId  |  Integer  |  是    |  108      |  租户 ID。  |

**Query 参数**

|  参数                |  类型    |  必选   |  示例值  |  描述        |
|----------------------|----------|--------|----------|---------------|
|  startTime      |  String  |  否     |  2024-08-06T00:00:00Z       |   开始时间，该时间只支持 UTC 时间，格式为：YYYY-MM-DDThh:mm:ssZ。         |
|  endTime        |  String  |  否     |  2024-08-07T00:00:00Z       |   结束时间，该时间只支持 UTC 时间，格式为：YYYY-MM-DDThh:mm:ssZ。         |
|  restoreClusterName  |  Array   |  否    |  ob_0807  |  恢复集群名筛选列表。  |
|  status              |  Array   |  否    |    |  任务状态，包括：<ul><li>物理备份<ul><li>THE TENANT IS BEING CREATED：租户创建中。 </li><li> RECOVERING SYSTEM REPLICAS：系统副本恢复中。 </li><li> PRE-UPGRADE CHECK：升级前检查。 </li><li> POST-UPGRADE CHECK：升级后检查。 </li><li> MODIFYING SCHEMAS：schema 修改中。 </li><li> THE USER PARTITIONS ARE BEING CREATED：用户分区创建中。 </li><li> RECOVERING USER REPLICAS：用户副本恢复中。 <li> THE INDEX IS BEING CREATED：索引创建中。 </li><li> IN PROGRESS：索引检查中。 </li><li> COMPLETED：已完成。 </li><li> FAILED：失败。 </li><li> SET PARAMETERS：设置配置项。 </li><li> CREAT BASELINE LOG STREAM：创建基线日志流。 </li><li> RESTORING THE BASELINE LOG STREAM：基线日志流恢复中。 </li><li> SET STANDBY TENANT：设置备租户。 </li><li> UPGRADING THE TENANT：租户升级中。 </li><li> WAITING FOR THE TENANT RECOVERY TO COMPLETE：等待租户恢复结束。 </li><li> RECOVERING：恢复中。 </li></ul></li><li>逻辑备份<ul><li>START：开始。 </li><li> RECOVERING：恢复中。 </li><li> CANCELED：已取消。 </li><li> FAILED：失败。 </li><li> COMPLETED：已完成。 </li><li> RECOVERING DATA：数据恢复中。 </li><li> RECOVERING LOGS：日志恢复中。 </li><li> AN ERROR OCCURRED WHILE RECOVERING DATA：数据恢复失败。 </li><li> FAILED TO RECOVER LOGS：日志恢复失败。 </li></ul></li></ul>  |

### 返回结果

**基础数据结构**

|  参数  |  类型  | 说明                               |
|--------|--------|----------------------------------|
|  data  |  Object  | 详情参见 **`RestoreHistoryTask` 的数据结构** 。 |
|  successful  |  Boolean | 请求是否成功。                          |
|  timestamp |  Datetime  | 服务端完成请求的时间戳。                     |
|  duration |  Integer  | 服务端处理请求的时间（毫秒）。                  |
|  status |  Integer  | 符合 HTTP Status 规范的编码。            |
|  traceId |  String  | 请求的 Trace ID，用于排查问题。             |
|  server  |  String  | 响应请求的应用服务的地址。                    |

**`RestoreHistoryTask` 的数据结构**

|  参数                |  类型      |  说明  |
|----------------------|-----------|-------------|
|  id                  |  Integer  |  恢复任务编号。  |
|  backupMode          |  String   |  恢复模式，复用备份模式字段，包括：<li>LOGICAL_BACKUP：逻辑备份。</li><li>PHYSICAL_BACKUP：物理备份。</li>  |
|  triggerType         |  String   |  触发类型，标记为恢复或者抽检任务。  |
|  createTime          |  String   |  创建时间。  |
|  finishTime          |  String   |  完成时间。  |
|  backupClusterName   |  String   |  备份集群名。  |
|  backupTenantName    |  String   |  备份租户名。  |
|  backupObTenantId    |  Integer  |  备份租户 OceanBase 侧 ID。  |
|  restoreClusterId    |  Integer  |  恢复集群 ID。  |
|  restoreClusterName  |  String   |  恢复集群名。  |
|  restoreObClusterId  |  Integer  |  恢复集群 OceanBase 侧 ID。  |
|  restoreTenantName   |  String   |  恢复租户名。  |
|  restorePoolListStr  |  String   |  恢复资源池列表，多个资源池以逗号隔开。  |
|  restoreUri          |  String   |  备份目录。  |
|  restoreEndTime      |  String   |  恢复时间。  |
|  status              |  String   |  恢复状态。  |
|  statusDesc          |  String   |  恢复状态描述。  |
|  progress            |  String   |  恢复进度，逻辑备份恢复中的基线恢复不支持查看进度，增量恢复时此处填写 `checkpoint`。  |
|  errorMsg            |  String   |  错误信息。  |

## 示例

### 请求示例

`GET /api/v2/ob/clusters/1000005/tenants/1000012/backup/task/restoreTasks?page=1&size=10`

### 返回示例

```JSON
{
  "data": {
    "contents": [
      {
        "backupClusterName": "ob_431",
        "backupMode": "PHYSICAL_BACKUP",
        "backupObTenantId": 1014,
        "backupTenantName": "aiso",
        "createTime": "2024-08-08T08:25:39.150608Z",
        "errorMsg": "",
        "finishTime": "2024-08-08T08:29:50.749986Z",
        "finished": true,
        "id": 2,
        "restoreClusterId": 1000005,
        "restoreClusterName": "ob_431",
        "restoreEndTime": "2024-08-08T08:23:57.422347Z",
        "restoreObClusterId": 199,
        "restoreObjectType": "TENANT",
        "restorePoolListStr": "pool_zhengzhou_zone1_qhi",
        "restoreTenantName": "zhengzhou",
        "restoreUri": "file:///obbackup/ob_431/199/tenant_incarnation_1/1014/clog,file:///obbackup/ob_431/199/tenant_incarnation_1/1014/data",
        "status": "RESTORE_SUCCESS",
        "statusDesc": "已完成",
        "successful": true,
        "triggerType": "NORMAL"
      },
      {
        "backupClusterName": "ob_431",
        "backupMode": "PHYSICAL_BACKUP",
        "backupObTenantId": 1002,
        "backupTenantName": "ob_431_tenant",
        "createTime": "2024-08-08T07:57:33.103869Z",
        "errorMsg": "",
        "finishTime": "2024-08-08T08:01:36.103798Z",
        "finished": true,
        "id": 1,
        "restoreClusterId": 283,
        "restoreClusterName": "ob_431",
        "restoreEndTime": "2024-08-08T07:56:41.851284Z",
        "restoreObClusterId": 199,
        "restoreObjectType": "TENANT",
        "restorePoolListStr": "pool_aiso_zone1_txx",
        "restoreTenantName": "aiso",
        "restoreUri": "file:///obbackup/ob_431/199/tenant_incarnation_1/1002/clog,file:///obbackup/ob_431/199/tenant_incarnation_1/1002/data",
        "status": "RESTORE_SUCCESS",
        "statusDesc": "已完成",
        "successful": true,
        "triggerType": "NORMAL"
      }
    ],
    "page": {
      "number": 1,
      "size": 10,
      "totalElements": 2,
      "totalPages": 1
    }
  },
  "duration": 169,
  "server": "a24d13ce67",
  "status": 200,
  "successful": true,
  "timestamp": "2024-08-09T15:47:50.451+08:00",
  "traceId": "57a90c3ab3b89b93"
}
```
