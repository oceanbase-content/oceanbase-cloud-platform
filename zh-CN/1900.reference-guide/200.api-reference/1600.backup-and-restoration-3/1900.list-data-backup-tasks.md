# 查看租户数据备份任务

## 功能说明

该接口用于查看租户数据备份任务。

## 调用说明

### 接口约束

调用者需要通过 OCP 应用服务鉴权。

### 请求路径

`GET /api/v2/ob/clusters/{id}/tenants/{tenantId}/backup/task/dataBackupTasks`

### 请求参数

**Path 参数**

|  参数  |  类型  |  必选  |  示例值  |  描述  |
|--------|--------|--------|----------|--------|
|  id  |  Integer  |  是  |  1002  |  集群 ID。  |
|  tenantId  |  Integer  |  是  |  108  |  租户 ID。  |

**Query 参数**

|  参数         |  类型    |  必选  |  示例值               |  描述         |
|---------------|----------|--------|-----------------------|--------------|
|  startTime      |  String  |  否     |  2024-08-06T00:00:00Z       |   开始时间，该时间只支持 UTC 时间，格式为：YYYY-MM-DDThh:mm:ssZ。         |
|  endTime        |  String  |  否     |  2024-08-07T00:00:00Z       |   结束时间，该时间只支持 UTC 时间，格式为：YYYY-MM-DDThh:mm:ssZ。         |
|  status       |  Array   |  否    |  DONE                 |  任务状态，包括：<li>BEGINNING：启动中。 </li><li> INITIALIZING：初始化中。 </li><li> DOING：进行中。 </li><li> DONE：已完成。 </li><li> FAILED：失败。 </li><li> CANCELING：取消中。 </li><li> CANCELED：已取消。 </li><li> OVERDUE：已过期。 </li><li> UNKNOWN：未知。 </li>  |
|  backupSetId  |  Integer |  否    |  1                    |  数据备份集 ID。  |

### 返回结果

**基础数据结构**

|  参数  |  类型  | 说明                               |
|--------|----------|----------------------------------|
|  data  |  Object  | 详情参见 **`DataBackupHistoryWrapperTask` 的数据结构**。 |
|  successful  |  Boolean | 请求是否成功。                          |
|  timestamp |  Datetime  | 服务端完成请求的时间戳。                     |
|  duration |  Integer  | 服务端处理请求的时间（毫秒）。                  |
|  status |  Integer  | 符合 HTTP Status 规范的编码。            |
|  traceId |  String  | 请求的 Trace ID，用于排查问题。             |
|  server  |  String  | 响应请求的应用服务的地址。                    |

**`DataBackupHistoryWrapperTask` 的数据结构**

|             参数           |    类型   |                     说明                     |
|----------------------------|-----------|--------------------------------------------|
| backupDimension            | String    | 备份维度，如 CLUSTER 代表集群备份，TENANT 代表租户备份。 |
| taskId                     | Long      | 任务 ID。                                     |
| backupType                 | String    | 备份类型。                                      |
| taskType                   | String    | 任务类型。                                      |
| clusterName                | String    | 集群名。                                       |
| clusterId                  | Long      | 集群 ID。                                     |
| obClusterId                | Long      | OceanBase 集群 ID。                                  |
| obTenantId                 | Long      | OceanBase 侧租户 ID。                                 |
| clusterType                | String    | 集群类型，包括：<li>PRIMARY：主集群。</li><li>STANDBY：备集群。</li>     |
| tenantId                   | Long      | 租户 ID。                                     |
| tenantName                 | String    | 租户名。                                       |
| startTime                  | Timestamp | 开始时间。                                      |
| finishTime                 | Timestamp | 结束时间。                                      |
| status                     | String    | 状态。                                        |
| errorMsg                   | String    | 错误信息。                                      |
| dataVersion                | Long      | 数据版本号。                                     |
| backupUri                  | String    | 备份路径。                                      |
| dataType                   | String    | 数据类型。                                      |
| schemaVersion              | Long      | Schema 版本号。                                |
| backupSetId                | Long      | 数据备份集 ID。                                  |
| backupMode                 | String    | 备份模式。                                      |
| dataBackupTaskType         | String    | 数据备份任务类型。                                  |
| dataSecondaryBackupTaskIds | Arrays    | 基于该数据备份集 ID 做过的二次备份任务 ID 列表，在物理备份下该字段才有意义。 |

## 示例

### 请求示例

`GET /api/v2/ob/clusters/1000005/tenants/1000012/backup/task/dataBackupTasks?page=1&size=10`

### 返回示例

```JSON
{
  "data": {
    "contents": [
      {
        "backupDimension": "TENANT",
        "backupMode": "PHYSICAL_BACKUP",
        "backupSetId": 1,
        "backupUri": "file:///obbackup/ob_431/199/tenant_incarnation_1/1050/data",
        "clusterId": 1000005,
        "clusterName": "ob_431",
        "clusterType": "PRIMARY",
        "dataBackupTaskType": "FULL_BACKUP",
        "duration": 125,
        "errorMsg": "",
        "finishTime": "2024-08-09T08:02:57.715753Z",
        "obClusterId": 199,
        "obTenantId": 1050,
        "snapshotVersionTime": "2024-08-09T08:02:57.647741Z",
        "startTime": "2024-08-09T08:00:52.151857Z",
        "status": "DONE",
        "taskId": 1,
        "tenantId": 1000012,
        "tenantName": "ww1144"
      }
    ],
    "page": {
      "number": 1,
      "size": 5000,
      "totalElements": 1,
      "totalPages": 1
    }
  },
  "duration": 122,
  "server": "a24d13ce67",
  "status": 200,
  "successful": true,
  "timestamp": "2024-08-09T16:13:34.483+08:00",
  "traceId": "5cf1b02e0f6f76b3"
}
```
