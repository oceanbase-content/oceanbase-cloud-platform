# 查询租户备份策略

## 功能说明

该接口用于查询租户备份策略。

## 调用说明

### 接口约束

调用者需要通过 OCP 应用服务鉴权。

### 请求路径

`GET /api/v2/ob/clusters/{id}/tenants/{tenantId}/backup/config/backupStrategy`

### 请求参数

**Path 参数**

|  参数      |  类型     |  必选  |  示例值  |  描述   |
|------------|-----------|--------|---------|----------|
|  id        |  Integer  |  是    |  1002   |  集群 ID。  |
|  tenantId  |  Integer  |  是    |  108    |  租户 ID。  |

### 返回结果

**基础数据结构**

|  参数        |  类型      |  说明                               |
|--------------|------------|----------------------------------|
|  data        |  Object    | 备份策略详情，详情参见 **`OcpBackupStrategy` 的数据结构** 。 |
|  successful  |  Boolean   | 请求是否成功。                          |
|  timestamp   |  Datetime  | 服务端完成请求的时间戳。                     |
|  duration    |  Integer   | 服务端处理请求的时间（毫秒）。                  |
|  status      |  Integer   | 符合 HTTP Status 规范的编码。            |
|  traceId     |  String    | 请求的 Trace ID，用于排查问题。             |
|  server      |  String    | 响应请求的应用服务的地址。                    |

**`OcpBackupStrategy` 的数据结构**

|  参数                          |  类型                          |  说明        |
|--------------------------------|--------------------------------|-------------|
|  id                            |  Integer                       |  策略 ID。  |
|  createTime                    |  String                        |  创建时间。  |
|  updateTime                    |  String                        |  更新时间。  |
|  clusterName                   |  String                        |  集群名。  |
|  obClusterId                   |  Integer                       |  OceanBase 集群 ID。  |
|  clusterId                     |  Integer                       |  集群 ID。  |
|  backupDimension               |  String                        |  备份维度，如 CLUSTER 代表集群备份，TENANT 代表租户备份。  |
|  tenantName                    |  String                        |  租户名。  |
|  obTenantId                    |  Integer                       |  OceanBase 侧租户 ID。 |
|  tenantId                      |  Integer                       |  租户 ID。  |
|  type                          |  String                        |  备份目的类型。  |
|  obBackupServiceStorageConfig  |  ObBackupServiceStorageConfig  |  备份存储配置，详情参见 **`ObBackupServiceStorageConfig` 的数据结构** 。  |
|  backupMode                    |  String                        |  备份恢复方式，包括：<li>LOGICAL_BACKUP：逻辑备份。</li><li>PHYSICAL_BACKUP：物理备份。</li>  |
|  serviceConfigName             |  String                        |  服务配置名。  |
|  obBackupScheduleConfig        |  ObBackupScheduleConfig        |  备份调度配置，详情请参见 **`obBackupScheduleConfig` 的数据结构** 。  |
|  obBackupThresholdConfig       |  ObBackupThresholdConfig       |  备份告警阈值配置，详情参见 **`ObBackupThresholdConfig` 的数据结构** 。  |

**`ObBackupServiceStorageConfig` 的数据结构**

|  参数                             |  类型     |  说明  |
|-----------------------------------|-----------|------------------|
|  configName                       |  String   |  存储配置名。  |
|  obBackupStorageBaseInfo          |  ObBackupStorageBaseInfo  |  备份存储信息，详情参见 **`ObBackupStorageBaseInfo` 的数据结构** 。  |
|  alarmStoragePercentageThreshold  |  Integer  |  备份存储容量报警阈值，请配置为百分比。  |
|  storageId                        |  Integer  |  存储配置 ID。  |
|  serviceType                      |  String   |  服务类型，包括：<li>BACKUP_RESTORE_SERVICE：备份恢复服务（逻辑备份恢复）。</li><li>OB_CLUSTER：OceanBase 集群（物理备份恢复）。</li><li>OTHERS：其它。</li>  |
|  serviceId                        |  Integer  |  服务 ID。当服务类型为 BACKUP_RESTORE_SERVICE 时，代表备份恢复服务 ID；当服务类型为 OB_CLUSTER 时，代表集群 ID。  |
|  serviceName                      |  String   |  服务名。当服务类型为 BACKUP_RESTORE_SERVICE 时，代表备份恢复服务名；当服务类型为 OB_CLUSTER 时，代表集群名。  |
|  hostIdList                       |  Array    |  主机 ID 列表，用于全局恢复的解析主机列表。当服务类型为 BACKUP_RESTORE_SERVICE 时，代表备份恢复服务的主机 ID 列表；当服务类型为 OB_CLUSTER 时，代表集群的主机 ID 列表。     |

**`ObBackupStorageBaseInfo` 的数据结构**

|  参数               |  类型          |  说明  |
|---------------------|----------------|----|
|  backupStorageType  |  String        |  存储类型，目前支持 `BACKUP_STORAGE_FILE`、`BACKUP_STORAGE_OSS`、`BACKUP_STORAGE_COS`、`BACKUP_STORAGE_S3` 四种类型。  |
|  storageUrl         |  String        |  存储目录，请配置为不带协议的目录，如 `/obbackup/` 或 `osstest/backup`。  |
|  ossAccessKey       |  OssAccessKey  |  OSS 信息，仅在 `backupStorageType=BACKUP_STORAGE_OSS` 时有效，详情参见 **`OssAccessKey` 的数据结构** 。  |
|  cosAccessKey       |  CosAccessKey  |  OCS 信息，仅在 `backupStorageType=BACKUP_STORAGE_COS` 时有效，详情参见 **`CosAccessKey` 的数据结构** 。  |
|  s3AccessKey       |  S3AccessKey  |  S3 信息，仅在 `backupStorageType=BACKUP_STORAGE_S3` 时有效，详情参见 **`S3AccessKey` 的数据结构** 。  |

**`OssAccessKey` 的数据结构**

|  参数             |  类型     |  说明     |
|-------------------|----------|-------------|
|  endpoint         |  String  |  访问域名。  |
|  accessKeyId      |  String  |  访问用户。  |
|  accessKeySecret  |  String  |  访问秘钥。  |

**`CosAccessKey` 的数据结构**

|  参数             |  类型    |  说明         |
|-------------------|----------|---------------|
|  endpoint         |  String  |  访问域名。   |
|  accessKeyId      |  String  |  访问用户。  |
|  accessKeySecret  |  String  |  访问秘钥。  |
|  appId            |  String  |  应用 ID。  |

**`S3AccessKey` 的数据结构**

|  参数             |  类型    |  说明         |
|-------------------|----------|---------------|
|  endpoint         |  String  |  访问域名。   |
|  accessKeyId      |  String  |  访问用户。  |
|  accessKeySecret  |  String  |  访问秘钥。  |
|  region           |  String  |  地域。  |

**`ObBackupScheduleConfig` 的数据结构**

|  参数                      |  类型     |  说明         |
|----------------------------|-----------|------------------|
|  backupScheduleMode        |  String   |  备份调度周期，包括：<li>WEEK：周。</li><li>MONTH：月。</li>。  |
|  backupScheduleEnabled     |  Boolean  |  备份开关。  |
|  backupScheduleTime        |  Object   |  备份调度时间，如 "02:00:00.000+08:00"。  |
|  dayAndDataBackupModelMap  |  Object   |  调度日与其数据备份方式，如 { "2": "FULL_BACKUP", "4": "FULL_BACKUP", "6": "INCREMENTAL_BACKUP" } 代表周二、周四做全量数据备份，周六做增量数据备份。。  |
|  startLogBackup            |  Boolean  |  是否同时启动日志备份，一般均设置为 `true`。  |
|  cleanEnabled              |  Boolean  |  过期数据清理开关。  |
|  backupDataRetentionDays   |  Integer  |  备份数据保留天数。如 7 天，代表保留至少最近 7 天的备份数据。仅在 `cleanEnabled=true` 时生效。  |
|  cleanScheduleTime         |  Object   |  过期数据清理的调度时间。  |

**`ObBackupThresholdConfig` 的数据结构**

|               参数              |  类型  |   说明              |
|---------------------------------|--------|-----------------------------|
| dataBackupTimeoutMinutes        | Long | 数据备份调度超时时间，单位为分钟。           |
| noSuccessfulDataBackupAlarmDays | Long | 无成功数据备份告警触发的最大天数。           |
| libObLogExpireDays              | Long | liboblog 的保留天数，仅在逻辑备份模式下有效。 |
| logBackupDelaySeconds           | Long | 日志备份延迟告警阈值，单位为秒。            |

## 示例

### 请求示例

`GET /api/v2/ob/clusters/1000005/tenants/1000012/backup/config/backupStrategy`

### 返回示例

```JSON
{
  "data": {
        "backupDimension": "TENANT",
        "backupMode": "PHYSICAL_BACKUP",
        "clusterId": 1000005,
        "clusterName": "yc0820_17",
        "createTime": "2024-08-02T14:54:45.000+0800",
        "id": 1,
        "obBackupThresholdConfig": {
            "dataBackupTimeoutMinutes": 7,
            "logBackupDelaySeconds": 300,
            "noSuccessfulDataBackupAlarmDays": 2
        },
        "obBackupScheduleConfig": {
            "dayAndDataBackupModelMap": {
                "2": "FULL_BACKUP",
                "4": "FULL_BACKUP",
                "6": "FULL_BACKUP"
            },
            "startLogBackup": true,
            "backupScheduleEnabled": true,
            "backupScheduleMode": "WEEK",
            "backupScheduleTime": "02:00:00.000+08:00"
        },
        "obBackupServiceStorageConfig": {
            "configName": "nfs0907_1452",
            "obBackupStorageBaseInfo": {
                "backupStorageType": "BACKUP_STORAGE_FILE",
                "storageUrl": "/obbackup/"
            },
            "alarmStoragePercentageThreshold": 80,
            "storageId": 26
        },
        "obClusterId": 5,
        "obTenantId": 1001,
        "physical": true,
        "physicalAndWasLogical": false,
        "retainMode": "RESERVE_ALL",
        "secondaryBackupEnabled": false,
        "tenantId": 1000012,
        "tenantName": "yctest",
        "type": "BACKUP",
        "updateTime": "2024-08-02T14:54:45.379+0800"
    },
    "duration": 51,
    "server": "a83ad33525",
    "status": 200,
    "successful": true,
    "timestamp": "2024-08-07T16:32:06.441+08:00",
    "traceId": "5962f337662d4043"
}
```
