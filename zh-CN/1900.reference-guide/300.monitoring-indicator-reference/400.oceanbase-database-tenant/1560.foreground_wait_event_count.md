# 前台工作负载

本节为您介绍 OceanBase 租户的监控指标前台工作负载，该指标细分为 11 个指标，分别为 on_cpu（处于 on cpu 状态执行数据库命令的会话数）、application（处于客户端代码导致的等待事件数）、configuration（处于数据库或实例资源配置不足而导致的等待事件数）、administrative（处于数据库管理员输入命令导致用户等待的等待事件数）、concurrency（处于等待数据库内部资源的等待事件数）、commit（处于在日志提交有关的等待事件数）、network（处于网络通信相关的等待事件数）、user_io（处于用户 I/O 的等待事件数）、system_io（处于前台进程 I/O 的等待事件数）、cluster（处于与集群相关的等待事件数）、other（处于不属于其他类型的等待事件数）。您可指定统计范围，查询租户在单个 Zone 或 OBServer 节点的 **前台工作负载** 数据。

## on_cpu

### 指标介绍

统计范围内，处于 on cpu 状态执行数据库命令的会话数。

### 指标参数说明

| **指标项** |     **指标名称**      | **单位** |
|---------|-------------------|--------|
| on_cpu     | ob_foreground_on_cpu_waitevent_cnt |   个    |

### 计算表达式

sum(ob_foreground_waitevent_cnt{wait_class="ON_CPU",@LABELS}) by (@GBLABELS)

### 采集 SQL

OceanBase V4.2.0.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 0 group by wait_class, tenant_id
  ```

## application

### 指标介绍

统计范围内，处于客户端代码导致的等待事件数。

### 指标参数说明

| **指标项** |         **指标名称**         | **单位** |
|---------|--------------------------|--------|
| application     | ob_foreground_application_waitevent_cnt |   个   |

### 计算表达式

sum(ob_foreground_waitevent_cnt{wait_class="APPLICATION",@LABELS}) by (@GBLABELS)

### 采集 SQL

OceanBase V4.2.0.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 0 group by wait_class, tenant_id
  ```

## configuration

### 指标介绍

统计范围内，处于数据库或实例资源配置不足而导致的等待事件数。

### 指标参数说明

| **指标项** |          **指标名称**          | **单位** |
|---------|----------------------------|--------|
| configuration    | ob_foreground_configuration_waitevent_cnt |   个   |

### 计算表达式

sum(ob_foreground_waitevent_cnt{wait_class="CONFIGURATION",@LABELS}) by (@GBLABELS)

### 采集 SQL

OceanBase V4.2.0.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 0 group by wait_class, tenant_id
  ```

## administrative

### 指标介绍

统计范围内，处于数据库管理员输入命令导致用户等待的等待事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| administrative     | ob_foreground_administrative_waitevent_cnt | 个      |

### 计算表达式

sum(ob_foreground_waitevent_cnt{wait_class="ADMINISTRATIVE",@LABELS}) by (@GBLABELS)

### 采集 SQL

OceanBase V4.2.0.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 0 group by wait_class, tenant_id
  ```

## concurrency

### 指标介绍

统计范围内，处于等待数据库内部资源的等待事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| concurrency     | ob_foreground_concurrency_waitevent_cnt | 个      |

### 计算表达式

sum(ob_foreground_waitevent_cnt{wait_class="CONCURRENCY",@LABELS}) by (@GBLABELS)

### 采集 SQL

OceanBase V4.2.0.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 0 group by wait_class, tenant_id
  ```

## commit

### 指标介绍

统计范围内，处于在日志提交有关的等待事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| commit     | ob_foreground_commit_waitevent_cnt | 个      |

### 计算表达式

sum(ob_foreground_waitevent_cnt{wait_class="COMMIT",@LABELS}) by (@GBLABELS)

### 采集 SQL

OceanBase V4.2.0.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 0 group by wait_class, tenant_id
  ```

## network

### 指标介绍

统计范围内，处于网络通信相关的等待事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| network     | ob_foreground_network_waitevent_cnt | 个     |

### 计算表达式

sum(ob_foreground_waitevent_cnt{wait_class="NETWORK",@LABELS}) by (@GBLABELS)

### 采集 SQL

OceanBase V4.2.0.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 0 group by wait_class, tenant_id
  ```

## user_io

### 指标介绍

统计范围内，处于用户 I/O 的等待事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| user_io     | ob_foreground_user_io_waitevent_cnt | 个      |

### 计算表达式

sum(ob_foreground_waitevent_cnt{wait_class="USER_IO",@LABELS}) by (@GBLABELS)

### 采集 SQL

OceanBase V4.2.0.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 0 group by wait_class, tenant_id
  ```

## system_io

### 指标介绍

统计范围内，处于前台进程 I/O 的等待事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| system_io     | ob_foreground_system_io_waitevent_cnt | 个      |

### 计算表达式

sum(ob_foreground_waitevent_cnt{wait_class="SYSTEM_IO",@LABELS}) by (@GBLABELS)

### 采集 SQL

OceanBase V4.2.0.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 0 group by wait_class, tenant_id
  ```

## cluster

### 指标介绍

统计范围内，处于与集群相关的等待事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| cluster    | ob_foreground_cluster_waitevent_cnt | 个      |

### 计算表达式

sum(ob_foreground_waitevent_cnt{wait_class="CLUSTER",@LABELS}) by (@GBLABELS)

### 采集 SQL

OceanBase V4.2.0.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 0 group by wait_class, tenant_id
  ```

## other

### 指标介绍

统计范围内，处于不属于其他类型的等待事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| other     | ob_foreground_other_waitevent_cnt | 个      |

### 计算表达式

sum(ob_foreground_waitevent_cnt{wait_class="OTHER",@LABELS}) by (@GBLABELS)

### 采集 SQL

OceanBase V4.2.0.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ ash.tenant_id tenant_id, if (ash.event_no is null or ash.event_no = 0, 'ON_CPU', wait_class) wait_class, count(*) as cnt FROM oceanbase.__all_virtual_ash ash LEFT JOIN oceanbase.v$event_name name on ash.event_no = name.`event#` WHERE sample_time between now() - INTERVAL 1 SECOND and now() and (wait_class <> 'IDLE' or wait_class is null) and session_type = 0 group by wait_class, tenant_id
  ```
