# XA 事务数

本节为您介绍 OceanBase 租户的性能指标 **XA 事务数** 。 **XA 事务数** 指标用于统计 OceanBase 租户的 XA 事务总数。该指标细分为 3 个子指标对租户的 XA 事务数量进行统计，包括：xa_trans_start_count、xa_read_only_trans_total_count、xa_one_phase_commit_total_count。您可指定统计范围，查询租户在单个 Zone 或 OBServer 节点的 **XA 事务数** 。

## xa_trans_start_count

### 指标介绍

OceanBase 租户中已经成功开启的 XA 事务总个数（包含已经结束的）。

### 指标参数说明

|  **指标项**  |  **指标名称**  | **单位** |
|-----------|----------|--------|
| xa_trans_start_count | xa_trans_start_count | 个  |

### 计算表达式

sum(rate(ob_sysstat{stat_id="30220",@LABELS}[@INTERVAL])) by (@GBLABELS)

### 采集 SQL

* OceanBase V4.0 以下版本：

  ```sql
  select /*+ MONITOR_AGENT READ_CONSISTENCY(WEAK) */ con_id tenant_id, stat_id, value from v$sysstat where stat_id IN (10000, 10001, 10002, 10003, 10004, 10005, 10006, 140002, 140003, 140005, 140006, 140012, 140013, 40030, 80040, 80041, 130000, 130001, 130002, 130004, 20000, 20001, 20002, 30000, 30001, 30002, 30005, 30006, 30007, 30008, 30009, 30010, 30011, 30012, 30013, 30080, 30081, 30220, 30221, 30222, 30200, 30201, 30204, 30205, 30208, 30209, 30212, 30213, 30216, 30217, 40000, 40001, 40002, 40003, 40004, 40005, 40006, 40007, 40008, 40009, 40010, 40011, 40012, 40018, 40019, 40116, 40117, 40118, 50000, 50001, 50002, 50004, 50005, 50008, 50009, 50010, 50011, 50037, 50038, 60000, 60001, 60002, 60003, 60004, 60005, 60019, 60020, 60021, 60022, 60023, 60024, 80057, 120000, 120001, 120009, 120008) and (con_id > 1000 or con_id = 1) and class < 1000
  ```

* OceanBase V4.0 及以上版本：

  ```sql
  select /* MONITOR_AGENT */ con_id tenant_id, stat_id, value from v$sysstat where stat_id IN (10000, 10001, 10002, 10003, 10004, 10005, 10006, 140002, 140003, 140005, 140006, 140012, 140013, 40030, 80040, 80041, 130000, 130001, 130002, 130004, 20000, 20001, 20002, 30000, 30001, 30002, 30005, 30006, 30007, 30008, 30009, 30010, 30011, 30012, 30013, 30080, 30081, 30082, 30083, 30084, 30085, 30086, 30220, 30221, 30222, 30200, 30201, 30204, 30205, 30208, 30209, 30212, 30213, 30216, 30217, 40000, 40001, 40002, 40003, 40004, 40005, 40006, 40007, 40008, 40009, 40010, 40011, 40012, 40018, 40019, 40116, 40117, 40118, 50000, 50001, 60087, 50004, 50005, 50008, 50009, 50010, 50011, 50037, 50038, 60000, 60001, 60002, 60003, 60004, 60005, 60019, 60020, 60021, 60022, 60023, 60024, 80001, 80002, 80003, 80007, 80008, 80009, 80057, 120000, 120001, 120009, 120008) and (con_id > 1000 or con_id = 1) and class < 1000
  ```

## xa_read_only_trans_total_count

### 指标介绍

OceanBase 租户中只读的 XA 事务总个数。

### 指标参数说明

| **指标项**  |   **指标名称**   | **单位** |
|----------|---------|--------|
| xa_read_only_trans_total_count | xa_read_only_trans_total_count | 个      |

### 计算表达式

sum(rate(ob_sysstat{stat_id="30221",@LABELS}[@INTERVAL])) by (@GBLABELS)

### 采集 SQL

* OceanBase V4.0 以下版本：

  ```sql
  select /*+ MONITOR_AGENT READ_CONSISTENCY(WEAK) */ con_id tenant_id, stat_id, value from v$sysstat where stat_id IN (10000, 10001, 10002, 10003, 10004, 10005, 10006, 140002, 140003, 140005, 140006, 140012, 140013, 40030, 80040, 80041, 130000, 130001, 130002, 130004, 20000, 20001, 20002, 30000, 30001, 30002, 30005, 30006, 30007, 30008, 30009, 30010, 30011, 30012, 30013, 30080, 30081, 30220, 30221, 30222, 30200, 30201, 30204, 30205, 30208, 30209, 30212, 30213, 30216, 30217, 40000, 40001, 40002, 40003, 40004, 40005, 40006, 40007, 40008, 40009, 40010, 40011, 40012, 40018, 40019, 40116, 40117, 40118, 50000, 50001, 50002, 50004, 50005, 50008, 50009, 50010, 50011, 50037, 50038, 60000, 60001, 60002, 60003, 60004, 60005, 60019, 60020, 60021, 60022, 60023, 60024, 80057, 120000, 120001, 120009, 120008) and (con_id > 1000 or con_id = 1) and class < 1000
  ```

* OceanBase V4.0 及以上版本：

  ```sql
  select /* MONITOR_AGENT */ con_id tenant_id, stat_id, value from v$sysstat where stat_id IN (10000, 10001, 10002, 10003, 10004, 10005, 10006, 140002, 140003, 140005, 140006, 140012, 140013, 40030, 80040, 80041, 130000, 130001, 130002, 130004, 20000, 20001, 20002, 30000, 30001, 30002, 30005, 30006, 30007, 30008, 30009, 30010, 30011, 30012, 30013, 30080, 30081, 30082, 30083, 30084, 30085, 30086, 30220, 30221, 30222, 30200, 30201, 30204, 30205, 30208, 30209, 30212, 30213, 30216, 30217, 40000, 40001, 40002, 40003, 40004, 40005, 40006, 40007, 40008, 40009, 40010, 40011, 40012, 40018, 40019, 40116, 40117, 40118, 50000, 50001, 60087, 50004, 50005, 50008, 50009, 50010, 50011, 50037, 50038, 60000, 60001, 60002, 60003, 60004, 60005, 60019, 60020, 60021, 60022, 60023, 60024, 80001, 80002, 80003, 80007, 80008, 80009, 80057, 120000, 120001, 120009, 120008) and (con_id > 1000 or con_id = 1) and class < 1000
  ```

## xa_one_phase_commit_total_count

### 指标介绍

OceanBase 租户中采用一阶段提交的 XA 事务总个数。

### 指标参数说明

| **指标项**  |   **指标名称**   | **单位** |
|----------|---------|--------|
| xa_one_phase_commit_total_count | xa_one_phase_commit_total_count | 个      |

### 计算表达式

sum(rate(ob_sysstat{stat_id="30222",@LABELS}[@INTERVAL])) by (@GBLABELS)

### 采集 SQL

* OceanBase V4.0 以下版本：

  ```sql
  select /*+ MONITOR_AGENT READ_CONSISTENCY(WEAK) */ con_id tenant_id, stat_id, value from v$sysstat where stat_id IN (10000, 10001, 10002, 10003, 10004, 10005, 10006, 140002, 140003, 140005, 140006, 140012, 140013, 40030, 80040, 80041, 130000, 130001, 130002, 130004, 20000, 20001, 20002, 30000, 30001, 30002, 30005, 30006, 30007, 30008, 30009, 30010, 30011, 30012, 30013, 30080, 30081, 30220, 30221, 30222, 30200, 30201, 30204, 30205, 30208, 30209, 30212, 30213, 30216, 30217, 40000, 40001, 40002, 40003, 40004, 40005, 40006, 40007, 40008, 40009, 40010, 40011, 40012, 40018, 40019, 40116, 40117, 40118, 50000, 50001, 50002, 50004, 50005, 50008, 50009, 50010, 50011, 50037, 50038, 60000, 60001, 60002, 60003, 60004, 60005, 60019, 60020, 60021, 60022, 60023, 60024, 80057, 120000, 120001, 120009, 120008) and (con_id > 1000 or con_id = 1) and class < 1000
  ```

* OceanBase V4.0 及以上版本：

  ```sql
  select /* MONITOR_AGENT */ con_id tenant_id, stat_id, value from v$sysstat where stat_id IN (10000, 10001, 10002, 10003, 10004, 10005, 10006, 140002, 140003, 140005, 140006, 140012, 140013, 40030, 80040, 80041, 130000, 130001, 130002, 130004, 20000, 20001, 20002, 30000, 30001, 30002, 30005, 30006, 30007, 30008, 30009, 30010, 30011, 30012, 30013, 30080, 30081, 30082, 30083, 30084, 30085, 30086, 30220, 30221, 30222, 30200, 30201, 30204, 30205, 30208, 30209, 30212, 30213, 30216, 30217, 40000, 40001, 40002, 40003, 40004, 40005, 40006, 40007, 40008, 40009, 40010, 40011, 40012, 40018, 40019, 40116, 40117, 40118, 50000, 50001, 60087, 50004, 50005, 50008, 50009, 50010, 50011, 50037, 50038, 60000, 60001, 60002, 60003, 60004, 60005, 60019, 60020, 60021, 60022, 60023, 60024, 80001, 80002, 80003, 80007, 80008, 80009, 80057, 120000, 120001, 120009, 120008) and (con_id > 1000 or con_id = 1) and class < 1000
  ```
