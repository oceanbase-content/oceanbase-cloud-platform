# SQL 执行事件数

本节为您介绍 OceanBase 租户的监控指标 SQL 执行事件数，该指标细分为 13 个指标，分别为 in_parse（处于 parse 状态的执行事件数）、in_pl_parse（处于 pl parse 状态的执行事件数）、in_plan_cache（处于 plan cache 状态的执行事件数）、in_sql_optimize（处于 sql optimize 状态的执行事件数）、in_sql_execution（处于 sql execution 状态的执行事件数）、in_px_execution（处于 px execution 状态的执行事件数）、in_sequence_load（处于 sequence load 状态的执行事件数）、in_committing（处于 committing 状态的执行事件数）、in_storage_read（处于 storage read 状态的执行事件数）、in_storage_write（处于 storage write 状态的执行事件数）、in_remote_das_execution（处于 remote das execution 状态的执行事件数）、in_plsql_compilation（处于 plsql compilation 状态的执行事件数）、in_plsql_execution（处于 plsql execution 状态的执行事件数）。您可指定统计范围，查询租户在单个 Zone 或 OBServer 节点的 **SQL 执行事件数** 数据。

## in_parse

### 指标介绍

统计范围内，租户处于 parse 状态的执行事件数。

### 指标参数说明

| **指标项** |     **指标名称**      | **单位** |
|---------|-------------------|--------|
| in_parse     | sql_event_in_parse |   个    |

### 计算表达式

sum(ob_sql_event_in_parse{@LABELS}) by (@GBLABELS)

### 采集 SQL

* OceanBase V4.2.0.0 及以上、V4.2.1.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.1.0 及以上、V4.2.2.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.2.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_COMPILATION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_COMPILATION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_FILTER_ROWS = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_FILTER_ROWS FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

## in_pl_parse

### 指标介绍

统计范围内，租户处于 pl parse 状态的执行事件数。

### 指标参数说明

| **指标项** |         **指标名称**         | **单位** |
|---------|--------------------------|--------|
| in_pl_parse     | sql_event_in_pl_parse |   个   |

### 计算表达式

sum(ob_sql_event_in_pl_parse{@LABELS}) by (@GBLABELS)

### 采集 SQL

* OceanBase V4.2.0.0 及以上、V4.2.1.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.1.0 及以上、V4.2.2.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.2.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_COMPILATION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_COMPILATION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_FILTER_ROWS = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_FILTER_ROWS FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

## in_plan_cache

### 指标介绍

统计范围内，租户处于 plan cache 状态的执行事件数。

### 指标参数说明

| **指标项** |          **指标名称**          | **单位** |
|---------|----------------------------|--------|
| in_plan_cache    | sql_event_in_plan_cache |   个   |

### 计算表达式

sum(ob_sql_event_in_plan_cache{@LABELS}) by (@GBLABELS)

### 采集 SQL

* OceanBase V4.2.0.0 及以上、V4.2.1.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.1.0 及以上、V4.2.2.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.2.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_COMPILATION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_COMPILATION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_FILTER_ROWS = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_FILTER_ROWS FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

## in_sql_optimize

### 指标介绍

统计范围内，租户处于 sql optimize 状态的执行事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| in_sql_optimize     | sql_event_in_sql_optimize | 个      |

### 计算表达式

sum(ob_sql_event_in_sql_optimize{@LABELS}) by (@GBLABELS)

### 采集 SQL

* OceanBase V4.2.0.0 及以上、V4.2.1.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.1.0 及以上、V4.2.2.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.2.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_COMPILATION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_COMPILATION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_FILTER_ROWS = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_FILTER_ROWS FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

## in_sql_execution

### 指标介绍

统计范围内，租户处于 sql execution 状态的执行事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| in_sql_execution     | sql_event_in_sql_execution | 个      |

### 计算表达式

sum(ob_sql_event_in_sql_execution{@LABELS}) by (@GBLABELS)

### 采集 SQL

* OceanBase V4.2.0.0 及以上、V4.2.1.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.1.0 及以上、V4.2.2.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.2.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_COMPILATION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_COMPILATION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_FILTER_ROWS = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_FILTER_ROWS FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

## in_px_execution

### 指标介绍

统计范围内，租户处于 px execution 状态的执行事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| in_px_execution     | sql_event_in_px_execution | 个      |

### 计算表达式

sum(ob_sql_event_in_px_execution{@LABELS}) by (@GBLABELS)

### 采集 SQL

* OceanBase V4.2.0.0 及以上、V4.2.1.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.1.0 及以上、V4.2.2.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.2.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_COMPILATION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_COMPILATION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_FILTER_ROWS = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_FILTER_ROWS FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

## in_sequence_load

### 指标介绍

统计范围内，租户处于 sequence load 状态的执行事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| in_sequence_load     | sql_event_in_sequence_load | 个     |

### 计算表达式

sum(ob_sql_event_in_sequence_load{@LABELS}) by (@GBLABELS)

### 采集 SQL

* OceanBase V4.2.0.0 及以上、V4.2.1.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.1.0 及以上、V4.2.2.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.2.0及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_COMPILATION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_COMPILATION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_FILTER_ROWS = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_FILTER_ROWS FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

## in_committing

### 指标介绍

统计范围内，租户处于 committing 状态的执行事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| in_committing     | sql_event_in_committing | 个      |

### 计算表达式

sum(ob_sql_event_in_committing{@LABELS}) by (@GBLABELS)

### 采集 SQL

* OceanBase V4.2.1.0 及以上、V4.2.2.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.2.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_COMPILATION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_COMPILATION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_FILTER_ROWS = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_FILTER_ROWS FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

## in_storage_read

### 指标介绍

统计范围内，租户处于 storage read 状态的执行事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| in_storage_read     | sql_event_in_storage_read | 个      |

### 计算表达式

sum(ob_sql_event_in_storage_read{@LABELS}) by (@GBLABELS)

### 采集 SQL

* OceanBase V4.2.1.0 及以上、V4.2.2.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.2.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_COMPILATION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_COMPILATION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_FILTER_ROWS = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_FILTER_ROWS FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

## in_storage_write

### 指标介绍

统计范围内，租户处于 storage write 状态的执行事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| in_storage_write     | sql_event_in_storage_write | 个      |

### 计算表达式

sum(ob_sql_event_in_storage_write{@LABELS}) by (@GBLABELS)

### 采集 SQL

* OceanBase V4.2.1.0 及以上、V4.2.2.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.2.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_COMPILATION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_COMPILATION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_FILTER_ROWS = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_FILTER_ROWS FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

## in_remote_das_execution

### 指标介绍

统计范围内，租户处于 remote das execution 状态的执行事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| in_remote_das_execution     | sql_event_in_remote_das_execution | 个      |

### 计算表达式

sum(ob_sql_event_in_remote_das_execution{@LABELS}) by (@GBLABELS)

### 采集 SQL

* OceanBase V4.2.1.0 及以上、V4.2.2.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

* OceanBase V4.2.2.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_COMPILATION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_COMPILATION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_FILTER_ROWS = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_FILTER_ROWS FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

## in_plsql_compilation

### 指标介绍

统计范围内，租户处于 plsql compilation 状态的执行事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| in_plsql_compilation     | sql_event_in_plsql_compilation | 个      |

### 计算表达式

sum(ob_sql_event_in_plsql_compilation{@LABELS}) by (@GBLABELS)

### 采集 SQL

OceanBase V4.2.2.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_COMPILATION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_COMPILATION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_FILTER_ROWS = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_FILTER_ROWS FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```

## in_plsql_execution

### 指标介绍

统计范围内，租户处于 plsql execution 状态的执行事件数。

### 指标参数说明

| **指标项** |         **指标名称**          | **单位** |
|---------|---------------------------|--------|
| in_plsql_execution     | sql_event_in_plsql_execution | 个      |

### 计算表达式

sum(ob_sql_event_in_plsql_execution{@LABELS}) by (@GBLABELS)

### 采集 SQL

OceanBase V4.2.2.0 及以上、V4.3.0.0 以下版本：

  ```sql
  SELECT /*+ MONITOR_AGENT */ t.tenant_id tenant_id, COALESCE(CAST(SUM(CASE WHEN IN_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PL_PARSE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PL_PARSE, COALESCE(CAST(SUM(CASE WHEN IN_PLAN_CACHE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLAN_CACHE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_OPTIMIZE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_OPTIMIZE, COALESCE(CAST(SUM(CASE WHEN IN_SQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PX_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PX_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_SEQUENCE_LOAD = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_SEQUENCE_LOAD, COALESCE(CAST(SUM(CASE WHEN IN_COMMITTING = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_COMMITTING, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_READ = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_READ, COALESCE(CAST(SUM(CASE WHEN IN_STORAGE_WRITE = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_STORAGE_WRITE, COALESCE(CAST(SUM(CASE WHEN IN_REMOTE_DAS_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_REMOTE_DAS_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_COMPILATION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_COMPILATION, COALESCE(CAST(SUM(CASE WHEN IN_PLSQL_EXECUTION = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_PLSQL_EXECUTION, COALESCE(CAST(SUM(CASE WHEN IN_FILTER_ROWS = 1 THEN 1 ELSE 0 END) AS SIGNED INTEGER), 0) AS IN_FILTER_ROWS FROM (select * from oceanbase.__all_virtual_ash WHERE sample_time between now() - INTERVAL 1 SECOND and now()) ash right join (select distinct tenant_id from dba_ob_tenants) t on ash.tenant_id = t.tenant_id group by tenant_id
  ```
