# 采集集群转储合并增量数据

## 采集描述

查看集群转储合并增量数据。

## 采集原理

OceanBase V4.0.0 之前版本：

```sql
SELECT svr_ip, svr_port, SUM(size)/1024/1024/1024 data_size_gb 
FROM __all_virtual_table_mgr 
WHERE table_type > 1
GROUP BY svr_ip, svr_port 
ORDER BY data_size_gb DESC
```

OceanBase V4.0.0 及之后版本：

```sql
SELECT svr_ip, svr_port, SUM(size)/1024/1024/1024 data_size_gb 
FROM __all_virtual_table_mgr 
WHERE table_type > 10
GROUP BY svr_ip, svr_port 
ORDER BY data_size_gb DESC
```

## 可能的影响

一般转储合并会同时存在写入和输出两份数据，该情况会造成磁盘占用量增加，本操作用于统计相关增量数据。

## OceanBase V3.x 版本的 table_type

```sql
enum TableType {
    MEMTABLE = 0,
    MAJOR_SSTABLE = 1,
    MINOR_SSTABLE = 2,  // obsoleted type after 2.2
    TRANS_SSTABLE = 3,  // new table type from 3.1
    MULTI_VERSION_MINOR_SSTABLE = 4,
    COMPLEMENT_MINOR_SSTABLE = 5,            // new table type from 3.1
    MULTI_VERSION_SPARSE_MINOR_SSTABLE = 6,  // reserved table type
    MINI_MINOR_SSTABLE = 7,
    RESERVED_MINOR_SSTABLE = 8,
    MAX_TABLE_TYPE
  };
```

## OceanBase V4.x 版本的 table_type

```sql
enum TableType : unsigned char
  {
    // < memtable start from here
    DATA_MEMTABLE = 0,
    TX_DATA_MEMTABLE = 1,
    TX_CTX_MEMTABLE = 2,
    LOCK_MEMTABLE = 3,
    // < add new memtable here

    // < sstable start from here
    MAJOR_SSTABLE = 10,
    MINOR_SSTABLE = 11,
    MINI_SSTABLE = 12,
    META_MAJOR_SSTABLE = 13,
    DDL_DUMP_SSTABLE = 14,
    REMOTE_LOGICAL_MINOR_SSTABLE = 15,
    DDL_MEM_SSTABLE = 16,
    // < add new sstable before here, See is_sstable()

    MAX_TABLE_TYPE
  };
```
