# 采集 tablet checksum 相关信息

## 采集描述

查询 `data_checksum` 校验不通过的 table_id、表名等信息。

## 采集原理

OceanBase V4.0.0 及之后版本：

```sql
SELECT e.*, t.table_name, t.table_id FROM
                            (
                                SELECT
                                    tenant_id, tablet_id,
                                    MIN(j.data_checksum) min_data_checksum,
                                    MAX(j.data_checksum) max_data_checksum,
                                    MIN(j.row_count) min_row_count,
                                    MAX(j.row_count) max_row_count,
                                    MIN(j.b_column_checksums) min_b_column_checksums,
                                    MAX(j.b_column_checksums) max_b_column_checksums
                                FROM (
                                    SELECT
                                        a.tenant_id tenant_id,
                                        a.tablet_id tablet_id,
                                        a.row_count row_count,
                                        a.data_checksum data_checksum,
                                        a.b_column_checksums b_column_checksums
                                    FROM oceanbase.__all_virtual_tablet_replica_checksum a
                                    JOIN oceanbase.__all_virtual_merge_info b
                                        ON a.tenant_id = b.tenant_id AND a.compaction_scn = b.frozen_scn
                                ) j
                                GROUP BY j.tenant_id, j.tablet_id
                                HAVING
                                    min_data_checksum != max_data_checksum or
                                    min_row_count != max_row_count or
                                    min_b_column_checksums != max_b_column_checksums
                            ) e
                            JOIN oceanbase.__all_virtual_table t
                            ON e.tenant_id = t.tenant_id and e.tablet_id = t.tablet_id
```
