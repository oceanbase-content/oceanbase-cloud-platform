性能监控
=========================

您可以从不同维度查看集群中的各种性能监控数据。

前提条件
-------------------------

当前登录的 OCP 用户有待查看集群的 **只读** 权限。

操作步骤
-------------------------

1. 登录 OCP 。

   默认进入集群概览页面。

2. 在 **集群列表** 区域，选择待操作的集群并单击其集群名。

3. 在显示的页面的左侧导航栏上，单击 **性能监控** 。

4. 在 **数据筛选** 区域，通过如下方式查看性能数据。

   筛选条件说明如下表所示：

   |     筛选条件      |  **描述**  |
   |---------------|---------|
   | 选择时间（又称：监控窗口） | 实时模式下不展示。 选择某一段时间范围，用于返回这段时间范围内的数据。   |
   | 统计周期          | 实时模式下不展示。 主要用于计算每个点数据的统计周期，支持按 **每分钟** 和 **每秒** 统计，分别对应了每分钟一个点或每秒钟一个点，OCP 同时也会根据选择的时间区间再去计算一个统计周期，计算的规则是使返回的数据接近 1440 个点，如果选择的时间区间比较长，可能会出现统计周期大于 1 分钟的情况。 |
   | 统计范围          | 指定统计范围为某个 Zone 或某一 Zone 下的某一 OBServer。 默认统计所有 Zone 的监控数据。   |

   ![1126](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3717130461/p360064.png)

   * 关闭 **实时** ：输入过滤条件后，系统按 **选择的时间** 及 **统计周期** 展示性能监控数据。

   * 打开 **实时** ：选择统计范围，系统实时展示该统计范围内的性能监控数据。

5. 分别在 **数据库性能** 和 **主机性能** 页签中查看相应性能监控数据。

   此处所有监控项的具体含义及取值来源，您都可参考 [监控指标](../13.appendix-2/8.monitoring-metrics.md) 理解。

   * 单击 **数据库性能** 页签。

     如果需要展示其他指标，您可以单击区域右侧的 **指标选择** 按钮，在 **指标选择** 面板中选择需要展示的指标，系统最多支持展示 10 个指标。

   * 单击 **主机性能** 页签。

     统计范围包含多台 OBServer 时，则展示多台 OBServer 的聚合值。

   下述功能能够帮您更好的在趋势图中查看和分析性能监控数据，您可结合图片及下述文字理解。

   ![1](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8507124461/p397839.png)

  <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>只有在 <strong>集群</strong> 、 <strong>租户</strong> 的 <strong>性能监控</strong> 中才有下钻功能，如果从 <strong>主机</strong> 进入 <strong>监控</strong> ，则没有下钻功能。</p>
  </main>

   1. 查看某一指标的在某一时间段的详细趋势：可鼠标拖拽选中该区域，系统会放大显示该区域的趋势信息，双击该趋势图可恢复。

   2. 隐藏其他细分指标的数据：单击其他细分指标标识，使其置灰，趋势图中将不展示该指标信息。

   3. 查看某时刻详细数据：鼠标悬停于趋势图中某时刻。

   4. 放大某一趋势图：单击趋势图右上角的放大图标。上述 ①、②、③ 的功能在放大的趋势图中同样适用。

   5. 下钻查看不同维度的监控数据：当您发现租户的监控数据异常时，如租户响应时间过高，您可通过下钻分析，定位到引起响应时间异常的服务器。单击趋势图右上角的 **下钻分析** 图标。

      * **数据库性能** 支持的下钻的维度为：集群 \> 租户 \> OBServer

      * **主机性能** 支持的下钻维度为：集群 \> 主机

      上述 ①、②、③ 的功能在下钻页面的趋势图中同样适用，此外您还可以：

      ![1202](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A71.png)

      1. 在下钻页面的 **数据筛选** 区域重新设置筛选条件，如您未设置则会自动继承上层设置。

      2. 如该指标存在细分指标，您可以选择细分指标进行查看或单击如图所示的 ① 或 ② 处下钻到不同维度进一步分析。

      3. 如该指标涉及租户或主机性能，则趋势图中会为您提供了直接跳转到相关租户或主机的 **监控** 页面。

         * 跳转到租户的 **性能监控** 页面：您只需鼠标悬停于趋势图右上角的 **前往租户性能监控** 链接上，选择相应租户并单击。

         * 跳转到主机 监控 页面：您只需鼠标悬停于趋势图右上角的 **前往主机性能监控** 链接上，选择相应主机并单击。

      4. 您也可通过趋势图右上角如图示的 ③ 或 ④ 处的按钮，选择需要在趋势图中展示的租户或主机。

6. （可选）配置监控采集间隔。

   当前 OCP 秒级别监控采集默认 1s 采集一次，该采集规模对 OCP Server 性能及 MonitorDB 的存储性能要求较高。在对监控数据要求不高的情况下，您可通过修改 config_properties 中 ocp.metric.collect.interval.second 的 value 值来配置监控采集间隔，从而减少资源占用、增加整体管理规模。

  <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>目前只支持配置的 value 值为 1、5、10 和 15。若您填写了其他不在上述列举内的数值，系统会自动进行适配：</p>
    <ul>
    <li>小于 1 统一为 1。</li>
    <li>[1,5) 区间向下兼容为 1。</li>
    <li>[5,10) 区间向下兼容为 5。</li>
    <li>[10,15) 区间向下兼容为 10。</li>
    <li>其余统一为 15。</li>
    </ul>
  </main>

   配置修改后 OCP 会立即以新的采集间隔进行采集，监控数据的展示间隔会默认为采集间隔的 3 倍（采集间隔 1s 除外）。如采集间隔为 5s，查询时秒级查询的监控数据的展示间隔则为 15s。
