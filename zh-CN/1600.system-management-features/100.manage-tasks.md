# 管理任务

通过 OCP 界面发起的运维和管理 OceanBase 集群、租户以及主机的任务和管理 OCP 系统的任务，OCP 提供对这些任务的管理和查看。

本节介绍如何查看任务详情及如何处理失败的任务。

## 前提条件

登录用户拥有系统管理员（ADMIN）或任务管理（TASK_MANAGER）角色。

## 查看任务详情

当 OCP 中存在 **执行中** 或 **执行失败** 的任务时，OCP 系统页面右上方的 **任务中心** 上将展示具体的任务数量。您可通过如下两种方式查看任务详情：

* 方式一：将光标悬停于 **任务中心** 上，单击气泡中的任务数字，**任务列表** 页面将以所选任务的状态为条件进行筛选，仅展示相同状态的任务。

* 方式二：单击 **任务中心**，**任务列表** 页面将默认展示全部状态的任务。

以下步骤以 **方式二** 为例：

1. 登录 OCP。

2. 单击页面上方 **任务中心**，进入 **任务列表** 页面。

3. 在 **任务列表** 页面，您可通过任务执行状态和发起者对任务进行筛选，或通过操作对象和任务名称对任务进行搜索。

   **任务列表** 中将返回所有符合条件的任务。其中，支持单击 **操作对象** 中的链接跳转至 **对象** 的概览页面。

   ![07021600](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/422/%E4%BB%BB%E5%8A%A1%E5%88%97%E8%A1%A8.png)

   <main id="notice" type='explain'>
   <h4>说明</h4>
   <p>若任务的操作对象已被删除，则只支持查看对象名称及对象类型，不支持跳转至 <b>对象</b> 概览页面。</p>
   </main>

4. 单击要查看的任务名，进入该任务的详情页面。任务详情页中默认以日志视图展示，可通过视图按钮切换为流转视图。

   * 日志视图下，提供对多个任务日志的展示，可通过图中左侧区域进行子任务切换，右侧区域将展示子任务的执行信息及全部日志；单击如下图 ① 或 ② 处的对应按钮，可对子任务执行相应的操作。

      ![07021544](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/422/%E5%A4%B1%E8%B4%A5%E4%BB%BB%E5%8A%A1%E6%97%A5%E5%BF%97%E8%A7%86%E5%9B%BE.png)

   * 流转视图下，页面通过拓扑图展示各个子任务的上下游关系。展开折叠菜单后，在屏幕的下方会出现折叠窗口展示日志信息，窗口可以拖动进行放大；单击指定子任务右侧的 **...** 中的操作项即可操作当前子任务。

      <main id="notice" type='explain'>
      <h4>说明</h4>
      <p>通过鼠标在空白处拖拽可以移动拓扑图，通过鼠标滚轮滑动可以进行拓扑图的放大及缩放，也可以通过右上方的缩放控件调整画布大小。拓扑图缩放是以鼠标指针为中心进行的，对于任务流程比较长的情况，可以先缩小，快速定位到关心的步骤，再进行放大，达到快速定位的目的。</p>
      </main>

      ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/421/%E4%BB%BB%E5%8A%A1%E6%B5%81%E8%BD%AC%E8%A7%86%E5%9B%BE.png)

   子任务的状态不同所支持的操作也不同，具体以 **...** 中显示的为准。

    * **执行成功** 的子任务可查看详情日志。

    * **执行失败** 的子任务可执行如下操作。

       * 下载日志信息。

       * 重试：重新运行当前子任务，即先回滚再执行，成功执行的话继续执行下游子任务。

       * 跳过：将当前子任务的状态直接设置为成功状态，继续执行下游子任务。

    * **执行中** 的子任务可下载日志或者终止运行，终止运行后子任务状态变更为 **已终止**，且主任务状态将变更为 **执行失败**；支持对终止运行的子任务执行下载日志、跳过和重试操作。

    * **待执行** 的子任务可进行查看日志操作。

## 重试失败任务

当任务 **回滚失败** 或 **执行失败** 时，支持对任务进行重试操作。重试失败任务会回滚当前步骤所有失败节点并再次执行，如果执行成功则继续执行后续步骤。

重试失败任务包括如下两种方式：

* 方式一：在 **任务列表** 页面，选择失败任务后进行重试。
* 方式二：在任务详情页面，单击右上角 **重试** 按钮，对任务进行重试。

以下操作步骤以 **方式一** 为例：

1. 登录 OCP。

2. 单击页面上方 **任务中心**，进入 **任务列表** 页面。

3. 选择需要重试的失败任务，单击操作列 ① 处的 **重试** 按钮。

   您可勾选多个需要重试的失败任务，单击 ② 处进行批量重试操作。

   ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/422/%E6%89%B9%E9%87%8F%E9%87%8D%E8%AF%95%E4%BB%BB%E5%8A%A1.png)

## 回滚失败任务

回滚操作会从执行失败的子任务处回滚所有已执行过的任务，逐步返向任务的根节点，主要用于任务的资源回收、状态修改等目的。

1. 登录 OCP。

2. 单击页面上方 **任务中心**，进入 **任务列表** 页面。

3. 单击要查看的任务名，进入该任务的详细页面。

4. 在任务详情页面的右上角单击 **回滚**。

   ![05101010](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/421/%E5%9B%9E%E6%BB%9A%E4%BB%BB%E5%8A%A1.png)

## 放弃失败任务

当任务 **回滚失败** 或 **执行失败**，若您已经通过黑屏完成了任务包含的所有运维操作，需要将任务进行到完成状态时，可以对任务进行放弃操作。

<main id="notice" type='explain'>
<h4>说明</h4>
<p>该操作会忽略任务失败状态并结束当前任务，且后续不支持对任务进行任何操作，可能造成 OCP 元信息缺失或状态与真实状态不一致，请谨慎操作。</p>
</main>

1. 登录 OCP。

2. 单击页面上方 **任务中心**，进入 **任务列表** 页面。

3. 选择需要重试的失败任务，单击操作列的 **放弃** 按钮。

   ![05101010](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/422/%E6%94%BE%E5%BC%83%E4%BB%BB%E5%8A%A1.png)

## 定位当前进度

在任务执行过程中，单击 **定位当前进度**，可快速跳转至正在执行的子任务，方便您关注任务执行状态及相关日志信息；对于 **执行失败** 的任务，单击 **定位当前进度**，可快速定位执行失败的子任务及任务执行异常信息。

## 下载日志

进入任务详情页面，单击右上角 **下载日志** 按钮，可将该任务下所有子任务的执行日志下载至本地。
