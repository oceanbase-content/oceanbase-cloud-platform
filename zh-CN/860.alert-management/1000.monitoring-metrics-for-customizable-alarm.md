# 自定义告警可选监控指标

本文列出当前版本还未配置告警的监控指标，如需告警可以使用 OCP 告警的自定义告警功能进行配置。

## 背景信息

OCP 基于支持的监控指标，已经内置了很多告警项，请参见 [告警参考概述](../1900.reference-guide/100.alarm-reference/100.alert-reference-overview.md)。

其余部分未配置告警的监控指标，可以通过自定义告警的方法进行告警配置，详细操作请参考 [新建告警规则](300.manage-alert-rules/100.create-an-alert-rule.md)。

## 主机指标

### OCP-Agent 进程资源监控

| 名称 | 指标名 |
|------|-------|
| OCP 监控 Agent 进程 CPU 使用率 / CPU 使用率 | monagent_process_cpu_percent_per_cpu |
| OCP 管理 Agent 进程 CPU 使用率 / CPU 使用率 | mgragent_process_cpu_percent_per_cpu  |

### 主机性能指标

| 名称 | 指标名 |
|----------------|-------------------|
| 主机负载 load5（按 CPU 核数平均值）  | load5_per_cpu     |
| 平均每次 IO 写入耗时 |  io_write_time    |
| 平均每次 IO 读取耗时 |  io_read_time     |

## 租户指标

### 租户性能指标

| 名称 | 指标名 | 解释 |
|------|-------|------|
| TPS 耗时 |  tps_rt | - |
| 租户冻结 memstore 个数  | ob_tenant_partition_frozen_memstore_count |
| SSStore 每次读取平均耗时 | io_read_rt | - |
| SSStore 每次写入平均耗时 | io_write_rt | - |
| 每次事务日志写盘平均耗时 | clog_write_disk_rt | - |
| 每次事务日志网络同步平均耗时 | trans_commit_log_sync_rt | - |
| 事务平均提交耗时 | trans_commit_rt | - |
| 事务平均回滚耗时 | transaction_rollback_rt | - |
| 每秒处理 SQL 语句数 | sql_all_count | - |
| 每秒处理 Replace 语句数 | sql_replace_count | - |
| DDL、DCL、DTL 等其他语句数 | sql_other_count | - |
| 块缓存大小 | block_cache_size | - |
| 行缓存大小 | row_cache_size | - |
| 执行计划缓存大小 | plan_cache_size | - |
| clog 缓存大小 | clog_cache_size_mb | - |
| bloom_filter 缓存大小 | bloom_filter_cache_size  | - |
| location 缓存大小 | location_cache_size  |  - |
| 事务表读请求命中 mini cache 数量 | tx_data_hit_mini_cache_count | - |
| 事务表读请求命中 kv cache 数量 | tx_data_hit_kv_cache_count | - |
| 事务表读请求命中事务上下文表数量 | tx_data_read_tx_ctx_count | - |
| 事务表读请求命中 memtable 数量 | tx_data_read_tx_data_memtable_count | - |
| 事务表读请求命中 sstable 数量 | tx_data_read_tx_data_sstable_count | - |
| 执行计划缓存 miss 率 | plan_cache_miss_ratio | miss 率 = 100% - 命中率  |
| 行缓存 miss 率 | row_cache_miss_ratio | miss 率 = 100% - 命中率  |
| 块缓存 miss 率 | block_cache_miss_ratio | miss 率 = 100% - 命中率  |
| bloom filter 缓存 miss 率 | bloom_filter_cache_miss_ratio | miss 率 = 100% - 命中率  |
| OceanBase 租户大查询队列大小 | ob_tenant_request_queue_large_size | - |
| 租户磁盘数据量 | ob_tenant_data_size_gb | 数据量（data_size）是数据的实际大小 |
| 租户磁盘占用量 | ob_tenant_disk_used_size_gb | 磁盘占用量（required_size）是包含了数据对齐后的磁盘占用（部分磁盘还没写数据，但是已被占用） |
| 租户磁盘使用百分比 | ob_tenant_disk_used_percentage | 租户磁盘占用量 （required_size） / 租户磁盘分配量（total_size） |

## OceanBase 指标

| 名称 | 指标名 |
|------|-------|
| Oceanbase 数据盘 sstable 目录下 block_file 文件存在情况 | ob_sstable_block_file_exists |
| Oceanbase log 目录存在情况 | ob_log_dir_exists |
| Oceanbase data 目录存在情况 | ob_data_dir_exists |
| Oceanbase install 目录存在情 | ob_install_dir_exists |
| Oceanbase run 目录存在情况 | ob_run_dir_exists |
| clog 每次写入平均耗时 | clog_io_write_rt |
| 事务平均提交耗时 | transaction_commit_rt |
| 事务平均回滚耗时 | transaction_rollback_rt |
| 每秒处理 SQL 语句数 | sql_all_count |
| 每秒处理 Replace 语句数 | sql_replace_count |
| DDL、DCL、DTL 等其他语句数 | sql_other_count |
| 事务表读请求命中 mini cache 数量 | tx_data_hit_mini_cache_count |
| 事务表读请求命中 kv cache 数量 | tx_data_hit_kv_cache_count |
| 事务表读请求命中事务上下文表数量 | tx_data_read_tx_ctx_count |
| 事务表读请求命中 memtable 数量 | tx_data_read_tx_data_memtable_count |
| 事务表读请求命中 sstable 数量 | tx_data_read_tx_data_sstable_count |
| 当前会话数 | all_session |
| Select 语句平均处理耗时 | sql_select_rt |
| OBServer ERROR 日志个数 | observer_log_error_count |
| OBServer election ERROR 日志个数 | election_log_error_count |
| OBServer rotservice ERROR 日志个数 | rootservice_log_error_count |

### OceanBase 进程指标

操作系统视角看到的进程资源监控。

| 名称 | 指标名 |
|------|-------|
| OBServer 线程数 | observer_thread_count |
| OBServer 进程常驻内存大小 | observer_rss_mem_gb |
| OBServer 进程 CPU 使用率 / CPU 核数 | observer_process_cpu_percent_per_cpu |

## OBProxy 指标

| 名称 | 指标名 | 解释 |
|------|-------|------|
| 平均每次 select 请求耗时 | request_cost_select | - |
| 平均每次 insert 请求耗时 | request_cost_insert | - |
| 平均每次 update 请求耗时 | request_cost_update | - |
| 平均每次 delete 请求耗时 | request_cost_delete | - |
| OBProxy 服务端连接数使用百分比 | server_connection_used_percent | OBProxy 服务端连接数 / max_connections |
| OBProxy 进程内存使用率 | obproxy_rss_mem_used_percent | - |
| 通过 OBProxy 集群下发的平均每条 SQL 响应时间 | request_cost | - |
| 平均每次 commit 请求耗时 | request_cost_commit | - |
| 每秒大请求数 | request_total_large | - |
| 平均每次 sequence 请求耗时 | request_cost_sequence | - |
| 每秒慢请求数 | request_total_slow | - |
| 客户端连接数 | current_session_client | - |
| 服务端连接数 | current_session_server | - |
| 平均每次请求发送准备耗时 | request_cost_prepare_send_request_time | - |
| 平均每次服务端处理请求耗时 | request_cost_server_process_request_time | - |
| 平均每次其他请求耗时 | request_cost_others | - |
| OBProxy ERROR 日志个数 | obproxy_log_error_count | - |

### OBProxy 进程指标

操作系统视角看到的进程资源监控。

| 名称 | 指标名 |
|------|-------|
| OBProxy 文件句柄数 | obproxy_fd_count |
| OBProxy 线程数 | obproxy_thread_count |
| OBProxy 进程常驻内存大小 | obproxy_rss_mem_gb |
| OBProxy 进程 CPU 使用率 / CPU 核数 | obproxy_process_cpu_percent_per_cpu |
