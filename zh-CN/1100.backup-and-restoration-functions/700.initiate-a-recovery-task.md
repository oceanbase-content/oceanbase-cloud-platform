# 发起恢复

您可对已备份的集群发起恢复。

## 前提条件

* 对要恢复的内容，已执行了 [立即备份](400.backup-now/100.back-up-cluster-now.md) 。

* 已进行物理备份的 OceanBase 集群在发起备份恢复时，不支持从高版本恢复到低版本。

## 操作步骤

1. 登录 OCP。

2. 进入 **发起恢复** 页面。

   * 路径 1，在全局页面发起恢复。

     1. 在左导航栏单击 **备份恢复** **\>** **恢复** 。

     2. 进入 **恢复** 页面，在右上方单击 **发起恢复** 。

   * 路径 2，在某集群运维页面对该集群发起恢复。

     1. 在左导航栏单击 **集群** ，进入 **集群概览** 页面。

     2. 在 **集群列表** 或 **资源水位** 中单击要恢复的集群名，进入该集群运维页面。

     3. 在左导航栏单击 **备份恢复** 。

     4. 在该集群的 **备份恢复** 页面单击 **发起恢复** 。

     <main id="notice" type='explain'>
     <h4>说明</h4>
     <p>若有如下情况，则无法从路径 2 下对该集群发起恢复：<ul><li>该集群状态不为 “运行中”。</li><li>该集群没有备份策略。</li></ul></p>
     </main>

   * 路径 3，在某租户运维页面对该租户发起恢复。

      1. 在左导航栏单击 **租户** ，进入 **租户概览** 页面。

      2. 在 **租户列表** 中单击要恢复的租户名，进入该租户运维页面。

      3. 在左导航栏单击 **备份恢复** 。

      4. 在该租户的 **备份恢复** 页面单击 **发起恢复** 。

     <main id="notice" type='explain'>
     <h4>说明</h4>
     <p>若有如下情况，则无法从路径 3 下对该租户发起恢复：<ul><li>该租户状态不为 “运行中”。</li><li>该租户没有备份策略。</li></ul></p>
     </main>

3. （可选）在全局页面发起恢复时，需填写存储配置，或单击 **选择已有配置** 。

   ![Image 9](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6783524261/p283974.png)

   |     参数  |  说明   |
   |-------|-----|
   | 存储类型  | 可选择如下介质： <ul><li>File：NFS 介质。</li><li> OSS：阿里云 OSS 存储对象，仅 OceanBase V2.2.76 及以上版本支持。   </li><li> COS：腾讯云 COS 存储对象，仅 OceanBase V2.2.77 BP2 及以上、V4.0 以下版本支持。</li></ul>    |
   | 存储目录  | 选择备份文件所在的目录。 <ul><li>可单击上方 **选择已有配置** 选择列表中的配置，则 **访问域名** 、 **访问用户** 、 **访问秘钥** 、 **解析主机** 等会自动填充。</li><li> 也可以手动输入。 </li></ul>      |
   | 访问域名  | 填写备份文件云存储端的域名。 <ul><li>当 **存储类型** 选择 OSS 时展示，填写访问阿里云存储端的域名。支持在域名后添加端口号，如：`oss.ap-shanghai.myqcloud.com:8080`。</li><li> 当 **存储类型** 选择 COS 时展示，填写访问腾讯云 COS 存储桶中对象的域名，域名后不支持添加端口号。</li></ul> |
   | 访问用户        | 当 **存储类型** 为 OSS 时显示，填写备份文件在云存储端的访问用户。  |
   | 访问秘钥        | 当 **存储类型** 为 OSS 时显示，填写备份文件云存储端的访问用户的秘钥。  |
   | 资源标志（APPID） | 当 **存储类型** 为 COS 时显示，根据界面上 **？** 中的提示填写。   |
   | 项目身份识别 ID   | 当 **存储类型** 为 COS 时显示，根据界面上 **？** 中的提示填写。   |
   | 项目身份秘钥      | 当 **存储类型** 为 COS 时显示，根据界面上 **？** 中的提示填写。   |
   | 解析主机        | 1. 填充值域 **存储目录** 配置为 **选择已有配置** 时，解析主机值域自动填充。不自动填充时可参考界面提示手动选择。 </br>  2. 单击 **解析** ，获取可恢复的集群列表。   |

4. 选择 **恢复源与时间** ，在下拉框中选择应数据。

   |  参数   |              说明               |
   |-------|-------------------------------|
   | 源集群   | 集群运维页面对某集群发起恢复时，源集群已默认，不需要选择。 |
   | 源租户   | 请选择需恢复的租户。                    |
   | 恢复日期  | 需在提示的可恢复时间段内。                 |
   | 恢复时间点 | 在提示的时间段内选择要恢复的时间点。            |

   ![05112125](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9369970261/p272696.png)

5. 选择恢复目标租户，在下拉框中选择运行状态的集群，在租户名称中输入新的租户名称。

   <main id="notice" type='explain'>
   <h4>说明</h4>
   <p>以下集群不能作为恢复目标：<ul><li>主备模式的集群。</li><li>状态为不可用的集群。</li><li>低于发起恢复集群版本的集群。</li></ul></p>
   </main>

6. 填写如下参数配置 Zone ，并对 Zone 进行优先级排序。

   |   参数    |说明   |
   |---------|---|
   | 副本类型    | 取值范围： <ul><li>全能型副本：目前支持的普通副本，拥有事务日志、MemTable 和 SSTable 等全部完整的数据和功能。它可以随时快速切换为 Leader 以对外提供服务。</li><li> 日志型副本：只包含日志的副本，没有 MemTable 和 SSTable。它参与日志投票并对外提供日志服务，可以参与其他副本的恢复，但自己不能变为主提供数据库服务。   </li><li> 只读型副本：包含完整的日志、MemTable 和 SSTable 等。建议在业务对读取数据的一致性要求不高时选择。 </li></ul>   |
   | Unit 规格 | 该副本所占用的资源规格。 <ul><li>可选择已有规格。</li><li> 也可根据实际需要新建规格后再选择。 </li></ul>  |
   | Unit 数量 | 该副本所占用的资源数量。<blockquote>**注意**</br>当所选恢复目标集群为 V4.0 及以上版本时，不支持配置单个 Zone 的 Unit 数量，您在此填写的 Unit 数量将适用于新建恢复租户下的所有 Zone。</blockquote>|

   ![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/%E6%96%B0%E5%BB%BA%E6%81%A2%E5%A4%8D%E7%A7%9F%E6%88%B72.png)

7. 单击 **发起恢复** 。
