# 概述

预案管理是指对 OceanBase 数据库可能发生的突发事件、危机制定并实施一系列应急预案的过程。预案管理旨在提前建立故障应对方案，用户可以更好地应对突发事件、危机，减少损失并保障数据库稳定运行，以降低潜在风险对用户业务造成的影响，提高 OceanBase 数据库的整体应急能力。

<main id="notice" type='notice'>
<h4>功能适用性</h4>
<p>该内容仅适用于 OCP 企业版，OCP 社区版不支持此功能。</p>
</main>

预案管理主要包含 **预案模板** 和 **预案执行** 2 个模块。

## 预案模板

OCP 提供 10+ 种针对不同场景的预案模板，包括自动拉起 OBServer、扩容租户 CPU/内存以及刷新单条 SQL 的 PlanCache 等。您可以根据业务场景以及资源使用等情况进行模板定制化，如扩容方案以及是否启用预案模板等。

您可在 **预案模板** 页面查看预案的详细配置信息，包括 **预案名称** 、**预案类型** 、**对象类型** 、**对象** 、**自动执行** 、**类型** 、**创建时间** 、**变更时间** 、**创建人** 、**状态** 。

* 打开折叠页面，可查看预案的 **触发规则** 、**自动执行** 、**扩容系数** 、**服务器内存最大使用百分比** 等信息。
* 在搜索框输入预案名称，可对预案模板进行查询。
* 可通过 **对象类型** 、**自动执行** 、**类型** 和 **状态** 对预案进行筛选。
* 可通过 **创建时间** 和 **变更时间** 对预案模板进行排序。
* 支持对预案模板进行日常管理工作，包括新建预案模板、禁用/启用预案模板、删除预案模板和编辑预案模板，详情可参见 [管理预案模板](200.manage-a-plan-template.md)。

![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/430/%E9%A2%84%E6%A1%88%E6%A8%A1%E6%9D%BF.png)

## 预案执行

本模块提供预案执行信息、回滚方案或对应的 SQL 详情等，对关闭自动启用的模板，支持您手动执行。预案管理可以帮助您建立 OceanBase 数据库的应急管理机制和运维规范，为业务连续性、稳定性提供更智能化的保障。

您可在 **预案执行列表** 页面查看预案的详细执行信息，包括 **预案类型** 、**对象** 、**事件类型** 、**事件名称** 、**执行时间段** 和 **状态**。

* 在搜索框输入预案名称，可对预案进行查询。
* 可通过 **执行时间段** 对预案进行排序。
* 支持对已执行预案进行如下运维操作：
  * 单击 **查看任务**，将跳转至告警详情页面，您可在此页面查看预案的执行结果。
  * 单击 **查看回滚方案**，可查看该预案的回滚方案。
  * 单击 **查看 SQL**，将跳转至 SQL 详情页面，您可在此页面查看具体的 SQL 详情。

![1]()

## 预案类型说明

对于 OCP 支持的预案模板，不同预案类型的触发规则、对象类型有所不同。

|  预案类型  |  触发规则  | 对象类型  | 预案说明   |
|------------|------------|------------|---------|
|  在 OBServer 进程异常退出时重新拉起  |  `os_observer_not_exist` |  OB服务  |  在 observer 进程异常退出时重新拉起，事件发生的 12 个小时之内仅拉起一次。  |
|  在租户内存超限后对租户内存扩容   |  `tenant_memstore_percent_over_threshold`   |  租户  |  当租户内使用存超限后，对租户内存进行自动扩容。  |
|  在租户 CPU 超限后对租户 CPU 扩容  |  `ob_tenant_request_queue_over_threshold`  |  租户   |   当租户 CPU 使用超限后，对租户 CPU 进行自动扩容。  |
|  OBProxy 连接数不足时自动扩充配置  |  `obproxy_client_connections_usage_over_threshold`  |  OBProxy集群  |  当 OBProxy 连接数不足时，自动扩充集群级别对应参数配置。   |
|  刷新该 SQL 的 PlanCache  |  `oas_anomaly_sql_from_anomaly_event_analysis_perf_degradation`  |  租户 |  OAS 异常分析场景下，SQL 性能下降时刷新本 SQL 的 PlanCache  |
|  刷新该 SQL 的 PlanCache  |  `oas_anomaly_sql_from_anomaly_event_analysis_plan_changed`   |  租户  |  OAS 异常分析场景下，SQL 执行计划恶化时刷新本 SQL 的 PlanCache   |
| 刷新该 SQL 的 PlanCache   |  `oas_anomaly_sql_from_sql_inspection_perf_degradation`   |  租户  |  SQL 巡检场景下：SQL 执行计划恶化时刷新本 SQL 的 PlanCache   |
| 刷新该 SQL 的 PlanCache   |  `oas_anomaly_sql_from_sql_inspection_plan_changed`   |  租户  |  SQL 巡检场景下：SQL 性能下降时刷新本 SQL 的 PlanCache   |
|  在仲裁服务的 OBServer 进程异常退出时重新拉起  |  `arbitration_service_unavailable`   |  仲裁服务  |  当仲裁服务的 observer 进程异常退出时重新拉起，事件发生的 12 个小时之内仅拉起一次。   |
|  清空租户回收站  |  `ob_host_partition_count_over_threshold`   |  租户  |  当租户分区过多时，自动清理租户回收站。   |
|  重启 ocp-agent  |  `obagent_dead`   |   主机  |  当主机心跳检测失败时，尝试重启 ocp-agent。  |
|  重启 ocp-agent  |  `host_unavailable`   |  主机  |  当 agent 服务不可用时，尝试重启 ocp-agent。   |
